(function(s,c){var T=c.config.get(["wgCanonicalNamespace","wgCanonicalSpecialPageName","wgPageName","wgUserGroups","wgRevisionId","wgIsRedirect"]),A=["bureaucrat","sysop","global-admin"],I="rgb(20, 220, 23)",P="rgb(220, 20, 60)",M="rgb(100, 149, 237)",U="black",w,l,f,d,g,x,p,u,v;if(window.AjaxBatchRedirectLoaded)return;window.AjaxBatchRedirectLoaded=!0;function R(e){console.log(l.msg(e).plain()),c.notify(l.msg(e).plain(),{type:"error"})}function h(e,t,n,r){v.append(s("<div>").css("color",t).text(l.msg(e,n,r).escape()))}function D(e,t){return new Promise(function(n){w.postWithEditToken({action:"edit",watchlist:"nochange",title:e,minor:!0,bot:!0,text:"#REDIRECT [["+t.charAt(0).toUpperCase()+t.slice(1)+"]]"}).done(function(r){r.error&&console.warn(r.error),n({error:r.error?"redirectfail":!1})}).fail(function(r){console.warn(r),n({error:"redirectfail"})})})}function j(e,t){return new Promise(function(n){w.postWithEditToken({action:"delete",watchlist:"nochange",title:e,reason:l.msg("deleteReason").plain()}).done(function(r){if(r.error){console.warn(r.error),n({error:"deleteFail"});return}n(D(e,t))}).fail(function(r){console.warn(r),n({error:"deleteFail"})})})}function _(e){return new Promise(function(t){w.get({action:"query",titles:e.flat().join("|"),prop:"info"}).done(function(n){n.error&&console.warn(n.error),t(n.error?!1:n.query.pages)}).fail(function(n){console.warn(n),t(!1)})})}function b(e,t,n,r,o){return new Promise(function(a){var L=e.slice(n,n+5);r=r.concat(L.map(function(i){return t(i[0],i[1])})),n+5>=e.length?a(r):(x.empty().append(s("<div>").css("color",I).text(l.msg("inCooldown",r.length,e.length).escape())),setTimeout(function(){b(e,t,n+5,r,o).then(function(i){a(i)})},o))})}function B(e,t){return new Promise(function(n){b(e,j,0,[],1e4).then(function(r){Promise.allSettled(r).then(function(o){for(var a in o)o[a].reason||o[a].value.error==="redirectfail"?(h("consoleRedirectFail",P,e[a][0],e[a][1]),t.push(e[a]),o[a].reason&&console.warn(o[a].reason)):o[a].value.error==="deleteFail"&&(h("consoleDeleteFail",P,e[a][0],e[a][1]),t.push(e[a]));n(!0)})})})}function S(e,t){return new Promise(function(n){b(e,D,0,[],5e3).then(function(r){Promise.allSettled(r).then(function(o){for(var a in o)(o[a].reason||o[a].value.error==="redirectfail")&&(h("consoleRedirectFail",P,e[a][0],e[a][1]),t.push(e[a]),o[a].reason&&console.warn(o[a].reason));n(!0)})})})}function N(e){_(e).then(function(t){if(!t){R("queryError");return}var n={},r=[],o=[],a=[],L=1,i,C=function(){if(--L===0){var m=r.length+o.length-a.length;v.append(s("<div>").css("color",U).text(l.msg("finished",m).escape())),p.val(a.map(function(F){return F[0]}).join(`
`)),u.val(a.map(function(F){return F[1]}).join(`
`)),x.empty(),p.removeAttr("disabled"),u.removeAttr("disabled"),d=!1}};for(i in t)n[t[i].title]=t[i];for(i in e){var y=n[e[i][0]];y.ns===6&&y.missing!==""&&y.redirect!==""?o.push(e[i]):r.push(e[i])}if(o.length>0)if(T.wgUserGroups.some(function(m){return A.includes(m)})){var O=confirm(l.msg("confirmDeletePages",o.map(function(m){return m[0]}).join(`
`)).plain());if(O)L++,B(o,a).then(C);else for(i in o)h("consoleDeleteSkipped",M,o[i][0],o[i][1]),a.push(o[i])}else for(i in o)h("consoleDeleteNoPerm",M,o[i][0],o[i][1]),a.push(o[i]);S(r,a).then(C)})}function W(){if(!d){d=!0;for(var e=p.val().split(`
`),t=u.val().split(`
`),n=[],r=0;r<Math.max(e.length,t.length);r++){var o=(e[r]||"").replaceAll("_"," ").trim(),a=(t[r]||"").replaceAll("_"," ").trim();if(!(o===""&&a===""))if(o===""||a===""){alert(l.msg("pageCouplingError",r+1,o,a).plain()),d=!1;return}else n.push([o,a])}n.length>0?(p.attr("disabled",""),u.attr("disabled",""),v.empty(),N(n)):d=!1}}function V(){return s("<form>").append(s("<fieldset>").append(s("<p>",{text:l.msg("inputInstructions").plain()}),s("<p>",{id:"form-progress"}),s("<div>",{id:"form-main-wrapper"}).append(s("<div>").append(s("<p>",{text:l.msg("inputPagesFrom").plain()+":"}),s("<textarea>",{id:"text-pages-from"})),s("<div>").append(s("<p>",{text:l.msg("inputPagesTo").plain()+":"}),s("<textarea>",{id:"text-pages-to"}))),s("<p>",{text:l.msg("errorsForm").plain()+":"}),s("<div>",{id:"text-error-output"}))).prop("outerHTML")}function q(){if(f){f.show();return}f=new window.dev.modal.Modal({content:V(),id:"batchredirect-form",size:"large",title:l.msg("modalTitle").escape(),buttons:[{id:"batchredirect-start",text:l.msg("initiate").escape(),primary:!0,event:"start"}],events:{start:W}}),f.create(),g=s("#batchredirect-form"),x=g.find("#form-progress"),p=g.find("#text-pages-from"),u=g.find("#text-pages-to"),v=g.find("#text-error-output"),f.show()}function G(){w=new c.Api,c.libs.PowertoolsPlacement.addPortletLink(c.config.values.skin,{id:"t-batchredirect",href:"#",label:l.msg("toolsTitle").plain(),tooltip:"AjaxBatchRedirect",onClick:q})}var Q=3;function k(){--Q===0&&c.loader.using(["mediawiki.api","mediawiki.user"]).then(G)}c.hook("dev.modal").add(k),c.hook("dev.powertools.placement").add(k),z().then(function(e){l=$(e),k()});function $(e){var t=c.Message;t.prototype.constructor=c.Message.prototype.constructor;var n={_i18nLoader:e,msg:function(){var r=Array.prototype.slice.call(arguments);if(r.length!==0){var o=r.shift();return new t(this._i18nLoader.getMessages(),o,r)}}};return["setTempLang","setDefaultLang"].forEach(function(r){n[r]=n._i18nLoader[r].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(r){n[r]=n._i18nLoader[r].bind(n)}),n}function z(){var e=new s.Deferred;return c.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(t){var n=t("ext.gadget.store.FandoomUtilsI18nLoader");n.loadMessages("AjaxBatchRedirect",{}).done(function(r){if(!r){e.resolve(E());return}e.resolve(r)})}).fail(function(t){console.error(t),e.resolve(E())}),e}function E(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new c.Map;e.set({toolsTitle:"Batch Redirect",modalTitle:"Ajax Batch Redirect",inputInstructions:"Put the name of each page on a separate line. Each line on the left side table will be redirected to the corresponding line on the right side.",inputPagesFrom:"Pages to redirect from",inputPagesTo:"Pages to redirect to",errorsForm:"Any errors encountered will appear below",initiate:"Initiate",deleteReason:"Reason: Making redirect",finished:"Finished. $1 pages redirected. Failed pages are reinserted to the input boxes.",confirmDeletePages:`Delete the following file pages to make way for redirect?

$1`,pageCouplingError:`Cannot couple pages correctly. Please check that each line on the left panel corresponds to each line on the right panel.

Error on Line $1: from page $2, to page $3`,queryError:"Unexpected error on page info query.",inCooldown:"$1/$2 (in cooldown)",consoleRedirectFail:"Redirect edit failed: from page $1, to page $2.",consoleDeleteFail:"Failed to delete file page $1 for redirecting to $2.",consoleDeleteNoPerm:"Not enough permission to delete file page $1 for redirecting to $2.",consoleDeleteSkipped:"User skipped a file page redirect: from page $1, to page $2."}),c.Message.prototype.escape===void 0&&(c.Message.prototype.escape=c.Message.prototype.escaped);var t={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){t[n]=s.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){t[n]=function(){return this}}),t}})(jQuery,mediaWiki);
