(function(c){c.loader.getState("ext.gadget.store.FandoomUiUtilsModal")===null&&c.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/FandoomUiUtilsModal/gadget-impl.js"),c.loader.getState("ext.gadget.store.PowertoolsPlacement")===null&&c.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/PowertoolsPlacement/gadget-impl.js"),c.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")===null&&c.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/FandoomUtilsI18nLoader/gadget-impl.js"),c.loader.impl(function(){return["ext.gadget.store.AjaxBatchRedirect@affcd1f2",function(O,$,X,Y){(function(s,d){var A=d.config.get(["wgCanonicalNamespace","wgCanonicalSpecialPageName","wgPageName","wgUserGroups","wgRevisionId","wgIsRedirect"]),C=["bureaucrat","sysop","global-admin"],E="rgb(20, 220, 23)",P="rgb(220, 20, 60)",j="rgb(100, 149, 237)",T="black",v,l,p,g,f,b,u,m,x;if(window.AjaxBatchRedirectLoaded)return;window.AjaxBatchRedirectLoaded=!0;function I(e){console.log(l.msg(e).plain()),d.notify(l.msg(e).plain(),{type:"error"})}function h(e,r,t,n){x.append(s("<div>").css("color",r).text(l.msg(e,t,n).escape()))}function M(e,r){return new Promise(function(t){v.postWithEditToken({action:"edit",watchlist:"nochange",title:e,minor:!0,bot:!0,text:"#REDIRECT [["+r.charAt(0).toUpperCase()+r.slice(1)+"]]"}).done(function(n){n.error&&console.warn(n.error),t({error:n.error?"redirectfail":!1})}).fail(function(n){console.warn(n),t({error:"redirectfail"})})})}function S(e,r){return new Promise(function(t){v.postWithEditToken({action:"delete",watchlist:"nochange",title:e,reason:l.msg("deleteReason").plain()}).done(function(n){if(n.error){console.warn(n.error),t({error:"deleteFail"});return}t(M(e,r))}).fail(function(n){console.warn(n),t({error:"deleteFail"})})})}function B(e){return new Promise(function(r){v.get({action:"query",titles:e.flat().join("|"),prop:"info"}).done(function(t){t.error&&console.warn(t.error),r(t.error?!1:t.query.pages)}).fail(function(t){console.warn(t),r(!1)})})}function y(e,r,t,n,o){return new Promise(function(i){var L=e.slice(t,t+5);n=n.concat(L.map(function(a){return r(a[0],a[1])})),t+5>=e.length?i(n):(b.empty().append(s("<div>").css("color",E).text(l.msg("inCooldown",n.length,e.length).escape())),setTimeout(function(){y(e,r,t+5,n,o).then(function(a){i(a)})},o))})}function _(e,r){return new Promise(function(t){y(e,S,0,[],1e4).then(function(n){Promise.allSettled(n).then(function(o){for(var i in o)o[i].reason||o[i].value.error==="redirectfail"?(h("consoleRedirectFail",P,e[i][0],e[i][1]),r.push(e[i]),o[i].reason&&console.warn(o[i].reason)):o[i].value.error==="deleteFail"&&(h("consoleDeleteFail",P,e[i][0],e[i][1]),r.push(e[i]));t(!0)})})})}function q(e,r){return new Promise(function(t){y(e,M,0,[],5e3).then(function(n){Promise.allSettled(n).then(function(o){for(var i in o)(o[i].reason||o[i].value.error==="redirectfail")&&(h("consoleRedirectFail",P,e[i][0],e[i][1]),r.push(e[i]),o[i].reason&&console.warn(o[i].reason));t(!0)})})})}function z(e){B(e).then(function(r){if(!r){I("queryError");return}var t={},n=[],o=[],i=[],L=1,a,D=function(){if(--L===0){var w=n.length+o.length-i.length;x.append(s("<div>").css("color",T).text(l.msg("finished",w).escape())),u.val(i.map(function(U){return U[0]}).join(`
`)),m.val(i.map(function(U){return U[1]}).join(`
`)),b.empty(),u.removeAttr("disabled"),m.removeAttr("disabled"),g=!1}};for(a in r)t[r[a].title]=r[a];for(a in e){var k=t[e[a][0]];k.ns===6&&k.missing!==""&&k.redirect!==""?o.push(e[a]):n.push(e[a])}if(o.length>0)if(A.wgUserGroups.some(function(w){return C.includes(w)})){var K=confirm(l.msg("confirmDeletePages",o.map(function(w){return w[0]}).join(`
`)).plain());if(K)L++,_(o,i).then(D);else for(a in o)h("consoleDeleteSkipped",j,o[a][0],o[a][1]),i.push(o[a])}else for(a in o)h("consoleDeleteNoPerm",j,o[a][0],o[a][1]),i.push(o[a]);q(n,i).then(D)})}function N(){if(!g){g=!0;for(var e=u.val().split(`
`),r=m.val().split(`
`),t=[],n=0;n<Math.max(e.length,r.length);n++){var o=(e[n]||"").replaceAll("_"," ").trim(),i=(r[n]||"").replaceAll("_"," ").trim();if(!(o===""&&i===""))if(o===""||i===""){alert(l.msg("pageCouplingError",n+1,o,i).plain()),g=!1;return}else t.push([o,i])}t.length>0?(u.attr("disabled",""),m.attr("disabled",""),x.empty(),z(t)):g=!1}}function V(){return s("<form>").append(s("<fieldset>").append(s("<p>",{text:l.msg("inputInstructions").plain()}),s("<p>",{id:"form-progress"}),s("<div>",{id:"form-main-wrapper"}).append(s("<div>").append(s("<p>",{text:l.msg("inputPagesFrom").plain()+":"}),s("<textarea>",{id:"text-pages-from"})),s("<div>").append(s("<p>",{text:l.msg("inputPagesTo").plain()+":"}),s("<textarea>",{id:"text-pages-to"}))),s("<p>",{text:l.msg("errorsForm").plain()+":"}),s("<div>",{id:"text-error-output"}))).prop("outerHTML")}function W(){if(p){p.show();return}p=new window.dev.modal.Modal({content:V(),id:"batchredirect-form",size:"large",title:l.msg("modalTitle").escape(),buttons:[{id:"batchredirect-start",text:l.msg("initiate").escape(),primary:!0,event:"start"}],events:{start:N}}),p.create(),f=s("#batchredirect-form"),b=f.find("#form-progress"),u=f.find("#text-pages-from"),m=f.find("#text-pages-to"),x=f.find("#text-error-output"),p.show()}function G(){v=new d.Api,d.libs.PowertoolsPlacement.addPortletLink(d.config.values.skin,{id:"t-batchredirect",href:"#",label:l.msg("toolsTitle").plain(),tooltip:"AjaxBatchRedirect",onClick:W})}var H=3;function F(){--H===0&&d.loader.using(["mediawiki.api","mediawiki.user"]).then(G)}d.hook("dev.modal").add(F),d.hook("dev.powertools.placement").add(F),J().then(function(e){l=Q(e),F()});function Q(e){var r=d.Message;r.prototype.constructor=d.Message.prototype.constructor;var t={_i18nLoader:e,msg:function(){var n=Array.prototype.slice.call(arguments);if(n.length!==0){var o=n.shift();return new r(this._i18nLoader.getMessages(),o,n)}}};return["setTempLang","setDefaultLang"].forEach(function(n){t[n]=t._i18nLoader[n].bind(t._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){t[n]=t._i18nLoader[n].bind(t)}),t}function J(){var e=new s.Deferred;return d.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(r){var t=r("ext.gadget.store.FandoomUtilsI18nLoader");t.loadMessages("AjaxBatchRedirect",{}).done(function(n){if(!n){e.resolve(R());return}e.resolve(n)})}).fail(function(r){console.error(r),e.resolve(R())}),e}function R(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new d.Map;e.set({toolsTitle:"Batch Redirect",modalTitle:"Ajax Batch Redirect",inputInstructions:"Put the name of each page on a separate line. Each line on the left side table will be redirected to the corresponding line on the right side.",inputPagesFrom:"Pages to redirect from",inputPagesTo:"Pages to redirect to",errorsForm:"Any errors encountered will appear below",initiate:"Initiate",deleteReason:"Reason: Making redirect",finished:"Finished. $1 pages redirected. Failed pages are reinserted to the input boxes.",confirmDeletePages:`Delete the following file pages to make way for redirect?

$1`,pageCouplingError:`Cannot couple pages correctly. Please check that each line on the left panel corresponds to each line on the right panel.

Error on Line $1: from page $2, to page $3`,queryError:"Unexpected error on page info query.",inCooldown:"$1/$2 (in cooldown)",consoleRedirectFail:"Redirect edit failed: from page $1, to page $2.",consoleDeleteFail:"Failed to delete file page $1 for redirecting to $2.",consoleDeleteNoPerm:"Not enough permission to delete file page $1 for redirecting to $2.",consoleDeleteSkipped:"User skipped a file page redirect: from page $1, to page $2."}),d.Message.prototype.escape===void 0&&(d.Message.prototype.escape=d.Message.prototype.escaped);var r={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(t){r[t]=s.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(t){r[t]=function(){return this}}),r}})($,mediaWiki)},{css:["#batchredirect-form #form-main-wrapper{display:flex;flex-direction:row;gap:1em;justify-content:space-between;align-items:stretch}#form-main-wrapper div{display:flex;flex-direction:column;justify-content:end;width:50%}#batchredirect-form textarea{width:100%;height:20em;resize:none;padding:8px 12px}#batchredirect-form #text-error-output{background-color:#ffbfbf;color:#000;width:100%;box-sizing:border-box;min-height:120px;padding:8px 12px;overflow:auto}"]},{},{},null]})})(mediaWiki);
