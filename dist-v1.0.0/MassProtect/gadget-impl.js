(function(n){n.loader.getState("ext.gadget.store.FandoomUiUtilsModal")===null&&n.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/FandoomUiUtilsModal/gadget-impl.js"),n.loader.getState("ext.gadget.store.PowertoolsPlacement")===null&&n.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/PowertoolsPlacement/gadget-impl.js"),n.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")===null&&n.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/FandoomUtilsI18nLoader/gadget-impl.js"),n.loader.impl(function(){return["ext.gadget.store.MassProtect@7dca0c27",function(t,B,S,T){n.loader.using(["mediawiki.api","mediawiki.user"],function(){if(!/sysop|bureaucrat|global-admin/.test(n.config.get("wgUserGroups").join())||window.MassProtectLoaded)return;window.MassProtectLoaded=!0;var v=new n.Api,o,C=3,s,u=!0,l,c,d,g,x,y,h,L,b;function p(e){return t("<div>",{class:"edit-input-control"}).append(t("<div>").text(o.msg(e).plain()),t("<select>",{id:"protect-"+e}).append(t("<option>",{value:"",text:o.msg("unset").plain()}),t("<option>",{value:e+"=all",text:o.msg("all").plain()}),t("<option>",{value:e+"=autoconfirmed",text:o.msg("autoconfirmed").plain()}),t("<option>",{value:e+"=sysop",text:o.msg("sysop").plain()})))}function U(){return t("<form>").append(t("<fieldset>").append(t("<p>",{text:o.msg("protection").plain(),class:"protection-bold"}),p("edit"),p("move"),p("upload"),p("create"),t("<hr/>"),t("<div>",{class:"protection-bold edit-input-control"}).append(t("<div>").text(o.msg("expiry").plain()),t("<input>",{type:"text",id:"protect-expiry",placeholder:"indefinite"})),t("<hr/>"),t("<div>",{class:"protection-bold edit-input-control"}).append(t("<div>").text(o.msg("reason").plain()),t("<input>",{type:"text",id:"protect-reason"})),t("<hr/>"),t("<p>",{text:o.msg("instructions").plain()}),t("<textarea/>",{id:"text-mass-protect"}),t("<hr/>"),t("<div>",{id:"text-error-output",text:o.msg("error").plain()}).append(t("<br/>")))).prop("outerHTML")}function f(){--C===0&&k()}function k(){n.libs.PowertoolsPlacement.addPortletLink(n.config.values.skin,{id:"t-mp",href:"#",cssClasses:"custom",label:o.msg("title").plain(),tooltip:"MassProtect",onClick:F})}function F(){if(s){s.show();return}s=new window.dev.modal.Modal({content:U(),id:"form-mass-protect",size:"medium",title:o.msg("title").escape(),buttons:[{id:"mp-start",text:o.msg("initiate").escape(),primary:!0,event:"start"},{id:"mp-pause",text:o.msg("pause").escape(),primary:!0,event:"pause",disabled:!0},{id:"mp-add-pages-in-category",text:o.msg("addCategory").escape(),primary:!0,event:"addCategoryContents"},{text:o.msg("cancel").escape(),event:"close"}],events:{addCategoryContents:A,pause:P,start:j}}),s.create(),l=t("#form-mass-protect"),c=l.find("#text-mass-protect"),d=l.find("#text-error-output"),g=l.find("#protect-expiry"),x=l.find("#protect-create"),y=l.find("#protect-edit"),h=l.find("#protect-move"),L=l.find("#protect-upload"),b=l.find("#protect-reason"),s.show()}function P(){u=!0,s.disableActionButtons("mp-pause"),s.enableActionButtons(["mp-start","mp-add-pages-in-category"])}function j(){u=!1,s.disableActionButtons(["mp-start","mp-add-pages-in-category"]),s.enableActionButtons("mp-pause"),w()}function w(){if(!u){var e=(c.val()||"").split(`
`),a=e[0];a?E(a):(P(),d.append(o.msg("finished").escape()+" "+o.msg("done").escape()+"<br/>")),e=e.slice(1,e.length),c.val(e.join(`
`))}}function A(){var e=prompt(o.msg("categoryPrompt").plain());e&&v.get({action:"query",list:"categorymembers",cmtitle:"Category:"+e,cmlimit:"max"}).done(function(a){var i=a.query;for(var r in i.categorymembers){var m=c.val();c.val(m+i.categorymembers[r].title+`
`)}}).fail(function(a){d.append(o.msg("categoryFail").escape()+e+" : "+a+"<br/>")})}function E(e){v.postWithEditToken({action:"protect",expiry:g.val()||g.attr("placeholder"),protections:x.val()||[y.val(),h.val(),L.val()].filter(Boolean).join("|"),watchlist:"preferences",title:e,reason:b.val()}).done(function(){console.log(o.msg("success",e).plain())}).fail(function(a){console.log(o.msg("fail").escape()+e+": "+a),d.append(o.msg("fail").escape()+e+": "+a+"<br/>")}),setTimeout(w,window.massProtectDelay||1e3)}n.hook("dev.modal").add(f),n.hook("dev.powertools.placement").add(f),I().then(function(e){o=D(e),f()});function D(e){var a=n.Message;a.prototype.constructor=n.Message.prototype.constructor;var i={_i18nLoader:e,msg:function(){var r=Array.prototype.slice.call(arguments);if(r.length!==0){var m=r.shift();return new a(this._i18nLoader.getMessages(),m,r)}}};return["setTempLang","setDefaultLang"].forEach(function(r){i[r]=i._i18nLoader[r].bind(i._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(r){i[r]=i._i18nLoader[r].bind(i)}),i}function I(){var e=new t.Deferred;return n.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(a){var i=a("ext.gadget.store.FandoomUtilsI18nLoader");i.loadMessages("MassProtect",{}).done(function(r){if(!r){e.resolve(M());return}e.resolve(r)})}).fail(function(a){console.error(a),e.resolve(M())}),e}function M(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new n.Map;e.set({unset:"Unset",all:"Allow all users",autoconfirmed:"Block new users and unregistered users",sysop:"Administrators and Content Moderators only",title:"Mass Protect",edit:"Edit:",move:"Move:",upload:"Upload:",create:"Create:",cancel:"Cancel",addCategory:"Add Category Contents",initiate:"Initiate",finished:"Finished!",done:"Nothing left to do, or next line is blank.",close:"Close",categoryPrompt:"Enter the category name (no category prefix):",categoryFail:"Failed to get contents of ",success:"Protection of $1 successful!",fail:"Failed to protect ",protection:"Protection:",expiry:"Expiry time:",reason:"Reason:",instructions:"Put the name of each page you want to protect on a separate line.",error:"Any errors encountered will appear below",pause:"Pause",comment:"Comment:"}),n.Message.prototype.escape===void 0&&(n.Message.prototype.escape=n.Message.prototype.escaped);var a={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(i){a[i]=t.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(i){a[i]=function(){return this}}),a}})},{css:['#form-mass-protect #text-mass-protect{height:20em;width:100%}#form-mass-protect #text-error-output{width:100%;margin:5px auto 0;color:#000;background-color:#ffbfbf;border:1px solid #000;font-weight:700;overflow:scroll;min-height:120px}#form-mass-protect .protection-bold{font-weight:700}#form-mass-protect .edit-input-control{display:flex;flex-direction:row;justify-content:flex-start;align-items:center}#form-mass-protect .edit-input-control>div{width:120px}#form-mass-protect .edit-input-control > select,#form-mass-protect .edit-input-control > input[type="text"]{flex-grow:2}@media(max-width:500px){#form-mass-protect .edit-input-control{flex-direction:column;justify-content:flex-start;align-items:flex-start}#form-mass-protect .edit-input-control>div{width:auto}#form-mass-protect .edit-input-control > select,#form-mass-protect .edit-input-control > input[type="text"]{width:100%;display:block}}']},{},{},null]})})(mediaWiki);
