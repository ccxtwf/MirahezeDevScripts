(function(t){t.loader.getState("ext.gadget.store.FandoomUiUtilsModal")===null&&t.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/FandoomUiUtilsModal/gadget-impl.js"),t.loader.getState("ext.gadget.store.PowertoolsPlacement")===null&&t.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/PowertoolsPlacement/gadget-impl.js"),t.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")===null&&t.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/FandoomUtilsI18nLoader/gadget-impl.js"),t.loader.impl(function(){return["ext.gadget.store.AjaxBatchUndelete@123f3c93",function(s,j,A,k){t.loader.using("mediawiki.api",function(){"use strict";if(window.AjaxBatchUndeleteLoaded||!/sysop|bureaucrat|global-admin/.test(t.config.get("wgUserGroups").join()))return;window.AjaxBatchUndeleteLoaded=!0;var a,b=3,r,u=!0,l,c,g,d;function p(){--b===0&&L()}function L(){t.libs.PowertoolsPlacement.addPortletLink(t.config.values.skin,{id:"t-bud",href:"#",label:a.msg("toolsTitle").plain(),tooltip:"AjaxBatchUndelete",onClick:v})}function v(){if(r){r.show();return}r=new window.dev.modal.Modal({content:x(),id:"form-batch-undelete",size:"medium",title:a.msg("modalTitle").escape(),buttons:[{id:"abu-start",text:a.msg("initiate").escape(),primary:!0,event:"start"},{id:"abu-pause",text:a.msg("pause").escape(),primary:!0,event:"pause",disabled:!0},{text:a.msg("close").escape(),event:"close"}],events:{pause:f,start:U}}),r.create(),l=s("#form-batch-undelete"),c=l.find("#undelete-reason"),g=l.find("#text-batch-undelete"),d=l.find("#text-error-output"),r.show()}function x(){return s("<form>").append(s("<fieldset>").append(s("<div>",{class:"edit-input-controls"}).append(s("<label>",{for:"undelete-reason",text:a.msg("inputReason").plain()}),s("<input>",{type:"text",name:"undelete-reason",id:"undelete-reason"})),s("<p>",{text:a.msg("inputPages").plain()+":"}),s("<textarea>",{id:"text-batch-undelete"}),s("<p>",{text:a.msg("errorsForm").plain()}),s("<div>",{id:"text-error-output"}))).prop("outerHTML")}function f(){u=!0,r.disableActionButtons("abu-pause"),r.enableActionButtons("abu-start")}function U(){if(!c.val()){alert(a.msg("stateReason").plain());return}u=!1,r.disableActionButtons("abu-start"),r.enableActionButtons("abu-pause"),h()}function h(){if(!u){var e=g.val().split(`
`),o=e[0];o?P(o,c.val()):(d.append(a.msg("endMsg").escape()+"<br/>"),f()),e=e.slice(1,e.length),g.val(e.join(`
`))}}function P(e,o){new t.Api().postWithEditToken({format:"json",action:"undelete",watchlist:"preferences",timestamps:"",title:e,reason:o}).done(function(n){n.error?(console.log(a.msg("failure").escape()+" "+e+": "+n.error.code),d.append(a.msg("failure").escape()+" "+e+": "+n.error.code+"<br/>")):console.log(a.msg("success",e).escape())}).fail(function(){console.log(a.msg("failure").escape()+" "+e),d.append(a.msg("failure").escape()+" "+e+"<br/>")}),setTimeout(h,window.batchUndeleteDelay||1e3)}t.hook("dev.modal").add(p),t.hook("dev.powertools.placement").add(p),w().then(function(e){a=y(e),p()});function y(e){var o=t.Message;o.prototype.constructor=t.Message.prototype.constructor;var n={_i18nLoader:e,msg:function(){var i=Array.prototype.slice.call(arguments);if(i.length!==0){var M=i.shift();return new o(this._i18nLoader.getMessages(),M,i)}}};return["setTempLang","setDefaultLang"].forEach(function(i){n[i]=n._i18nLoader[i].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(i){n[i]=n._i18nLoader[i].bind(n)}),n}function w(){var e=new s.Deferred;return t.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(o){var n=o("ext.gadget.store.FandoomUtilsI18nLoader");n.loadMessages("AjaxBatchUndelete",{}).done(function(i){if(!i){e.resolve(m());return}e.resolve(i)})}).fail(function(o){console.error(o),e.resolve(m())}),e}function m(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new t.Map;e.set({modalTitle:"Ajax Batch Undelete",endMsg:"Done! Nothing left to do, or next line is blank.",inputReason:"Reason for recovery:",inputPages:"Put the name of each page you want to undelete on a separate line",errorsForm:"Any errors encountered will appear below:",close:"Close",initiate:"Initiate",stateReason:"Please state a reason!",success:"Recovery of $1 successful!",failure:"Failed to recover",toolsTitle:"Batch Undelete",pause:"Pause"}),t.Message.prototype.escape===void 0&&(t.Message.prototype.escape=t.Message.prototype.escaped);var o={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){o[n]=s.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){o[n]=function(){return this}}),o}})},{css:["#form-batch-undelete #text-batch-undelete{height:20em;resize:none;width:100%}#form-batch-undelete #text-error-output{background-color:#ffbfbf;color:#000;font-weight:700;width:100%}#form-batch-undelete .edit-input-controls>*{display:block;width:100%}"]},{},{},null]})})(mediaWiki);
