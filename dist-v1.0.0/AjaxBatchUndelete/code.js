mw.loader.using("mediawiki.api",function(){"use strict";if(window.AjaxBatchUndeleteLoaded||!/sysop|bureaucrat|global-admin/.test(mw.config.get("wgUserGroups").join()))return;window.AjaxBatchUndeleteLoaded=!0;var n,m=3,s,u=!0,r,l,d,i;function c(){--m===0&&w()}function w(){mw.libs.PowertoolsPlacement.addPortletLink(mw.config.values.skin,{id:"t-bud",href:"#",label:n.msg("toolsTitle").plain(),tooltip:"AjaxBatchUndelete",onClick:L})}function L(){if(s){s.show();return}s=new window.dev.modal.Modal({content:b(),id:"form-batch-undelete",size:"medium",title:n.msg("modalTitle").escape(),buttons:[{id:"abu-start",text:n.msg("initiate").escape(),primary:!0,event:"start"},{id:"abu-pause",text:n.msg("pause").escape(),primary:!0,event:"pause",disabled:!0},{text:n.msg("close").escape(),event:"close"}],events:{pause:g,start:h}}),s.create(),r=$("#form-batch-undelete"),l=r.find("#undelete-reason"),d=r.find("#text-batch-undelete"),i=r.find("#text-error-output"),s.show()}function b(){return $("<form>").append($("<fieldset>").append($("<div>",{class:"edit-input-controls"}).append($("<label>",{for:"undelete-reason",text:n.msg("inputReason").plain()}),$("<input>",{type:"text",name:"undelete-reason",id:"undelete-reason"})),$("<p>",{text:n.msg("inputPages").plain()+":"}),$("<textarea>",{id:"text-batch-undelete"}),$("<p>",{text:n.msg("errorsForm").plain()}),$("<div>",{id:"text-error-output"}))).prop("outerHTML")}function g(){u=!0,s.disableActionButtons("abu-pause"),s.enableActionButtons("abu-start")}function h(){if(!l.val()){alert(n.msg("stateReason").plain());return}u=!1,s.disableActionButtons("abu-start"),s.enableActionButtons("abu-pause"),p()}function p(){if(!u){var e=d.val().split(`
`),a=e[0];a?v(a,l.val()):(i.append(n.msg("endMsg").escape()+"<br/>"),g()),e=e.slice(1,e.length),d.val(e.join(`
`))}}function v(e,a){new mw.Api().postWithEditToken({format:"json",action:"undelete",watchlist:"preferences",timestamps:"",title:e,reason:a}).done(function(t){t.error?(console.log(n.msg("failure").escape()+" "+e+": "+t.error.code),i.append(n.msg("failure").escape()+" "+e+": "+t.error.code+"<br/>")):console.log(n.msg("success",e).escape())}).fail(function(){console.log(n.msg("failure").escape()+" "+e),i.append(n.msg("failure").escape()+" "+e+"<br/>")}),setTimeout(p,window.batchUndeleteDelay||1e3)}mw.hook("dev.modal").add(c),mw.hook("dev.powertools.placement").add(c),y().then(function(e){n=x(e),c()});function x(e){var a=mw.Message;a.prototype.constructor=mw.Message.prototype.constructor;var t={_i18nLoader:e,msg:function(){var o=Array.prototype.slice.call(arguments);if(o.length!==0){var M=o.shift();return new a(this._i18nLoader.getMessages(),M,o)}}};return["setTempLang","setDefaultLang"].forEach(function(o){t[o]=t._i18nLoader[o].bind(t._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(o){t[o]=t._i18nLoader[o].bind(t)}),t}function y(){var e=new $.Deferred;return mw.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(a){var t=a("ext.gadget.store.FandoomUtilsI18nLoader");t.loadMessages("AjaxBatchUndelete",{}).done(function(o){if(!o){e.resolve(f());return}e.resolve(o)})}).fail(function(a){console.error(a),e.resolve(f())}),e}function f(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new mw.Map;e.set({modalTitle:"Ajax Batch Undelete",endMsg:"Done! Nothing left to do, or next line is blank.",inputReason:"Reason for recovery:",inputPages:"Put the name of each page you want to undelete on a separate line",errorsForm:"Any errors encountered will appear below:",close:"Close",initiate:"Initiate",stateReason:"Please state a reason!",success:"Recovery of $1 successful!",failure:"Failed to recover",toolsTitle:"Batch Undelete",pause:"Pause"}),mw.Message.prototype.escape===void 0&&(mw.Message.prototype.escape=mw.Message.prototype.escaped);var a={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(t){a[t]=$.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(t){a[t]=function(){return this}}),a}});
