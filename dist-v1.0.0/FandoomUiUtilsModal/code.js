(function(){if(window.dev=window.dev||{},window.dev.modal)return;var n={modals:{}},h=["small","medium","large","larger","content-size","full"];function l(){n._windowManager=new OO.ui.WindowManager({classes:["modal-js-window"]}),$(document.body).append(n._windowManager.$element),mw.hook("dev.modal").fire(n)}function o(t){this.primary=!!t.primary,this.safe=!!(t.close||t.safe),this.back=!!t.back,this.close=!!t.close,this.type="button",this.setText(t.text||t.value).setEvent(t.event).setClasses(t.classes).setID(t.id).setDisabled(t.disabled).setSprite(t.sprite||t.imageClass).setHref(t.href).setTitle(t.title).setTarget(t.target).setName(t.name)}o.prototype.setClasses=function(t){return this.classes=t instanceof Array?t:[],this},o.prototype.setDisabled=function(t){return this.disabled=!!t,this},o.prototype.setEvent=function(t){return typeof t=="string"&&(this.event=t),this},o.prototype.setHref=function(t){return this.type==="link"&&typeof t=="string"&&(this.href=t),this},o.prototype.setID=function(t){return typeof t=="string"&&(this.id=t),this},o.prototype.setName=function(t){if(this.type==="input")if(typeof t=="string")this.name=t;else throw new Error("`name` parameter required!");return this},o.prototype.setText=function(t){if(typeof t!="string")throw new Error("No text specified!");return this.text=t,this},o.prototype.setType=function(t){return this},o.prototype.setSprite=function(t){return(this.type==="link"||this.type==="button")&&typeof t=="string"&&(this.sprite=t),this},o.prototype.setTarget=function(t){return this.type==="link"&&typeof t=="string"&&(this.target=t),this},o.prototype.setTitle=function(t){return this.type==="link"&&typeof t=="string"&&(this.title=t),this},o.prototype.create=function(){var t=[];["primary","safe","back","close"].forEach(function(s){this[s]&&t.push(s)},this);var i={action:this.event,classes:this.classes,disabled:this.disabled,flags:t,href:this.href,target:this.target,icon:this.sprite,id:this.id,label:this.text,title:this.title};return i};function c(t){return typeof t!="object"?!1:new o(t)}function d(t){return t.create()}function e(t){if(typeof t.id!="string")throw new Error("Modal ID must be specified!");if(n.modals[t.id])throw new Error("Modal with same ID already registered!");this.id=t.id,this.context=t.context||this,this.setSize(t.size).setContent(t.content).setTitle(t.title,t.isHTML).setCloseTitle(t.closeTitle).setButtons(t.buttons).setEvents(t.events).setClass(t.class||t.classes).setClose(t.close).setCloseEscape(t.closeEscape),n.modals[this.id]=this}e.prototype.deps={OO:null},e.prototype.setButtons=function(t){return this.buttons=t instanceof Array?t.map(c).filter(Boolean):[],this.buttons.push(new o({close:!0,text:this.closeTitle,title:this.closeTitle})),this},e.prototype.setClass=function(t){return t instanceof Array?this.classes=t:typeof t=="string"&&(this.classes=[t]),this},e.prototype.setClasses=e.prototype.setClass,e.prototype.setClose=function(t){return typeof t=="function"&&(this.closeFunc=t),this},e.prototype.setCloseEscape=function(t){return this.closeEscape=t!==!1,this},e.prototype.setCloseTitle=function(t){return this.closeTitle=typeof t=="string"?t:mw.message("ooui-dialog-message-reject").plain(),this},e.prototype.setContent=function(t){if(typeof t=="string"||typeof t=="object"&&t instanceof e.prototype.deps.OO.ui.Layout)this.content=t;else if(t instanceof Node)this.content=t;else if(typeof t=="object"&&typeof window.dev.ui=="function")this.content=window.dev.ui(t);else throw new Error("Modal content not specified!");return this._modal&&(this.content instanceof e.prototype.deps.OO.ui.Layout?(this._modal.content.$element.remove(),this._modal.content=this.content,this._modal.$body.append(this.content.$element)):this._modal.content.$element.html(this.content)),this},e.prototype.setEvent=function(t,i){return this.events[t]=this.events[t]||[],typeof i=="function"?this.events[t].push(i.bind(this.context)):typeof i=="string"&&this.context&&typeof this.context[i]=="function"&&this.events[t].push(this.context[i].bind(this.context)),this},e.prototype.setEvents=function(t){if(this.events={},typeof t!="object")return this;for(var i in t)if(t[i]instanceof Array)for(var s=0,r=i.length;s<r;++s)this.setEvent(i,t[i][s]);else this.setEvent(i,t[i]);return this},e.prototype.setSize=function(t){return h.indexOf(t)===-1?this.size="medium":t==="content-size"?this.size="full":this.size=t,this._modal&&this._modal.setSize(this.size),this},e.prototype.setTitle=function(t,i){return this.title=typeof t=="string"?t:"Modal",this.titleIsHTML=!!i,this._modal&&!i&&(this._modal.title.setLabel(this.title),this._modal.constructor.static.title=this.title),this},e.prototype.filterActionButtons=function(t){var i=void 0,s=[];typeof t=="string"?s=[t]:t instanceof Array?s=t:typeof t=="object"&&((t.actions!==void 0||t.flags!==void 0)&&(i={actions:t.actions,flags:t.flags}),s=[t.id]);var r=this._modal.actions.get(i);return s.length===0?r:r.filter(function(a){return s.indexOf(a.getElementId())>-1})},e.prototype.disableActionButtons=function(t){return this.filterActionButtons(t).forEach(function(i){i.setDisabled(!0)}),this},e.prototype.enableActionButtons=function(t){return this.filterActionButtons(t).forEach(function(i){i.setDisabled(!1)}),this},e.prototype.toggleActionButtons=function(t){return this.filterActionButtons(t).forEach(function(i){var s=i.isDisabled();i.setDisabled(!s)}),this},e.prototype.create=function(){this._loading=new $.Deferred;var t=function(s){this._modal=s.modal,delete s.modal,t.super.call(this,s)};e.prototype.deps.OO.inheritClass(t,e.prototype.deps.OO.ui.ProcessDialog);var i=t.super.prototype;return t.static.name=this.id,t.static.title=this.title,t.static.actions=this.buttons.map(d),t.prototype.initialize=function(){i.initialize.apply(this,arguments),this._modal.content instanceof e.prototype.deps.OO.ui.Layout?this.content=this._modal.content:this.content=new e.prototype.deps.OO.ui.PanelLayout({expanded:!1,padded:!1}),this.content.$element.append(this._modal.content),this.$body.append(this.content.$element)},t.prototype.getActionProcess=function(s){var r=this._modal.events[s];return s==="close"?new e.prototype.deps.OO.ui.Process((function(){this.close()}).bind(this)):this._modal.events[s]?new e.prototype.deps.OO.ui.Process((function(){r.forEach(function(a){a()},this)}).bind(this)):i.getActionProcess.call(this,s)},this._modal=new t({classes:this.classes,id:this.id,modal:this,size:this.size}),n._windowManager.addWindows([this._modal]),this._modal.$frame.parent().prepend($("<div>",{class:"oo-ui-window-backdrop"})),this._modal.$frame.prev().click((function(s){$(s.target).parent().attr("id")===this.id&&this._modal.close()}).bind(this)),this._loading.resolve(this),this._loading},e.prototype._close=function(){return this._modal=null,this.create(),this.closeFunc?this.closeFunc.bind(this.context)():!0},e.prototype._created=function(t){this._modal=t;for(var i in this.events)for(var s=0,r=this.events[i].length;s<r;++s)t.bind(i,this.events[i][s]);this._loading.resolve(this)},e.prototype.show=function(){if(this.wScrollTop=$(window).scrollTop(),this._modal)n._windowManager.openWindow(this._modal);else if(this._loading)this._loading.then((function(){this._modal.show()}).bind(this));else throw new Error("Modal not created!")},e.prototype.close=function(){if(this._modal)this._modal.close();else throw new Error("Modal not created!")},e.prototype.hide=e.prototype.close,mw.loader.using(["oojs","oojs-ui","oojs-ui-windows"]).then(function(){e.prototype.deps.OO=OO,n.Modal=e,n.ModalButton=o,n._init=l,window.dev.modal=n,l()})})();
