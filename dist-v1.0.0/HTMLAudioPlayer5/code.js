(function(o){"use strict";var y;function _(r){r[0].querySelectorAll(".html5audio:not(.loaded)").forEach(function(a){var n=a.dataset,t=[],f=[];for(var v in n)if(v.startsWith("file")){var M=v.substring(4),N=parseInt(M.substring(1))||(M===""?0:null);N!=null&&(t[N]=n[v])}t=t.filter(function(s){return s});for(var d=0;d<t.length;d++){var O=t[d],i;if(i=n["fileType"+(d>0?"-"+d:"")],!i){var g=t[d],F=g.lastIndexOf("?");F!=-1&&(g=g.substring(0,F));var L=g.lastIndexOf(".");L!=-1&&g.length-(L+1)<=4&&(i=g.substring(L+1))}i&&i.length>0&&(i=="mp3"&&(i="mpeg"),i.startsWith("audio/")||(i="audio/"+i));var m=document.createElement("source");m.src=O,i&&(m.type=i),f.push(m)}if(f.length!=0){var p=n.preload,V=n.download,k=n.options,c={controls:""},h=Number(Number(n.volume).toFixed(1)),w=parseFloat(n.start),T=parseFloat(n.end),l=parseFloat(n.repeatStart),u=parseFloat(n.repeatEnd);if(p!=="auto"&&p!=="metadata"&&(p="none"),c.preload=p,V==="false"&&(c.controlsList="nodownload"),k){var D=["autoplay","loop","muted"];k.split(",").forEach(function(s){s=s.trim(),D.indexOf(s)!==-1&&(c[s]="")})}var e=document.createElement("audio");if(Object.keys(c).forEach(function(s){var W=c[s];e.setAttribute(s,W)}),isNaN(w)||(e.currentTime=w),!isNaN(T)){var P=function(){e.currentTime>=T&&(e.seeking||e.pause(),e.removeEventListener("timeupdate",P))};e.addEventListener("timeupdate",P)}if(!isNaN(l)||!isNaN(u)){(isNaN(l)||l<0)&&(l=0),e.addEventListener("loadedmetadata",function(){(isNaN(u)||u>e.duration)&&(u=e.duration),l==0&&u==e.duration?(e.removeEventListener("timeupdate",A),e.removeEventListener("seeking",C),e.removeEventListener("ended",U),e.setAttribute("loop",""),E=!1):u>e.duration-.25&&e.removeAttribute("loop")});var E=!0,A=function(){E&&(e.paused&&!e.ended||e.currentTime>=u&&(e.currentTime=l))},C=function(){E=e.currentTime<u},U=function(){e.play()};e.addEventListener("ended",U),e.addEventListener("timeupdate",A),e.addEventListener("seeking",C)}Element.prototype.replaceChildren.apply(e,f),e.append(y("text").escape()),h>=0&&h<=1&&(e.volume=h),a.innerHTML="",a.appendChild(e),a.classList.add("loaded")}})}function x(r){var a=o.Message;a.prototype.constructor=o.Message.prototype.constructor;var n={_i18nLoader:r,msg:function(){var t=Array.prototype.slice.call(arguments);if(t.length!==0){var f=t.shift();return new a(this._i18nLoader.getMessages(),f,t)}}};return["setTempLang","setDefaultLang"].forEach(function(t){n[t]=n._i18nLoader[t].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(t){n[t]=n._i18nLoader[t].bind(n)}),n}function I(){var r=new $.Deferred;return o.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(a){var n=a("ext.gadget.store.FandoomUtilsI18nLoader");n.loadMessages("HTMLAudioPlayer5",{}).done(function(t){if(!t){r.resolve(b());return}r.resolve(t)})}).fail(function(a){console.error(a),r.resolve(b())}),r}function b(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var r=new o.Map;r.set({text:"Your browser does not support the &lt;audio&gt; tag."}),o.Message.prototype.escape===void 0&&(o.Message.prototype.escape=o.Message.prototype.escaped);var a={getMessages:function(){return r}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){a[n]=$.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){a[n]=function(){return this}}),a}I().then(function(r){var a=x(r);y=a.msg.bind(a),o.hook("wikipage.content").add(_)})})(window.mediaWiki);
