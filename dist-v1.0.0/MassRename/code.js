mw.loader.using("mediawiki.api",function(){if(window.MassRenameLoaded||!/sysop|bureaucrat|global-admin/.test(mw.config.get("wgUserGroups").join()))return;window.MassRenameLoaded=!0;var n,r,L=3,c=!1,o,l,p,d,u;function h(){return $("<form>").append($("<fieldset>").append($("<p>",{text:n.msg("instructions").plain()}),$("<p>",{text:n.msg("instructions2").plain()}),$("<label>",{for:"redirect-check",text:n.msg("redirect").plain()}).append($("<input>",{type:"checkbox",id:"redirect-check"})),$("<div>",{class:"edit-input-control"}).append($("<label>",{for:"custom-summary"}).append($("<div>").text(n.msg("custom-summary").plain()),$("<input>",{id:"custom-summary"}))),$("<textarea>",{id:"text-rename",placeholder:"old_name new_name"}),$("<div>",{id:"text-error-output",text:n.msg("outputInitial").plain(),append:"<br/>"}))).prop("outerHTML")}function m(){--L===0&&v()}function v(){mw.libs.PowertoolsPlacement.addPortletLink(mw.config.values.skin,{id:"t-mr",href:"#",label:n.msg("title").plain(),tooltip:"MassRename",onClick:b})}function b(){if(r){r.show();return}r=new window.dev.modal.Modal({content:h(),id:"form-mass-rename",size:"medium",title:n.msg("title").escape(),buttons:[{id:"mr1-start",text:n.msg("initiate").escape(),primary:!0,event:"start"},{id:"mr1-pause",text:n.msg("pause").escape(),primary:!0,event:"pause",disabled:!0},{text:n.msg("close").escape(),event:"close"}],events:{pause:g,start:y}}),r.create(),o=$("#form-mass-rename"),l=o.find("#text-rename"),p=o.find("#custom-summary"),d=o.find("#redirect-check"),u=o.find("#text-error-output"),r.show()}function g(){c=!0,r.disableActionButtons("mr1-pause"),r.enableActionButtons("mr1-start")}function y(){c=!1,r.disableActionButtons("mr1-start"),r.enableActionButtons("mr1-pause"),f()}function f(){if(!c){var e=(l.val()||"").split(`
`),t=e[0];t?M(t):(u.append(n.msg("finished").escape()+" "+n.msg("nothingLeftToDo").escape()+"<br/>"),g()),e=e.slice(1,e.length),l.val(e.join(`
`))}}function M(e){if(e.split(" ").length!==2)u.append(n.msg("invalidInput",e).escape()+"<br/>");else{var t=e.split(" ")[0],a=e.split(" ")[1],s={action:"move",from:t,to:a,noredirect:"",reason:p.first().val()||window.massRenameSummary||n.inContentLang().msg("summary").plain()};d.prop("checked")&&delete s.noredirect,new mw.Api().postWithEditToken(s).done(function(i){i.error?(console.error(n.msg("renameFail",t,a).escape()+": "+i.error.code),u.append(n.msg("renameFail",t,a).escape()+": "+i.error.code+"<br/>")):console.log(n.msg("renameDone",t,a).plain())}).fail(function(i){console.error(n.msg("renameFail",t,a).plain()+": "+i),u.append(n.msg("renameFail2",t,a).escape()+"<br/>")})}setTimeout(f,window.massRenameDelay||1e3)}mw.hook("dev.modal").add(m),mw.hook("dev.powertools.placement").add(m),x().then(function(e){n=k(e),m()});function k(e){var t=mw.Message;t.prototype.constructor=mw.Message.prototype.constructor;var a={_i18nLoader:e,msg:function(){var s=Array.prototype.slice.call(arguments);if(s.length!==0){var i=s.shift();return new t(this._i18nLoader.getMessages(),i,s)}}};return["setTempLang","setDefaultLang"].forEach(function(s){a[s]=a._i18nLoader[s].bind(a._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(s){a[s]=a._i18nLoader[s].bind(a)}),a}function x(){var e=new $.Deferred;return mw.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(t){var a=t("ext.gadget.store.FandoomUtilsI18nLoader");a.loadMessages("MassRename",{}).done(function(s){if(!s){e.resolve(w());return}e.resolve(s)})}).fail(function(t){console.error(t),e.resolve(w())}),e}function w(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new mw.Map;e.set({title:"Mass rename",instructions:"Put the name of the page you want to rename, then the new name afterwards with a space in between on each separate line.",instructions2:"For page names with spaces, use underscores instead of spaces.",redirect:"Leave a redirect behind?",summary:"automatic",outputInitial:"Any errors encountered will appear below",initiate:"Initiate",cancel:"Cancel",finished:"Finished!",nothingLeftToDo:"Nothing left to do, or next line is blank.",close:"Close",renameDone:"Successfully renamed $1 to $2!",invalidInput:'The line "$1" is invalid input!',renameFail:"Failed to rename $1 to $2",renameFail2:"Failed to rename $1 to $2!",pause:"Pause","custom-summary":"Reason for moving "}),mw.Message.prototype.escape===void 0&&(mw.Message.prototype.escape=mw.Message.prototype.escaped);var t={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(a){t[a]=$.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(a){t[a]=function(){return this}}),t}});
