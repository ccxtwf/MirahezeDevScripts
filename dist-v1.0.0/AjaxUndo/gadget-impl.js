(function(l){l.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")===null&&l.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/FandoomUtilsI18nLoader/gadget-impl.js"),l.loader.impl(function(){return["ext.gadget.store.AjaxUndo@829d8d0c",function(x,h,y,A){(function(a,o){"use strict";if(window.AjaxUndoLoaded)return;window.AjaxUndoLoaded=!0;var g=o.config.get(["wgArticlePath","wgAction","wgVersion","wgCanonicalSpecialPageName"]),f,c;function s(t){return f.msg(t).plain()}function w(){var t=a(this),e=t.data().url,n=t.data().page,i=/&undo=([^&]*)/.exec(e)[1],d,m=window.AjaxUndoSummary||"";window.AjaxUndoPrompt?d=OO.ui.prompt(s("summaryprompt"),{textInput:{value:m}}):(d=a.Deferred(),d.resolve(m)),d.then(function(r){if(r!==null)return t.empty().append(a.createSpinner({size:"small",type:"inline"}).attr("title",s("undoing")).css("vertical-align","baseline")),c.postWithEditToken({action:"edit",title:n,undo:i,bot:"1",minor:window.AjaxUndoMinor?void 0:"1",summary:r===""?void 0:r})}).done(function(r){r&&(r.edit&&r.edit.result==="Success"?t.text("("+s("undone")+")"):(t.text("("+s("error")+")"),alert(r.error&&r.error.code==="undofailure"?r.error.info:s("unknownerror"))))}).fail(function(r){console.error("[AjaxUndo] Error when undoing edit",r),t.text("("+s("error")+")"),alert(s("unknownerror"))})}function u(t){var e=new URL(t),n=e.searchParams.get("title");return a("<a>",{href:"#ajaxundo","data-url":t,"data-page":decodeURIComponent(n||e.pathname.substring(g.wgArticlePath.replace("$1","").length)),text:s("buttontext"),click:w,title:s("undotitle")})}function L(t){if(f=v(t),c=new o.Api,g.wgAction==="history"&&a(".mw-history-undo > a").length)a(".mw-history-undo > a").each(function(){var e=a(this),n=a(this).prop("href"),i=u(n);e.parent().parent().after(a("<span>").append(i))});else if(a("table.diff").length&&o.util.getParamValue("diff")!==void 0){const e=a("table.diff").find(".diff-ntitle .mw-diff-undo a:first"),n=e.prop("href"),i=u(n);e.parent().after(" (",i,")")}else g.wgCanonicalSpecialPageName==="Contributions"&&a(".mw-contributions-list > li:has(.mw-changeslist-diff)").each(function(){const e=a(this).find(".mw-changeslist-diff").prop("href").replace("?diff=prev&oldid=","?action=edit&undo="),n=u(e);a(this).append(a("<span>").append(" (",n,")"))});o.hook("quickdiff.ready").add(function(){const e=a("#quickdiff-modal table.diff").find(".diff-ntitle .mw-diff-undo a:first"),n=e.prop("href"),i=u(n);e.parent().after(" (",i,")")})}function v(t){var e=o.Message;e.prototype.constructor=o.Message.prototype.constructor;var n={_i18nLoader:t,msg:function(){var i=Array.prototype.slice.call(arguments);if(i.length!==0){var d=i.shift();return new e(this._i18nLoader.getMessages(),d,i)}}};return["setTempLang","setDefaultLang"].forEach(function(i){n[i]=n._i18nLoader[i].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(i){n[i]=n._i18nLoader[i].bind(n)}),n}function U(){var t=new a.Deferred;return o.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(e){var n=e("ext.gadget.store.FandoomUtilsI18nLoader");n.loadMessages("AjaxUndo",{}).done(function(i){if(!i){t.resolve(p());return}t.resolve(i)})}).fail(function(e){console.error(e),t.resolve(p())}),t}function p(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var t=new o.Map;t.set({undoing:"Undoing...",undone:"undone",error:"error",unknownerror:"Error: Unknown result from API.",buttontext:"AJAX Undo",undotitle:"Instantly revert this edit without leaving the page",summaryprompt:"Enter the undo summary to leave when undoing this edit:"}),o.Message.prototype.escape===void 0&&(o.Message.prototype.escape=o.Message.prototype.escaped);var e={getMessages:function(){return t}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){e[n]=a.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){e[n]=function(){return this}}),e}a.when(U(),o.loader.using(["mediawiki.api","mediawiki.user","mediawiki.util","oojs-ui-windows","jquery.spinner"])).then(L)})(h,mediaWiki)},{css:[]},{},{},null]})})(mediaWiki);
