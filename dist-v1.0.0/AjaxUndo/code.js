(function(r,o){"use strict";if(window.AjaxUndoLoaded)return;window.AjaxUndoLoaded=!0;var f=o.config.get(["wgArticlePath","wgAction","wgVersion","wgCanonicalSpecialPageName"]),l,g;function s(t){return l.msg(t).plain()}function h(){var t=r(this),e=t.data().url,n=t.data().page,i=/&undo=([^&]*)/.exec(e)[1],d,p=window.AjaxUndoSummary||"";window.AjaxUndoPrompt?d=OO.ui.prompt(s("summaryprompt"),{textInput:{value:p}}):(d=r.Deferred(),d.resolve(p)),d.then(function(a){if(a!==null)return t.empty().append(r.createSpinner({size:"small",type:"inline"}).attr("title",s("undoing")).css("vertical-align","baseline")),g.postWithEditToken({action:"edit",title:n,undo:i,bot:"1",minor:window.AjaxUndoMinor?void 0:"1",summary:a===""?void 0:a})}).done(function(a){a&&(a.edit&&a.edit.result==="Success"?t.text("("+s("undone")+")"):(t.text("("+s("error")+")"),alert(a.error&&a.error.code==="undofailure"?a.error.info:s("unknownerror"))))}).fail(function(a){console.error("[AjaxUndo] Error when undoing edit",a),t.text("("+s("error")+")"),alert(s("unknownerror"))})}function u(t){var e=new URL(t),n=e.searchParams.get("title");return r("<a>",{href:"#ajaxundo","data-url":t,"data-page":decodeURIComponent(n||e.pathname.substring(f.wgArticlePath.replace("$1","").length)),text:s("buttontext"),click:h,title:s("undotitle")})}function m(t){if(l=L(t),g=new o.Api,f.wgAction==="history"&&r(".mw-history-undo > a").length)r(".mw-history-undo > a").each(function(){var e=r(this),n=r(this).prop("href"),i=u(n);e.parent().parent().after(r("<span>").append(i))});else if(r("table.diff").length&&o.util.getParamValue("diff")!==void 0){const e=r("table.diff").find(".diff-ntitle .mw-diff-undo a:first"),n=e.prop("href"),i=u(n);e.parent().after(" (",i,")")}else f.wgCanonicalSpecialPageName==="Contributions"&&r(".mw-contributions-list > li:has(.mw-changeslist-diff)").each(function(){const e=r(this).find(".mw-changeslist-diff").prop("href").replace("?diff=prev&oldid=","?action=edit&undo="),n=u(e);r(this).append(r("<span>").append(" (",n,")"))});o.hook("quickdiff.ready").add(function(){const e=r("#quickdiff-modal table.diff").find(".diff-ntitle .mw-diff-undo a:first"),n=e.prop("href"),i=u(n);e.parent().after(" (",i,")")})}function L(t){var e=o.Message;e.prototype.constructor=o.Message.prototype.constructor;var n={_i18nLoader:t,msg:function(){var i=Array.prototype.slice.call(arguments);if(i.length!==0){var d=i.shift();return new e(this._i18nLoader.getMessages(),d,i)}}};return["setTempLang","setDefaultLang"].forEach(function(i){n[i]=n._i18nLoader[i].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(i){n[i]=n._i18nLoader[i].bind(n)}),n}function w(){var t=new r.Deferred;return o.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(e){var n=e("ext.gadget.store.FandoomUtilsI18nLoader");n.loadMessages("AjaxUndo",{}).done(function(i){if(!i){t.resolve(c());return}t.resolve(i)})}).fail(function(e){console.error(e),t.resolve(c())}),t}function c(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var t=new o.Map;t.set({undoing:"Undoing...",undone:"undone",error:"error",unknownerror:"Error: Unknown result from API.",buttontext:"AJAX Undo",undotitle:"Instantly revert this edit without leaving the page",summaryprompt:"Enter the undo summary to leave when undoing this edit:"}),o.Message.prototype.escape===void 0&&(o.Message.prototype.escape=o.Message.prototype.escaped);var e={getMessages:function(){return t}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){e[n]=r.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){e[n]=function(){return this}}),e}r.when(w(),o.loader.using(["mediawiki.api","mediawiki.user","mediawiki.util","oojs-ui-windows","jquery.spinner"])).then(m)})(jQuery,mediaWiki);
