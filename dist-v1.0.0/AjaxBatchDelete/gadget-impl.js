(function(a){a.loader.getState("ext.gadget.store.FandoomUiUtilsModal")===null&&a.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/FandoomUiUtilsModal/gadget-impl.js"),a.loader.getState("ext.gadget.store.PowertoolsPlacement")===null&&a.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/PowertoolsPlacement/gadget-impl.js"),a.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")===null&&a.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/FandoomUtilsI18nLoader/gadget-impl.js"),a.loader.impl(function(){return["ext.gadget.store.AjaxBatchDelete@168fdfa5",function(o,A,F,T){a.loader.using("mediawiki.api",function(){"use strict";if(window.AjaxBatchDeleteLoaded||!/sysop|bureaucrat|global-admin/.test(a.config.get("wgUserGroups").join()))return;window.AjaxBatchDeleteLoaded=!0;var c=new a.Api,i,v=3,s,p=!0,l,g,d,m,u;function f(){--v===0&&L()}function L(){a.libs.PowertoolsPlacement.addPortletLink(a.config.values.skin,{id:"t-bd",href:"#",label:i.msg("toolsTitle").plain(),tooltip:"AjaxBatchDelete",onClick:P})}function P(){if(s){s.show();return}s=new window.dev.modal.Modal({content:w(),id:"form-batch-delete",size:"large",title:i.msg("modalTitle").escape(),buttons:[{id:"abd-start",text:i.msg("initiate").escape(),primary:!0,event:"start"},{id:"abd-pause",text:i.msg("pause").escape(),primary:!0,event:"pause",disabled:!0},{id:"abd-add-pages-in-category",text:i.msg("addCategoryContents").escape(),primary:!0,event:"addCategoryContents"}],events:{addCategoryContents:j,pause:x,start:k}}),s.create(),l=o("#form-batch-delete"),u=l.find("#text-error-output"),d=l.find("#text-mass-delete"),g=l.find("#ajax-delete-reason"),m=l.find("#protect-check"),s.show()}function w(){return o("<form>").append(o("<fieldset>").append(o("<div>",{class:"edit-input-controls"}).append(o("<div>",{class:"edit-input-control"}).append(o("<label>",{for:"ajax-delete-reason",text:i.msg("inputReason").plain()}),o("<input>",{type:"text",name:"ajax-delete-reason",id:"ajax-delete-reason"})),o("<div>",{class:"edit-input-control"}).append(o("<label>",{for:"protect-check",text:i.msg("inputProtect").plain()}),o("<input>",{type:"checkbox",id:"protect-check",name:"protect-check"}))),o("<p>",{text:i.msg("inputPages").plain()+":"}),o("<textarea>",{id:"text-mass-delete"}),o("<p>",{text:i.msg("errorsForm").plain()+":"}),o("<div>",{id:"text-error-output"}))).prop("outerHTML")}function x(){p=!0,s.disableActionButtons("abd-pause"),s.enableActionButtons(["abd-start","abd-add-pages-in-category"])}function k(){if(!g.val()){alert(i.msg("stateReason").plain());return}p=!1,s.disableActionButtons(["abd-start","abd-add-pages-in-category"]),s.enableActionButtons("abd-pause"),b()}function b(){if(!p){var e=(d.val()||"").split(`
`),t=e[0];t?C(t,g.val()):(u.append(i.msg("endTitle").escape()+" "+i.msg("endMsg").escape()+"<br />"),x()),e=e.slice(1,e.length),d.val(e.join(`
`))}}function j(){var e=prompt(i.msg("enterCategory").plain()+":");e&&c.get({action:"query",list:"categorymembers",cmtitle:"Category:"+e,cmlimit:5e3}).done(function(t){var n=t.query;for(var r in n.categorymembers)d.val((d.val()||"")+n.categorymembers[r].title+`
`)}).fail(function(t){h("GetContents",e,t)})}function h(e,t,n){u.append(i.msg("error"+e,t,n).escape(),"<br />")}function C(e,t){c.postWithEditToken({action:"delete",watchlist:"preferences",title:e,reason:t,bot:!0}).done(function(){m.prop("checked")&&c.postWithEditToken({action:"protect",expiry:"infinite",protections:"create=sysop",watchlist:"preferences",title:e,reason:t}).fail(function(){h("Protect",e,i.msg("ajaxError").plain())})}).fail(function(n){h("Delete",e,n)}),setTimeout(b,window.batchDeleteDelay||1e3)}a.hook("dev.modal").add(f),a.hook("dev.powertools.placement").add(f),D().then(function(e){i=M(e),f()});function M(e){var t=a.Message;t.prototype.constructor=a.Message.prototype.constructor;var n={_i18nLoader:e,msg:function(){var r=Array.prototype.slice.call(arguments);if(r.length!==0){var U=r.shift();return new t(this._i18nLoader.getMessages(),U,r)}}};return["setTempLang","setDefaultLang"].forEach(function(r){n[r]=n._i18nLoader[r].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(r){n[r]=n._i18nLoader[r].bind(n)}),n}function D(){var e=new o.Deferred;return a.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(t){var n=t("ext.gadget.store.FandoomUtilsI18nLoader");n.loadMessages("AjaxBatchDelete",{}).done(function(r){if(!r){e.resolve(y());return}e.resolve(r)})}).fail(function(t){console.error(t),e.resolve(y())}),e}function y(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new a.Map;e.set({toolsTitle:"Batch Delete",modalTitle:"Ajax Batch Delete",inputReason:"Reason for deleting",inputProtect:"Protect for admin only?",inputPages:"Put the name of each page you want to delete on a separate line",errorsForm:"Any errors encountered will appear below",addCategoryContents:"Add category contents",initiate:"Initiate",stateReason:"Please state a reason!",endTitle:"Finished!",endMsg:"Nothing left to do, or next line is blank.",enterCategory:"Please enter the category name (no category prefix)",errorGetContents:"Failed to get contents of $1: $2",errorDelete:"Failed to delete $1: $2",errorProtect:"Failed to protect $1: $2",pause:"Pause"}),a.Message.prototype.escape===void 0&&(a.Message.prototype.escape=a.Message.prototype.escaped);var t={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){t[n]=o.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){t[n]=function(){return this}}),t}})},{css:['#form-batch-delete #text-mass-delete{height:20em;resize:none;width:100%}#form-batch-delete #text-error-output{background-color:#ffbfbf;color:#000;font-weight:700;width:100%}#form-batch-delete .edit-input-control{display:flex;flex-direction:row;justify-content:flex-start;align-items:flex-start}#form-batch-delete .edit-input-control>label{width:200px;display:inline-block;flex-shrink:1}#form-batch-delete .edit-input-control > input[type="text"]{display:inline-block;flex-grow:2}@media(max-width:500px){#form-batch-delete .edit-input-control{flex-direction:column;justify-content:flex-start;align-items:flex-start}#form-batch-delete .edit-input-control>label{width:100%;display:block;flex-grow:2}#form-batch-delete .edit-input-control > input[type="text"]{width:100%;display:block;flex-grow:2}}']},{},{},null]})})(mediaWiki);
