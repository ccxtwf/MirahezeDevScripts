mw.loader.using("mediawiki.api",function(){"use strict";if(window.AjaxBatchDeleteLoaded||!/sysop|bureaucrat|global-admin/.test(mw.config.get("wgUserGroups").join()))return;window.AjaxBatchDeleteLoaded=!0;var d=new mw.Api,a,y=3,r,l=!0,s,c,i,f,p;function u(){--y===0&&b()}function b(){mw.libs.PowertoolsPlacement.addPortletLink(mw.config.values.skin,{id:"t-bd",href:"#",label:a.msg("toolsTitle").plain(),tooltip:"AjaxBatchDelete",onClick:L})}function L(){if(r){r.show();return}r=new window.dev.modal.Modal({content:v(),id:"form-batch-delete",size:"large",title:a.msg("modalTitle").escape(),buttons:[{id:"abd-start",text:a.msg("initiate").escape(),primary:!0,event:"start"},{id:"abd-pause",text:a.msg("pause").escape(),primary:!0,event:"pause",disabled:!0},{id:"abd-add-pages-in-category",text:a.msg("addCategoryContents").escape(),primary:!0,event:"addCategoryContents"}],events:{addCategoryContents:P,pause:m,start:x}}),r.create(),s=$("#form-batch-delete"),p=s.find("#text-error-output"),i=s.find("#text-mass-delete"),c=s.find("#ajax-delete-reason"),f=s.find("#protect-check"),r.show()}function v(){return $("<form>").append($("<fieldset>").append($("<div>",{class:"edit-input-controls"}).append($("<div>",{class:"edit-input-control"}).append($("<label>",{for:"ajax-delete-reason",text:a.msg("inputReason").plain()}),$("<input>",{type:"text",name:"ajax-delete-reason",id:"ajax-delete-reason"})),$("<div>",{class:"edit-input-control"}).append($("<label>",{for:"protect-check",text:a.msg("inputProtect").plain()}),$("<input>",{type:"checkbox",id:"protect-check",name:"protect-check"}))),$("<p>",{text:a.msg("inputPages").plain()+":"}),$("<textarea>",{id:"text-mass-delete"}),$("<p>",{text:a.msg("errorsForm").plain()+":"}),$("<div>",{id:"text-error-output"}))).prop("outerHTML")}function m(){l=!0,r.disableActionButtons("abd-pause"),r.enableActionButtons(["abd-start","abd-add-pages-in-category"])}function x(){if(!c.val()){alert(a.msg("stateReason").plain());return}l=!1,r.disableActionButtons(["abd-start","abd-add-pages-in-category"]),r.enableActionButtons("abd-pause"),w()}function w(){if(!l){var e=(i.val()||"").split(`
`),t=e[0];t?C(t,c.val()):(p.append(a.msg("endTitle").escape()+" "+a.msg("endMsg").escape()+"<br />"),m()),e=e.slice(1,e.length),i.val(e.join(`
`))}}function P(){var e=prompt(a.msg("enterCategory").plain()+":");e&&d.get({action:"query",list:"categorymembers",cmtitle:"Category:"+e,cmlimit:5e3}).done(function(t){var n=t.query;for(var o in n.categorymembers)i.val((i.val()||"")+n.categorymembers[o].title+`
`)}).fail(function(t){g("GetContents",e,t)})}function g(e,t,n){p.append(a.msg("error"+e,t,n).escape(),"<br />")}function C(e,t){d.postWithEditToken({action:"delete",watchlist:"preferences",title:e,reason:t,bot:!0}).done(function(){f.prop("checked")&&d.postWithEditToken({action:"protect",expiry:"infinite",protections:"create=sysop",watchlist:"preferences",title:e,reason:t}).fail(function(){g("Protect",e,a.msg("ajaxError").plain())})}).fail(function(n){g("Delete",e,n)}),setTimeout(w,window.batchDeleteDelay||1e3)}mw.hook("dev.modal").add(u),mw.hook("dev.powertools.placement").add(u),M().then(function(e){a=k(e),u()});function k(e){var t=mw.Message;t.prototype.constructor=mw.Message.prototype.constructor;var n={_i18nLoader:e,msg:function(){var o=Array.prototype.slice.call(arguments);if(o.length!==0){var A=o.shift();return new t(this._i18nLoader.getMessages(),A,o)}}};return["setTempLang","setDefaultLang"].forEach(function(o){n[o]=n._i18nLoader[o].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(o){n[o]=n._i18nLoader[o].bind(n)}),n}function M(){var e=new $.Deferred;return mw.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(t){var n=t("ext.gadget.store.FandoomUtilsI18nLoader");n.loadMessages("AjaxBatchDelete",{}).done(function(o){if(!o){e.resolve(h());return}e.resolve(o)})}).fail(function(t){console.error(t),e.resolve(h())}),e}function h(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new mw.Map;e.set({toolsTitle:"Batch Delete",modalTitle:"Ajax Batch Delete",inputReason:"Reason for deleting",inputProtect:"Protect for admin only?",inputPages:"Put the name of each page you want to delete on a separate line",errorsForm:"Any errors encountered will appear below",addCategoryContents:"Add category contents",initiate:"Initiate",stateReason:"Please state a reason!",endTitle:"Finished!",endMsg:"Nothing left to do, or next line is blank.",enterCategory:"Please enter the category name (no category prefix)",errorGetContents:"Failed to get contents of $1: $2",errorDelete:"Failed to delete $1: $2",errorProtect:"Failed to protect $1: $2",pause:"Pause"}),mw.Message.prototype.escape===void 0&&(mw.Message.prototype.escape=mw.Message.prototype.escaped);var t={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){t[n]=$.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){t[n]=function(){return this}}),t}});
