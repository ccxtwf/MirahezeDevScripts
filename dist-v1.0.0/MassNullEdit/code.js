(function(o,r){"use strict";if(window.loadedMassNullEdit)return;window.loadedMassNullEdit=!0;var N={backlinks:{name:"backlinks",limit:"bllimit",value:"bltitle"},transclusions:{name:"embeddedin",limit:"eilimit",value:"eititle"},fileusage:{name:"imageusage",limit:"iulimit",value:"iutitle"},prefix:{name:"allpages",limit:"aplimit",value:"apprefix"},category:{name:"categorymembers",limit:"cmlimit",value:"cmtitle"},namespace:{name:"allpages",limit:"aplimit",value:"apnamespace"}},d=r.config.get(["wgCanonicalNamespace","wgCanonicalSpecialPageName","wgFormattedNamespaces","wgNamespaceIds","wgRelevantPageName"]),L={action:"edit",summary:"Null edit (this edit should not be visible)",notminor:!0,prependtext:"",nocreate:!0},i,D=["-2","-1"],k=d.wgFormattedNamespaces[14]+":",w=d.wgFormattedNamespaces[6]+":",y=[],p,g,c,A=!0,x=!1,C,f=null;function b(e){o("#mne-output").prepend(e.parse(),"<br>")}function T(e){var a=e.indexOf(":"),n=e.slice(0,a).toLowerCase().replace(/ /g,"_"),t=e.slice(a+1),s=d.wgNamespaceIds[n];return{namespaceId:s||0,title:s?t:e}}function M(e){var a=p.value.split(`
`);return e=e.filter(function(n){return a.indexOf(n)===-1}),e.length&&(p.value+=e.join(`
`)+`
`),e.length}function S(e){var a={title:e},n=L.postWithEditToken(a);n.always(function(t,s){n.state()==="rejected"&&(t=s);var l=t.error&&t.error.code||"unknown";t.edit&&t.edit.result==="Success"||(l==="ratelimited"?(x=!0,p.value=e+`
`+p.value):(y.push(e),b(i("fail",e,l))))})}function v(){A=!0,x=!1,g.$element.removeClass("processing")}function F(){A=!1,g.$element.addClass("processing"),I()}function I(){if(x&&(b(i("notice-ratelimit")),v(),C=setTimeout(F,3e4)),!(A||p===null)){var e=Number(window.nullEditDelay)||1e3;e<100&&(e*=1e3);var a=p.value.split(`
`),n;do n=a.shift();while(n==="");p.value=a.join(`
`),n?(S(n.trim()),setTimeout(I,e)):(b(i("notice-finished")),M(y),y=[],v())}}function q(e,a,n){var t=[],s=new r.Api({parameters:e});function l(h){if(h&&b(i("notice-error-"+a,n,h)),!h||t.length){var P=M(t);b(i("notice-success-"+a,n,P))}c.$element.removeClass("processing"),c.hide()}function U(h){var P=s.get(h);P.always(function(m,H){P.state()==="rejected"&&(m=H);var z=m.error&&m.error.code||"unknown",R=m.query&&m.query[e.list],$=m["query-continue"];if(R)R.forEach(function(G){t.push(G.title)});else{l(z);return}$&&f===null&&(f=!confirm(i("confirm-big-request",m.limits[e.list]).parse())),$&&!f?U($[e.list]):l()})}c.$element.addClass("processing"),U()}function u(e,a){var n=N[e],t={rawcontinue:""};if(!(!n||!a)){a=a.replace(/_/g," ");var s=a;switch(e){case"namespace":s=a==="0"?i("namespace-main").escape():d.wgFormattedNamespaces[a];break;case"category":a.indexOf(k)!==0?a=k+a:s=s.slice(k.length);break;case"fileusage":a.indexOf(w)!==0?a=w+a:s=s.slice(w.length);break;case"prefix":var l=T(a);t.apnamespace=l.namespaceId,a=l.title;break}t.list=n.name,t[n.value]=a,t[n.limit]="max",q(t,e,s)}}function O(e){var a=o("<p>",{class:"mne-addpages-row"}),n=o("<input>").attr({type:"radio",name:"mode",value:e}),t=o("<input>").attr({type:"text",name:e});return e==="namespace"&&(t=o("<select>").attr("name",e),Object.keys(d.wgFormattedNamespaces).forEach(function(s){if(D.indexOf(s)===-1){var l=document.createElement("option");l.value=s,l.textContent=s==="0"?i("namespace-main").plain():d.wgFormattedNamespaces[s],t.append(l)}})),t.on("change",function(){n.prop("checked",!0)}),a.append(o("<label>").append(n,document.createTextNode(i("addpages-"+e).plain())),t),a}function _(){var e,a=o("<form>").attr("id","mne-mode");Object.keys(N).forEach(function(n){a.append(O(n))}),c.show({title:i("addpages").plain(),content:a,onShow:function(){f=null,e=document.forms["mne-mode"].elements,c.$footer.append(o("<span>").attr("id","mne-processing-msg").text(i("processing").plain()),r.libs.QDmodal.getSpinner())},onHide:function(){f=!0},buttons:[{text:i("addpages").plain(),attr:{id:"mne-addpages-start"},handler:function(){var n=c.$content.find("[name=mode]:checked").val(),t=e[n]&&e[n].value;u(n,t)}},{text:i("cancel").plain(),handler:c.hide.bind(c)}]})}function j(){var e=d.wgRelevantPageName.replace(/_/g," ");if(d.wgCanonicalNamespace==="Category"&&u("category",e),d.wgCanonicalSpecialPageName==="Whatlinkshere"&&(u("backlinks",e),u("transclusions",e),e.indexOf(w)===0&&u("fileusage",e)),d.wgCanonicalSpecialPageName==="Allpages"&&u("namespace",o('form [name="namespace"]').val()),d.wgCanonicalSpecialPageName==="Prefixindex"){var a=o('form [name="prefix"]').val(),n=o('form [name="namespace"]').val(),t="";n!=="0"&&(t+=d.wgFormattedNamespaces[n]+":"),t+=a,u("prefix",t)}}function Q(e){e.preventDefault();var a="<p>"+i("instructions").escape()+'</p><textarea id="mne-input"></textarea><div id="mne-output"><i>'+i("notice-output").escape()+"</i></div>";g.show({title:i("title").plain(),content:a,onShow:function(){p=document.getElementById("mne-input"),v(),g.$footer.append(o("<span>").attr("id","mne-processing-msg").text(i("processing").plain()),r.libs.QDmodal.getSpinner())},onHide:function(){v(),p=null,clearTimeout(C)},buttons:[{text:i("initiate").plain(),attr:{id:"mne-main-start"},handler:F},{text:i("pause").plain(),attr:{id:"mne-main-pause"},handler:v},{text:i("addpages").plain(),handler:_},{text:i("cancel").plain(),handler:g.hide.bind(g)}]}),r.loader.using(["mediawiki.api","mediawiki.user"]).then(function(){L instanceof r.Api||(L=new r.Api({parameters:L})),j()})}function V(){g=new r.libs.QDmodal("mne-main"),c=new r.libs.QDmodal("mne-addpages"),g.$element.addClass("mne-modal"),c.$element.addClass("mne-modal"),r.hook("dev.powertools.placement").add(function(e){e.addPortletLink(r.config.values.skin,{id:"t-mne",href:"#",label:i("title").plain(),tooltip:"MassNullEdit",onClick:Q})})}B().then(function(e){i=W(e),i=i.msg.bind(i),V()});function W(e){var a=r.Message;a.prototype.constructor=r.Message.prototype.constructor;var n={_i18nLoader:e,msg:function(){var t=Array.prototype.slice.call(arguments);if(t.length!==0){var s=t.shift();return new a(this._i18nLoader.getMessages(),s,t)}}};return["setTempLang","setDefaultLang"].forEach(function(t){n[t]=n._i18nLoader[t].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(t){n[t]=n._i18nLoader[t].bind(n)}),n}function B(){var e=new o.Deferred;return r.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(a){var n=a("ext.gadget.store.FandoomUtilsI18nLoader");n.loadMessages("MassNullEdit",{}).done(function(t){if(!t){e.resolve(E());return}e.resolve(t)})}).fail(function(a){console.error(a),e.resolve(E())}),e}function E(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new r.Map;e.set({title:"Mass Null Edit",instructions:"Enter the name of each page to null edit on a separate line. Remember to include the namespace too if it is not in main.","notice-output":"Any notices will appear here","notice-ratelimit":"<b>Rate limited!</b> Waiting 30 seconds before next edit.","notice-finished":"<b>Finished!</b> Any pages with failed edits have been re-added above.","notice-success-backlinks":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} that {{PLURAL:$2|links|link}} to “$1” added.","notice-success-transclusions":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} that {{PLURAL:$2|transcludes|transclude}} “$1” added.","notice-success-fileusage":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} that {{PLURAL:$2|includes|include}} the file “$1” added.","notice-success-prefix":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} with the prefix “$1” added.","notice-success-category":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} from “$1” category added.","notice-success-namespace":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} from “$1” namespace added.","notice-error-backlinks":"<b>API error!</b> Failed to get pages that link to “$1”: <b>$2</b>.","notice-error-transclusions":"<b>API error!</b> Failed to get pages that transclude “$1”: <b>$2</b>.","notice-error-fileusage":"<b>API error!</b> Failed to get pages that include the file “$1”: <b>$2</b>.","notice-error-prefix":"<b>API error!</b> Failed to get pages with the prefix “$1”: <b>$2</b>.","notice-error-category":"<b>API error!</b> Failed to get pages from “$1” category: <b>$2</b>.","notice-error-namespace":"<b>API error!</b> Failed to get pages from “$1” namespace: <b>$2</b>.",cancel:"Cancel",pause:"Pause",initiate:"Start",addpages:"Add pages","addpages-backlinks":"Add pages that link to:","addpages-transclusions":"Add pages that transclude:","addpages-fileusage":"Add pages that include the file:","addpages-prefix":"Add pages with the prefix:","addpages-category":"Add members of category:","addpages-namespace":"Add pages from namespace:","namespace-main":"(Main)",processing:"Processing…","confirm-big-request":"This request will be big (more than $1 pages) and may be slow. Do you want to continue?",success:"Null edit of “$1” successful!",fail:"Failed to null edit “$1”: <b>$2</b>."}),r.Message.prototype.escape===void 0&&(r.Message.prototype.escape=r.Message.prototype.escaped);var a={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){a[n]=o.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){a[n]=function(){return this}}),a}})(jQuery,mediaWiki);
