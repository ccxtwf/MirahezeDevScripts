(function(m){m.loader.getState("ext.gadget.store.FandoomUiUtilsQdmodal")===null&&m.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/FandoomUiUtilsQdmodal/gadget-impl.js"),m.loader.getState("ext.gadget.store.PowertoolsPlacement")===null&&m.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/PowertoolsPlacement/gadget-impl.js"),m.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")===null&&m.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist@1.0.0/FandoomUtilsI18nLoader/gadget-impl.js"),m.loader.impl(function(){return["ext.gadget.store.MassNullEdit@8d6d3944",function(X,R,Y,Z){(function(d,o){"use strict";if(window.loadedMassNullEdit)return;window.loadedMassNullEdit=!0;var F={backlinks:{name:"backlinks",limit:"bllimit",value:"bltitle"},transclusions:{name:"embeddedin",limit:"eilimit",value:"eititle"},fileusage:{name:"imageusage",limit:"iulimit",value:"iutitle"},prefix:{name:"allpages",limit:"aplimit",value:"apprefix"},category:{name:"categorymembers",limit:"cmlimit",value:"cmtitle"},namespace:{name:"allpages",limit:"aplimit",value:"apnamespace"}},r=o.config.get(["wgCanonicalNamespace","wgCanonicalSpecialPageName","wgFormattedNamespaces","wgNamespaceIds","wgRelevantPageName"]),x={action:"edit",summary:"Null edit (this edit should not be visible)",notminor:!0,prependtext:"",nocreate:!0},i,j=["-2","-1"],k=r.wgFormattedNamespaces[14]+":",L=r.wgFormattedNamespaces[6]+":",y=[],p,g,c,P=!0,A=!1,U,b=null;function h(e){d("#mne-output").prepend(e.parse(),"<br>")}function q(e){var a=e.indexOf(":"),n=e.slice(0,a).toLowerCase().replace(/ /g,"_"),t=e.slice(a+1),s=r.wgNamespaceIds[n];return{namespaceId:s||0,title:s?t:e}}function C(e){var a=p.value.split(`
`);return e=e.filter(function(n){return a.indexOf(n)===-1}),e.length&&(p.value+=e.join(`
`)+`
`),e.length}function O(e){var a={title:e},n=x.postWithEditToken(a);n.always(function(t,s){n.state()==="rejected"&&(t=s);var l=t.error&&t.error.code||"unknown";t.edit&&t.edit.result==="Success"||(l==="ratelimited"?(A=!0,p.value=e+`
`+p.value):(y.push(e),h(i("fail",e,l))))})}function v(){P=!0,A=!1,g.$element.removeClass("processing")}function M(){P=!1,g.$element.addClass("processing"),E()}function E(){if(A&&(h(i("notice-ratelimit")),v(),U=setTimeout(M,3e4)),!(P||p===null)){var e=Number(window.nullEditDelay)||1e3;e<100&&(e*=1e3);var a=p.value.split(`
`),n;do n=a.shift();while(n==="");p.value=a.join(`
`),n?(O(n.trim()),setTimeout(E,e)):(h(i("notice-finished")),C(y),y=[],v())}}function T(e,a,n){var t=[],s=new o.Api({parameters:e});function l(w){if(w&&h(i("notice-error-"+a,n,w)),!w||t.length){var $=C(t);h(i("notice-success-"+a,n,$))}c.$element.removeClass("processing"),c.hide()}function S(w){var $=s.get(w);$.always(function(f,G){$.state()==="rejected"&&(f=G);var J=f.error&&f.error.code||"unknown",D=f.query&&f.query[e.list],N=f["query-continue"];if(D)D.forEach(function(K){t.push(K.title)});else{l(J);return}N&&b===null&&(b=!confirm(i("confirm-big-request",f.limits[e.list]).parse())),N&&!b?S(N[e.list]):l()})}c.$element.addClass("processing"),S()}function u(e,a){var n=F[e],t={rawcontinue:""};if(!(!n||!a)){a=a.replace(/_/g," ");var s=a;switch(e){case"namespace":s=a==="0"?i("namespace-main").escape():r.wgFormattedNamespaces[a];break;case"category":a.indexOf(k)!==0?a=k+a:s=s.slice(k.length);break;case"fileusage":a.indexOf(L)!==0?a=L+a:s=s.slice(L.length);break;case"prefix":var l=q(a);t.apnamespace=l.namespaceId,a=l.title;break}t.list=n.name,t[n.value]=a,t[n.limit]="max",T(t,e,s)}}function _(e){var a=d("<p>",{class:"mne-addpages-row"}),n=d("<input>").attr({type:"radio",name:"mode",value:e}),t=d("<input>").attr({type:"text",name:e});return e==="namespace"&&(t=d("<select>").attr("name",e),Object.keys(r.wgFormattedNamespaces).forEach(function(s){if(j.indexOf(s)===-1){var l=document.createElement("option");l.value=s,l.textContent=s==="0"?i("namespace-main").plain():r.wgFormattedNamespaces[s],t.append(l)}})),t.on("change",function(){n.prop("checked",!0)}),a.append(d("<label>").append(n,document.createTextNode(i("addpages-"+e).plain())),t),a}function z(){var e,a=d("<form>").attr("id","mne-mode");Object.keys(F).forEach(function(n){a.append(_(n))}),c.show({title:i("addpages").plain(),content:a,onShow:function(){b=null,e=document.forms["mne-mode"].elements,c.$footer.append(d("<span>").attr("id","mne-processing-msg").text(i("processing").plain()),o.libs.QDmodal.getSpinner())},onHide:function(){b=!0},buttons:[{text:i("addpages").plain(),attr:{id:"mne-addpages-start"},handler:function(){var n=c.$content.find("[name=mode]:checked").val(),t=e[n]&&e[n].value;u(n,t)}},{text:i("cancel").plain(),handler:c.hide.bind(c)}]})}function Q(){var e=r.wgRelevantPageName.replace(/_/g," ");if(r.wgCanonicalNamespace==="Category"&&u("category",e),r.wgCanonicalSpecialPageName==="Whatlinkshere"&&(u("backlinks",e),u("transclusions",e),e.indexOf(L)===0&&u("fileusage",e)),r.wgCanonicalSpecialPageName==="Allpages"&&u("namespace",d('form [name="namespace"]').val()),r.wgCanonicalSpecialPageName==="Prefixindex"){var a=d('form [name="prefix"]').val(),n=d('form [name="namespace"]').val(),t="";n!=="0"&&(t+=r.wgFormattedNamespaces[n]+":"),t+=a,u("prefix",t)}}function W(e){e.preventDefault();var a="<p>"+i("instructions").escape()+'</p><textarea id="mne-input"></textarea><div id="mne-output"><i>'+i("notice-output").escape()+"</i></div>";g.show({title:i("title").plain(),content:a,onShow:function(){p=document.getElementById("mne-input"),v(),g.$footer.append(d("<span>").attr("id","mne-processing-msg").text(i("processing").plain()),o.libs.QDmodal.getSpinner())},onHide:function(){v(),p=null,clearTimeout(U)},buttons:[{text:i("initiate").plain(),attr:{id:"mne-main-start"},handler:M},{text:i("pause").plain(),attr:{id:"mne-main-pause"},handler:v},{text:i("addpages").plain(),handler:z},{text:i("cancel").plain(),handler:g.hide.bind(g)}]}),o.loader.using(["mediawiki.api","mediawiki.user"]).then(function(){x instanceof o.Api||(x=new o.Api({parameters:x})),Q()})}function V(){g=new o.libs.QDmodal("mne-main"),c=new o.libs.QDmodal("mne-addpages"),g.$element.addClass("mne-modal"),c.$element.addClass("mne-modal"),o.hook("dev.powertools.placement").add(function(e){e.addPortletLink(o.config.values.skin,{id:"t-mne",href:"#",label:i("title").plain(),tooltip:"MassNullEdit",onClick:W})})}H().then(function(e){i=B(e),i=i.msg.bind(i),V()});function B(e){var a=o.Message;a.prototype.constructor=o.Message.prototype.constructor;var n={_i18nLoader:e,msg:function(){var t=Array.prototype.slice.call(arguments);if(t.length!==0){var s=t.shift();return new a(this._i18nLoader.getMessages(),s,t)}}};return["setTempLang","setDefaultLang"].forEach(function(t){n[t]=n._i18nLoader[t].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(t){n[t]=n._i18nLoader[t].bind(n)}),n}function H(){var e=new d.Deferred;return o.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(a){var n=a("ext.gadget.store.FandoomUtilsI18nLoader");n.loadMessages("MassNullEdit",{}).done(function(t){if(!t){e.resolve(I());return}e.resolve(t)})}).fail(function(a){console.error(a),e.resolve(I())}),e}function I(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new o.Map;e.set({title:"Mass Null Edit",instructions:"Enter the name of each page to null edit on a separate line. Remember to include the namespace too if it is not in main.","notice-output":"Any notices will appear here","notice-ratelimit":"<b>Rate limited!</b> Waiting 30 seconds before next edit.","notice-finished":"<b>Finished!</b> Any pages with failed edits have been re-added above.","notice-success-backlinks":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} that {{PLURAL:$2|links|link}} to \u201C$1\u201D added.","notice-success-transclusions":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} that {{PLURAL:$2|transcludes|transclude}} \u201C$1\u201D added.","notice-success-fileusage":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} that {{PLURAL:$2|includes|include}} the file \u201C$1\u201D added.","notice-success-prefix":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} with the prefix \u201C$1\u201D added.","notice-success-category":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} from \u201C$1\u201D category added.","notice-success-namespace":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} from \u201C$1\u201D namespace added.","notice-error-backlinks":"<b>API error!</b> Failed to get pages that link to \u201C$1\u201D: <b>$2</b>.","notice-error-transclusions":"<b>API error!</b> Failed to get pages that transclude \u201C$1\u201D: <b>$2</b>.","notice-error-fileusage":"<b>API error!</b> Failed to get pages that include the file \u201C$1\u201D: <b>$2</b>.","notice-error-prefix":"<b>API error!</b> Failed to get pages with the prefix \u201C$1\u201D: <b>$2</b>.","notice-error-category":"<b>API error!</b> Failed to get pages from \u201C$1\u201D category: <b>$2</b>.","notice-error-namespace":"<b>API error!</b> Failed to get pages from \u201C$1\u201D namespace: <b>$2</b>.",cancel:"Cancel",pause:"Pause",initiate:"Start",addpages:"Add pages","addpages-backlinks":"Add pages that link to:","addpages-transclusions":"Add pages that transclude:","addpages-fileusage":"Add pages that include the file:","addpages-prefix":"Add pages with the prefix:","addpages-category":"Add members of category:","addpages-namespace":"Add pages from namespace:","namespace-main":"(Main)",processing:"Processing\u2026","confirm-big-request":"This request will be big (more than $1 pages) and may be slow. Do you want to continue?",success:"Null edit of \u201C$1\u201D successful!",fail:"Failed to null edit \u201C$1\u201D: <b>$2</b>."}),o.Message.prototype.escape===void 0&&(o.Message.prototype.escape=o.Message.prototype.escaped);var a={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){a[n]=d.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){a[n]=function(){return this}}),a}})(R,mediaWiki)},{css:['#mne-main{width:560px}#mne-main #mne-input{border:1px solid #aaa;box-sizing:border-box;height:20em;padding:2px;width:100%}#mne-main #mne-output{background-color:#fdd;border:1px solid #aaa;box-sizing:border-box;color:#111;height:10em;margin-top:5px;overflow:auto;padding:2px;width:100%}#mne-main:not(.processing) #mne-main-pause,#mne-main.processing #mne-main-start{opacity:.6;pointer-events:none}#mne-addpages .mne-addpages-row{padding:4px 0}#mne-addpages .mne-addpages-row>label{margin-right:4px}#mne-addpages .mne-addpages-row > label,#mne-addpages .mne-addpages-row > input[type="text"],#mne-addpages .mne-addpages-row > select{width:100%}#mne-addpages.processing #mne-addpages-start,#mne-addpages.processing>section{opacity:.6;pointer-events:none}.mne-modal .qdmodal-spinner-container{--qdmodal-spinner-size: 40px}.mne-modal #mne-processing-msg{flex-grow:1;text-indent:8px}.mne-modal:not(.processing) .qdmodal-spinner-container,.mne-modal:not(.processing) #mne-processing-msg{display:none}']},{},{},null]})})(mediaWiki);
