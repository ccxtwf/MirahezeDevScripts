(function(f,r,i){"use strict";var o=[],p=1,l=2,h=4,d;function c(a,e,n){var t=n?a+"-short":r.language.convertPlural(e,[a,a+"s",a+"s2"]),s=d.msg(t).plain();return n?s:" "+s}function g(a,e){var n,t,s=[],u=!!(o[a].opts&l);if(n=e%60,t=c("second",n,u),s.unshift(n+t),e=Math.floor(e/60),n=e%60,t=c("minute",n,u),s.unshift(n+t),e=Math.floor(e/60),n=e%24,t=c("hour",n,u),s.unshift(n+t),e=Math.floor(e/24),t=c("day",e,u),s.unshift(e+t),t=s.pop(),o[a].opts&p)for(;s.length&&s[0][0]==="0";)s.shift();o[a].opts&h&&(s=s.filter(function(x){return x[0]!=="0"})),s.length&&(o[a].opts&l?t=s.join(" ")+" "+t:t=s.join(", ")+" "+d.msg("and").plain()+" "+t),o[a].node.text(t)}function m(a){var e=o[a].node.parents(".countdown").first();switch(e.attr("data-end")){case"remove":return e.remove(),!0;case"stop":return g(a,0),!0;case"toggle":var n=e.attr("data-toggle");if(n&&n==="next")return e.next().css("display","inline"),e.css("display","none"),!0;if(n&&i(n).length)return i(n).css("display","inline"),e.css("display","none"),!0;break;case"callback":var t=e.attr("data-callback");if(t&&i.isFunction(f[t]))return g(a,0),f[t].call(e),!0;break}return o[a].countup=!0,g(a,0),!1}function v(){var a=Date.now(),e=[];i.each(o.slice(0),function(t,s){var u=Math.floor((s.date-a)/1e3);u<=0&&!s.countup?m(t)&&e.push(t):g(t,Math.abs(u))});for(var n;(n=e.pop())!==void 0;)o.splice(n,1);o.length&&window.setTimeout(function(){v()},1e3)}function y(a){var e=a.parents(".countdown").first(),n=e.attr("data-options"),t=0;return n&&(/no-leading-zeros/.test(n)&&(t|=p),/short-format/.test(n)&&(t|=l),/no-zeros/.test(n)&&(t|=h)),t}function w(){var a=i("body").find(".countdown:not(.handled)");a.length&&(i("body").find(".nocountdown").css("display","none"),a.css("display","inline").find(".countdowndate").each(function(){var e=i(this),n=new Date(e.text()).valueOf();if(isNaN(n)){e.text(d.msg("bad-date").plain());return}o.push({node:e,opts:y(e),date:n})}),a.addClass("handled"),o.length&&v())}b().done(function(a){d=M(a),r.hook("wikipage.content").add(w)});function M(a){var e=r.Message;e.prototype.constructor=r.Message.prototype.constructor;var n={_i18nLoader:a,msg:function(){var t=Array.prototype.slice.call(arguments);if(t.length!==0){var s=t.shift();return new e(this._i18nLoader.getMessages(),s,t)}}};return["setTempLang","setDefaultLang"].forEach(function(t){n[t]=n._i18nLoader[t].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(t){n[t]=n._i18nLoader[t].bind(n)}),n}function b(){var a=new i.Deferred;return r.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(e){var n=e("ext.gadget.store.FandoomUtilsI18nLoader");n.loadMessages("Countdown",{}).done(function(t){if(!t){a.resolve(L());return}t.useContentLang(),a.resolve(t)})}).fail(function(e){console.error(e),a.resolve(L())}),a}function L(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var a=new r.Map;a.set({and:"and",second:"second",seconds:"seconds",minute:"minute",minutes:"minutes",hour:"hour",hours:"hours",day:"day",days:"days","bad-date":"Invalid Date","second-short":"s","minute-short":"m","hour-short":"h","day-short":"d",seconds2:"seconds",minutes2:"minutes",hours2:"hours",days2:"days"}),r.Message.prototype.escape===void 0&&(r.Message.prototype.escape=r.Message.prototype.escaped);var e={getMessages:function(){return a}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){e[n]=i.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){e[n]=function(){return this}}),e}})(window.countdownTimer=window.countdownTimer||{},mediaWiki,jQuery);
