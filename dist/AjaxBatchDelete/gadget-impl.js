(function(n){n.loader.getState("ext.gadget.store.FandoomUiUtilsModal")===null&&n.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/FandoomUiUtilsModal/gadget-impl.js"),n.loader.getState("ext.gadget.store.PowertoolsPlacement")===null&&n.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/PowertoolsPlacement/gadget-impl.js"),n.loader.impl(function(){return["ext.gadget.store.AjaxBatchDelete@7a05176e",function(o,T,B,E){n.loader.using("mediawiki.api",function(){"use strict";if(window.AjaxBatchDeleteLoaded||!/sysop|bureaucrat|global-admin/.test(n.config.get("wgUserGroups").join()))return;window.AjaxBatchDeleteLoaded=!0;var p=new n.Api,i,L=3,s,g=!0,d,u,c,b,f;function h(){--L===0&&w()}function w(){n.libs.PowertoolsPlacement.addPortletLink(n.config.values.skin,{id:"t-bd",href:"#",label:i.msg("toolsTitle").plain(),tooltip:"AjaxBatchDelete",onClick:P})}function P(){if(s){s.show();return}s=new window.dev.modal.Modal({content:j(),id:"form-batch-delete",size:"large",title:i.msg("modalTitle").escape(),buttons:[{id:"abd-start",text:i.msg("initiate").escape(),primary:!0,event:"start"},{id:"abd-pause",text:i.msg("pause").escape(),primary:!0,event:"pause",disabled:!0},{id:"abd-add-pages-in-category",text:i.msg("addCategoryContents").escape(),primary:!0,event:"addCategoryContents"}],events:{addCategoryContents:D,pause:y,start:k}}),s.create(),d=o("#form-batch-delete"),f=d.find("#text-error-output"),c=d.find("#text-mass-delete"),u=d.find("#ajax-delete-reason"),b=d.find("#protect-check"),s.show()}function j(){return o("<form>").append(o("<fieldset>").append(o("<div>",{class:"edit-input-controls"}).append(o("<div>",{class:"edit-input-control"}).append(o("<label>",{for:"ajax-delete-reason",text:i.msg("inputReason").plain()}),o("<input>",{type:"text",name:"ajax-delete-reason",id:"ajax-delete-reason"})),o("<div>",{class:"edit-input-control"}).append(o("<label>",{for:"protect-check",text:i.msg("inputProtect").plain()}),o("<input>",{type:"checkbox",id:"protect-check",name:"protect-check"}))),o("<p>",{text:i.msg("inputPages").plain()+":"}),o("<textarea>",{id:"text-mass-delete"}),o("<p>",{text:i.msg("errorsForm").plain()+":"}),o("<div>",{id:"text-error-output"}))).prop("outerHTML")}function y(){g=!0,s.disableActionButtons("abd-pause"),s.enableActionButtons(["abd-start","abd-add-pages-in-category"])}function k(){if(!u.val()){alert(i.msg("stateReason").plain());return}g=!1,s.disableActionButtons(["abd-start","abd-add-pages-in-category"]),s.enableActionButtons("abd-pause"),v()}function v(){if(!g){var e=(c.val()||"").split(`
`),t=e[0];t?C(t,u.val()):(f.append(i.msg("endTitle").escape()+" "+i.msg("endMsg").escape()+"<br />"),y()),e=e.slice(1,e.length),c.val(e.join(`
`))}}function D(){var e=prompt(i.msg("enterCategory").plain()+":");e&&p.get({action:"query",list:"categorymembers",cmtitle:"Category:"+e,cmlimit:5e3}).done(function(t){var a=t.query;for(var r in a.categorymembers)c.val((c.val()||"")+a.categorymembers[r].title+`
`)}).fail(function(t){m("GetContents",e,t)})}function m(e,t,a){f.append(i.msg("error"+e,t,a).escape(),"<br />")}function C(e,t){p.postWithEditToken({action:"delete",watchlist:"preferences",title:e,reason:t,bot:!0}).done(function(){b.prop("checked")&&p.postWithEditToken({action:"protect",expiry:"infinite",protections:"create=sysop",watchlist:"preferences",title:e,reason:t}).fail(function(){m("Protect",e,i.msg("ajaxError").plain())})}).fail(function(a){m("Delete",e,a)}),setTimeout(v,window.batchDeleteDelay||1e3)}n.hook("dev.modal").add(h),n.hook("dev.powertools.placement").add(h),A().then(function(e){i=M(e),h()});function M(e){var t=n.Message;t.prototype.constructor=n.Message.prototype.constructor;var a={_i18nLoader:e,msg:function(){var r=Array.prototype.slice.call(arguments);if(r.length!==0){var x=r.shift();return new t(this._i18nLoader.getMessages(),x,r)}}};return["setTempLang","setDefaultLang"].forEach(function(r){a[r]=a._i18nLoader[r].bind(a._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(r){a[r]=a._i18nLoader[r].bind(a)}),a}function A(){var e=new o.Deferred,t=new o.Deferred;function a(){var l=o.Deferred();return n.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(F){l.resolve(F("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(l.reject),l}function r(l){return l.loadMessages("AjaxBatchDelete",{})}function x(l){e.resolve(l)}return t.then(a).then(r).then(x).catch(function(l){console.error(l),e.resolve(U())}),n.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?t.resolve():o.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){t.resolve()}).fail(t.reject),e}function U(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new n.Map;e.set({toolsTitle:"Batch Delete",modalTitle:"Ajax Batch Delete",inputReason:"Reason for deleting",inputProtect:"Protect for admin only?",inputPages:"Put the name of each page you want to delete on a separate line",errorsForm:"Any errors encountered will appear below",addCategoryContents:"Add category contents",initiate:"Initiate",stateReason:"Please state a reason!",endTitle:"Finished!",endMsg:"Nothing left to do, or next line is blank.",enterCategory:"Please enter the category name (no category prefix)",errorGetContents:"Failed to get contents of $1: $2",errorDelete:"Failed to delete $1: $2",errorProtect:"Failed to protect $1: $2",pause:"Pause"}),n.Message.prototype.escape===void 0&&(n.Message.prototype.escape=n.Message.prototype.escaped);var t={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(a){t[a]=o.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(a){t[a]=function(){return this}}),t}})},{css:['#form-batch-delete #text-mass-delete{height:20em;resize:none;width:100%}#form-batch-delete #text-error-output{background-color:#ffbfbf;color:#000;font-weight:700;width:100%}#form-batch-delete .edit-input-control{display:flex;flex-direction:row;justify-content:flex-start;align-items:flex-start}#form-batch-delete .edit-input-control>label{width:200px;display:inline-block;flex-shrink:1}#form-batch-delete .edit-input-control > input[type="text"]{display:inline-block;flex-grow:2}@media(max-width:500px){#form-batch-delete .edit-input-control{flex-direction:column;justify-content:flex-start;align-items:flex-start}#form-batch-delete .edit-input-control>label{width:100%;display:block;flex-grow:2}#form-batch-delete .edit-input-control > input[type="text"]{width:100%;display:block;flex-grow:2}}']},{},{},null]})})(mediaWiki);
