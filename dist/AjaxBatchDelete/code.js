mw.loader.using("mediawiki.api",function(){"use strict";if(window.AjaxBatchDeleteLoaded)return;window.AjaxBatchDeleteLoaded=!0;var l=new mw.Api,n,y=3,r,c=!0,s,u,d,h,p;function g(){--y===0&&v()}function v(){mw.libs.PowertoolsPlacement.addPortletLink(mw.config.values.skin,{id:"t-bd",href:"#",label:n.msg("toolsTitle").plain(),tooltip:"AjaxBatchDelete",onClick:b})}function b(){if(r){r.show();return}r=new window.dev.modal.Modal({content:P(),id:"form-batch-delete",size:"large",title:n.msg("modalTitle").escape(),buttons:[{id:"abd-start",text:n.msg("initiate").escape(),primary:!0,event:"start"},{id:"abd-pause",text:n.msg("pause").escape(),primary:!0,event:"pause",disabled:!0},{id:"abd-add-pages-in-category",text:n.msg("addCategoryContents").escape(),primary:!0,event:"addCategoryContents"}],events:{addCategoryContents:x,pause:w,start:C}}),r.create(),s=$("#form-batch-delete"),p=s.find("#text-error-output"),d=s.find("#text-mass-delete"),u=s.find("#ajax-delete-reason"),h=s.find("#protect-check"),r.show()}function P(){return $("<form>").append($("<fieldset>").append($("<div>",{class:"edit-input-controls"}).append($("<div>",{class:"edit-input-control"}).append($("<label>",{for:"ajax-delete-reason",text:n.msg("inputReason").plain()}),$("<input>",{type:"text",name:"ajax-delete-reason",id:"ajax-delete-reason"})),$("<div>",{class:"edit-input-control"}).append($("<label>",{for:"protect-check",text:n.msg("inputProtect").plain()}),$("<input>",{type:"checkbox",id:"protect-check",name:"protect-check"}))),$("<p>",{text:n.msg("inputPages").plain()+":"}),$("<textarea>",{id:"text-mass-delete"}),$("<p>",{text:n.msg("errorsForm").plain()+":"}),$("<div>",{id:"text-error-output"}))).prop("outerHTML")}function w(){c=!0,r.disableActionButtons("abd-pause"),r.enableActionButtons(["abd-start","abd-add-pages-in-category"])}function C(){if(!u.val()){alert(n.msg("stateReason").plain());return}c=!1,r.disableActionButtons(["abd-start","abd-add-pages-in-category"]),r.enableActionButtons("abd-pause"),L()}function L(){if(!c){var e=(d.val()||"").split(`
`),t=e[0];t?M(t,u.val()):(p.append(n.msg("endTitle").escape()+" "+n.msg("endMsg").escape()+"<br />"),w()),e=e.slice(1,e.length),d.val(e.join(`
`))}}function x(){var e=prompt(n.msg("enterCategory").plain()+":");e&&l.get({action:"query",list:"categorymembers",cmtitle:"Category:"+e,cmlimit:5e3}).done(function(t){var a=t.query;for(var o in a.categorymembers)d.val((d.val()||"")+a.categorymembers[o].title+`
`)}).fail(function(t){f("GetContents",e,t)})}function f(e,t,a){p.append(n.msg("error"+e,t,a).escape(),"<br />")}function M(e,t){l.postWithEditToken({action:"delete",watchlist:"preferences",title:e,reason:t,bot:!0}).done(function(){h.prop("checked")&&l.postWithEditToken({action:"protect",expiry:"infinite",protections:"create=sysop",watchlist:"preferences",title:e,reason:t}).fail(function(){f("Protect",e,n.msg("ajaxError").plain())})}).fail(function(a){f("Delete",e,a)}),setTimeout(L,window.batchDeleteDelay||1e3)}mw.hook("dev.modal").add(g),mw.hook("dev.powertools.placement").add(g),D().then(function(e){n=A(e),g()});function A(e){var t=mw.Message;t.prototype.constructor=mw.Message.prototype.constructor;var a={_i18nLoader:e,msg:function(){var o=Array.prototype.slice.call(arguments);if(o.length!==0){var m=o.shift();return new t(this._i18nLoader.getMessages(),m,o)}}};return["setTempLang","setDefaultLang"].forEach(function(o){a[o]=a._i18nLoader[o].bind(a._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(o){a[o]=a._i18nLoader[o].bind(a)}),a}function D(){var e=new $.Deferred,t=new $.Deferred;function a(){var i=$.Deferred();return mw.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(E){i.resolve(E("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(i.reject),i}function o(i){return i.loadMessages("AjaxBatchDelete",{})}function m(i){e.resolve(i)}return t.then(a).then(o).then(m).catch(function(i){console.error(i),e.resolve(T())}),mw.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?t.resolve():$.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@v0.0.4/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){t.resolve()}).fail(t.reject),e}function T(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new mw.Map;e.set({toolsTitle:"Batch Delete",modalTitle:"Ajax Batch Delete",inputReason:"Reason for deleting",inputProtect:"Protect for admin only?",inputPages:"Put the name of each page you want to delete on a separate line",errorsForm:"Any errors encountered will appear below",addCategoryContents:"Add category contents",initiate:"Initiate",stateReason:"Please state a reason!",endTitle:"Finished!",endMsg:"Nothing left to do, or next line is blank.",enterCategory:"Please enter the category name (no category prefix)",errorGetContents:"Failed to get contents of $1: $2",errorDelete:"Failed to delete $1: $2",errorProtect:"Failed to protect $1: $2",pause:"Pause"}),mw.Message.prototype.escape===void 0&&(mw.Message.prototype.escape=mw.Message.prototype.escaped);var t={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(a){t[a]=$.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(a){t[a]=function(){return this}}),t}});
