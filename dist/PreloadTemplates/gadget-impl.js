(function(o){["edit"].some(function(n){return o.config.get("wgAction")===n})&&o.loader.impl(function(){return["ext.gadget.store.PreloadTemplates@f19a1847",function(n,X,Y,H){(function(){"use strict";var s={primary:"MediaWiki:PreloadTemplates/primary",placeholderPrimary:"(insert boilerplate)",secondary:"MediaWiki:PreloadTemplates/secondary",placeholderSecondary:"(insert template)",subpage:"preload",storageCacheAge:9e5,serverCacheAge:900},h={primary:(window.PreloadTemplates||{}).primary,placeholderPrimary:(window.PreloadTemplates||{}).placeholderPrimary,secondary:(window.PreloadTemplates||{}).secondary,placeholderSecondary:(window.PreloadTemplates||{}).placeholderSecondary,subpage:(window.PreloadTemplates||{}).subpage,storageCacheAge:(window.PreloadTemplates||{}).storageCacheAge,serverCacheAge:(window.PreloadTemplates||{}).serverCacheAge},f,p,v,d=o.config.get(["wgAction","wgFormattedNamespaces"]),k=n("div#wpSummaryLabel"),P=n("div.module_content:first"),J="div.ve-ui-toolbar.ve-ui-positionedTargetToolbar",y="wiki_preload_templates_data_primary",w="wiki_preload_templates_data_secondary",x="wiki_preload_templates_list-pagename_primary",L="wiki_preload_templates_list-pagename_secondary",C="wiki_preload_templates_expiration";if(d.wgAction!=="edit")return;function m(e){return f.msg(e).plain()}function S(e){return e.replace(/<includeonly>(\n)?|(\n)?<\/includeonly>|\s*<noinclude>[^]*?<\/noinclude>/g,"")}function T(e){alert(f.msg("error",'"'+e+'"').plain())}function j(e){localStorage.setItem(y,e.list),localStorage.setItem(w,e.listSecondary),localStorage.setItem(x,e.pagename),localStorage.setItem(L,e.pagenameSecondary),s.storageCacheAge>0&&localStorage.setItem(C,new Date(Date.now()+s.storageCacheAge).getTime())}function E(){localStorage.removeItem(y),localStorage.removeItem(w),localStorage.removeItem(x),localStorage.removeItem(L)}function W(e,r){var t=localStorage.getItem(C),a=localStorage.getItem(x),i=localStorage.getItem(L);return t===null||isNaN(+t)||Date.now()>+t||a!==e||i!==r?(E(),null):[localStorage.getItem(y),localStorage.getItem(w)]}function I(e,r){if(document.selection)e.focus(),window.sel=document.selection.createRange(),window.sel.text=r;else if(e.selectionStart||e.selectionStart===0){var t=e.selectionStart,a=e.selectionEnd;e.value=e.value.substring(0,t)+r+e.value.substring(a,e.value.length)}else e.value+=r}function A(e){var r=(function(){if(typeof window.preloadTemplates_namespace>"u")return d.wgFormattedNamespaces[10];if(typeof d.wgFormattedNamespaces[window.preloadTemplates_namespace]<"u")return d.wgFormattedNamespaces[window.preloadTemplates_namespace];for(var i in d.wgFormattedNamespaces)if(d.wgFormattedNamespaces[i]==window.preloadTemplates_namespace)return d.wgFormattedNamespaces[i];return d.wgFormattedNamespaces[10]})(),t=(function(){return r?r+":":""})(),a=s.subpage==="case-by-case"?t+e:t+e+"/"+s.subpage;n.get(o.util.wikiScript(),{title:a,action:"raw",ctype:"text/plain"}).done(function(i){var l=S(i);if(l===""){T(a);return}var c=document.getElementsByClassName("cke_source"),g=document.getElementById("wpTextbox1"),D=n(".CodeMirror").get(0),G=n(".cm-editor").get(0);if(window.ve&&ve.init&&ve.init.target&&ve.init.target.active)ve.init.target.getSurface().getModel().getFragment().insertContent(l);else if(c.length)I(c[0],l);else if(D){var Q=D.CodeMirror,U=Q.getDoc();U.replaceRange(l,U.getCursor())}else if(G){var N=function(K,u){var b=u.view.state&&u.view.state.selection&&u.view.state.selection.ranges&&u.view.state.selection.ranges[0]||{from:0,to:0};u.view.dispatch({changes:{from:b.from,to:b.to,insert:l},selection:{anchor:b.from}}),u.view.focus(),o.hook("ext.CodeMirror.ready").remove(N)};o.hook("ext.CodeMirror.ready").add(N)}else g?I(g,l):console.warn("[PreloadTemplates] Could not find textbox to bind to")}).fail(function(){T(a)})}function V(e){e===!0||(k.length?k.after(p):P.length&&P.append(p))}function z(e){f=O(e),p=n("<div>",{id:"preload-templates"}),p.append(n("<span>",{text:m("preload")})),v=n("<div>",{id:"pt-help"}).append(n("<a>",{target:"_blank",href:"https://dev.miraheze.org/wiki/PreloadTemplates",title:m("devWiki"),text:"?"})),V()}function M(e,r){return o.html.element("option",{selected:!0,disabled:!0},r||m("choose"))+e.split(`
`).map(function(t){if(t.trim()==="")return"";if(t.indexOf("*")===0){var a=t.substring(1).trim();if(a.indexOf("|")!==-1){var i=a.split("|");return o.html.element("option",{value:i[0].trim()},i[1].trim())}else return o.html.element("option",{value:a},a)}else return o.html.element("option",{disabled:!0},t.trim(""))}).join()}function F(){var e=h.primary||s.primary;p.append(f.msg("error",o.html.element("a",{href:o.util.getUrl(e)},e)).plain(),v)}function B(){if(!(p.find("#pt-list").length>0)){var e=h.primary||s.primary,r=h.secondary||s.secondary,t=W(e,r);if(t!==null){_(t[0],t[1]);return}n.get(o.util.wikiScript(),{title:e,action:"raw",ctype:"text/plain",maxage:s.serverCacheAge,smaxage:s.serverCacheAge}).done(function(a){r&&n.get(o.util.wikiScript(),{title:r,action:"raw",ctype:"text/plain",maxage:s.serverCacheAge,smaxage:s.serverCacheAge}).done(function(i){_(a,i),j({list:a,listSecondary:i,pagename:e,pagenameSecondary:r})}).fail(function(){_(a,"")})}).fail(F)}}function _(e,r){var t=S(e),a=S(r);if(t===""){F();return}var i=n("<select>",{id:"pt-list",title:m("help"),html:M(t,s.placeholderPrimary)}).change(function(){var c=n(this),g=c.val();c.find("option:first-child").prop("selected",!0),A(g)}),l=n("<select>",{id:"pt-list-secondary",title:m("help"),html:a===""?void 0:M(a,s.placeholderSecondary),style:a===""?"display:none;":void 0}).change(function(){var c=n(this),g=c.val();c.find("option:first-child").prop("selected",!0),A(g)});p.append(i,l,v)}function O(e){var r=o.Message;r.prototype.constructor=o.Message.prototype.constructor;var t={_i18nLoader:e,msg:function(){var a=Array.prototype.slice.call(arguments);if(a.length!==0){var i=a.shift();return new r(this._i18nLoader.getMessages(),i,a)}}};return["setTempLang","setDefaultLang"].forEach(function(a){t[a]=t._i18nLoader[a].bind(t._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(a){t[a]=t._i18nLoader[a].bind(t)}),t}function R(){var e=new n.Deferred,r=new n.Deferred;function t(){var l=n.Deferred();return o.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(c){l.resolve(c("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(l.reject),l}function a(l){return l.loadMessages("PreloadTemplates",{})}function i(l){e.resolve(l)}return r.then(t).then(a).then(i).catch(function(l){console.error(l),e.resolve(q())}),o.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?r.resolve():n.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){r.resolve()}).fail(r.reject),e}function q(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new o.Map;e.set({preload:"Preload template:",choose:"(choose)",help:"Select a template to insert its preloaded syntax at the current position",devWiki:"Check the documentation on Dev Wiki",error:"No valid syntax found at $1 or page is missing."}),o.Message.prototype.escape===void 0&&(o.Message.prototype.escape=o.Message.prototype.escaped);var r={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(t){r[t]=n.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(t){r[t]=function(){return this}}),r}n.when(R(),o.loader.using("mediawiki.util")).then(function(e){z(e),d.wgAction==="edit"&&o.hook("wikipage.content").add(B)})})()},{css:["#preload-templates{display:flex;flex-wrap:wrap;margin:0 0 1em;align-items:center;gap:10px}.ve-ui-summaryPanel #preload-templates{margin:.5em 0;font-size:13px}#preload-templates #pt-list,#preload-templates #pt-list-secondary{margin-left:10px;min-width:160px;border-color:var( --theme-border-color );border-radius:3px;background-color:var( --theme-page-background-color );color:var( --theme-page-text-color );cursor:pointer;min-height:34px;padding:.3em .5em}#preload-templates #pt-help{background-color:var( --theme-accent-color );border-radius:50%;color:var( --theme-accent-label-color );display:flex;font-size:16px;height:25px;text-align:center;width:27px;align-items:center;justify-content:center;transition:.25s}#preload-templates #pt-help:hover,#preload-templates #pt-help:focus-within #preload-templates #pt-help:active{background-color:var( --theme-accent-color--hover )}#preload-templates #pt-help a{color:inherit;cursor:pointer;height:100%;width:100%;line-height:1.5}#preload-templates #pt-help a:hover{cursor:pointer;text-decoration:none}"]},{},{},null]})})(mediaWiki);
