(function(n){["edit"].some(function(o){return n.config.get("wgAction")===o})&&n.loader.impl(function(){return["ext.gadget.store.PreloadTemplates@6e5c6882",function(o,X,J,K){(function(){"use strict";var f={primary:"MediaWiki:PreloadTemplates/primary",secondary:"MediaWiki:PreloadTemplates/secondary",subpage:"preload",storageCacheAge:9e5,serverCacheAge:900},g=window.PreloadTemplates||{},l={primary:g.primary||f.primary,secondary:g.secondary||f.secondary,subpage:g.subpage||f.subpage,storageCacheAge:typeof g.storageCacheAge=="number"||!isNaN(g.storageCacheAge)?g.storageCacheAge:f.storageCacheAge,serverCacheAge:typeof g.serverCacheAge=="number"||!isNaN(g.storageCacheAge)?g.serverCacheAge:f.serverCacheAge},v,p,y,d=n.config.get(["wgAction","wgFormattedNamespaces"]),k=o("div#wpSummaryLabel"),A=o("div.module_content:first"),Y="div.ve-ui-toolbar.ve-ui-positionedTargetToolbar",w="wiki_preload_templates_data_primary",x="wiki_preload_templates_data_secondary",L="wiki_preload_templates_list-pagename_primary",b="wiki_preload_templates_list-pagename_secondary",I="wiki_preload_templates_expiration";if(d.wgAction!=="edit")return;function h(e){return v.msg(e).plain()}function C(e){return e.replace(/<includeonly>(\n)?|(\n)?<\/includeonly>|\s*<noinclude>[^]*?<\/noinclude>/g,"")}function T(e){alert(v.msg("error",'"'+e+'"').plain())}function E(e){localStorage.setItem(w,e.list),localStorage.setItem(x,e.listSecondary),localStorage.setItem(L,e.pagename),localStorage.setItem(b,e.pagenameSecondary),l.storageCacheAge>0&&localStorage.setItem(I,new Date(Date.now()+l.storageCacheAge).getTime())}function W(){localStorage.removeItem(w),localStorage.removeItem(x),localStorage.removeItem(L),localStorage.removeItem(b)}function z(e,a){var t=localStorage.getItem(I),r=localStorage.getItem(L),s=localStorage.getItem(b);return t===null||isNaN(+t)||Date.now()>+t||r!==e||s!==a?(W(),null):[localStorage.getItem(w),localStorage.getItem(x)]}function M(e,a){if(document.selection)e.focus(),window.sel=document.selection.createRange(),window.sel.text=a;else if(e.selectionStart||e.selectionStart===0){var t=e.selectionStart,r=e.selectionEnd;e.value=e.value.substring(0,t)+a+e.value.substring(r,e.value.length)}else e.value+=a}function P(e){var a=(function(){if(typeof window.preloadTemplates_namespace>"u")return d.wgFormattedNamespaces[10];if(typeof d.wgFormattedNamespaces[window.preloadTemplates_namespace]<"u")return d.wgFormattedNamespaces[window.preloadTemplates_namespace];for(var s in d.wgFormattedNamespaces)if(d.wgFormattedNamespaces[s]==window.preloadTemplates_namespace)return d.wgFormattedNamespaces[s];return d.wgFormattedNamespaces[10]})(),t=(function(){return a?a+":":""})(),r=l.subpage==="case-by-case"?t+e:t+e+"/"+l.subpage;o.get(n.util.wikiScript(),{title:r,action:"raw",ctype:"text/plain",maxage:0,smaxage:0}).done(function(s){var i=C(s);if(i===""){T(r);return}var c=document.getElementsByClassName("cke_source"),u=document.getElementById("wpTextbox1"),U=o(".CodeMirror").get(0),H=o(".cm-editor").get(0);if(window.ve&&ve.init&&ve.init.target&&ve.init.target.active)ve.init.target.getSurface().getModel().getFragment().insertContent(i);else if(c.length)M(c[0],i);else if(U){var Q=U.CodeMirror,D=Q.getDoc();D.replaceRange(i,D.getCursor())}else if(H){var j=function(Z,m){var S=m.view.state&&m.view.state.selection&&m.view.state.selection.ranges&&m.view.state.selection.ranges[0]||{from:0,to:0};m.view.dispatch({changes:{from:S.from,to:S.to,insert:i},selection:{anchor:S.from}}),m.view.focus(),n.hook("ext.CodeMirror.ready").remove(j)};n.hook("ext.CodeMirror.ready").add(j)}else u?M(u,i):console.warn("[PreloadTemplates] Could not find textbox to bind to")}).fail(function(){T(r)})}function V(e){e===!0||(k.length?k.after(p):A.length&&A.append(p))}function B(e){v=R(e),p=o("<div>",{id:"preload-templates"}),p.append(o("<span>",{text:h("preload")})),y=o("<div>",{id:"pt-help"}).append(o("<a>",{target:"_blank",href:"https://dev.miraheze.org/wiki/PreloadTemplates",title:h("devWiki"),text:"?"})),V()}function N(e){return n.html.element("option",{selected:!0,disabled:!0},h("choose"))+e.split(`
`).map(function(a){if(a.trim()==="")return"";if(a.indexOf("*")===0){var t=a.substring(1).trim();if(t.indexOf("|")!==-1){var r=t.split("|");return n.html.element("option",{value:r[0].trim()},r[1].trim())}else return n.html.element("option",{value:t},t)}else return n.html.element("option",{disabled:!0},a.trim(""))}).join()}function F(){var e=l.primary;p.append(v.msg("error",n.html.element("a",{href:n.util.getUrl(e)},e)).plain(),y)}function O(){if(!(p.find("#pt-list").length>0)){var e=l.primary,a=l.secondary,t=z(e,a);if(t!==null){_(t[0],t[1]);return}o.get(n.util.wikiScript(),{title:e,action:"raw",ctype:"text/plain",maxage:l.serverCacheAge,smaxage:l.serverCacheAge}).done(function(r){a&&o.get(n.util.wikiScript(),{title:a,action:"raw",ctype:"text/plain",maxage:l.serverCacheAge,smaxage:l.serverCacheAge}).done(function(s){_(r,s),E({list:r,listSecondary:s,pagename:e,pagenameSecondary:a})}).fail(function(){_(r,"")})}).fail(F)}}function _(e,a){var t=C(e),r=C(a);if(t===""){F();return}var s=o("<select>",{id:"pt-list",title:h("help"),html:N(t)}).change(function(){var c=o(this),u=c.val();c.find("option:first-child").prop("selected",!0),P(u)}),i=o("<select>",{id:"pt-list-secondary",title:h("help"),html:r===""?void 0:N(r),style:r===""?"display:none;":void 0}).change(function(){var c=o(this),u=c.val();c.find("option:first-child").prop("selected",!0),P(u)});p.append(s,i,y)}function R(e){var a=n.Message;a.prototype.constructor=n.Message.prototype.constructor;var t={_i18nLoader:e,msg:function(){var r=Array.prototype.slice.call(arguments);if(r.length!==0){var s=r.shift();return new a(this._i18nLoader.getMessages(),s,r)}}};return["setTempLang","setDefaultLang"].forEach(function(r){t[r]=t._i18nLoader[r].bind(t._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(r){t[r]=t._i18nLoader[r].bind(t)}),t}function q(){var e=new o.Deferred,a=new o.Deferred;function t(){var i=o.Deferred();return n.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(c){i.resolve(c("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(i.reject),i}function r(i){return i.loadMessages("PreloadTemplates",{})}function s(i){e.resolve(i)}return a.then(t).then(r).then(s).catch(function(i){console.error(i),e.resolve(G())}),n.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?a.resolve():o.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@v0.0.4/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){a.resolve()}).fail(a.reject),e}function G(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new n.Map;e.set({preload:"Preload template:",choose:"(choose)",help:"Select a template to insert its preloaded syntax at the current position",devWiki:"Check the documentation on Dev Wiki",error:"No valid syntax found at $1 or page is missing."}),n.Message.prototype.escape===void 0&&(n.Message.prototype.escape=n.Message.prototype.escaped);var a={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(t){a[t]=o.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(t){a[t]=function(){return this}}),a}o.when(q(),n.loader.using("mediawiki.util")).then(function(e){B(e),d.wgAction==="edit"&&n.hook("wikipage.content").add(O)})})()},{css:["#preload-templates{display:flex;flex-wrap:wrap;margin:0 0 1em;align-items:center;gap:10px}.ve-ui-summaryPanel #preload-templates{margin:.5em 0;font-size:13px}#preload-templates #pt-list,#preload-templates #pt-list-secondary{margin-left:10px;min-width:160px;border-color:var( --theme-border-color );border-radius:3px;background-color:var( --theme-page-background-color );color:var( --theme-page-text-color );cursor:pointer;min-height:34px;padding:.3em .5em}#preload-templates #pt-help{background-color:var( --theme-accent-color );border-radius:50%;color:var( --theme-accent-label-color );display:flex;font-size:16px;height:25px;text-align:center;width:27px;align-items:center;justify-content:center;transition:.25s}#preload-templates #pt-help:hover,#preload-templates #pt-help:focus-within #preload-templates #pt-help:active{background-color:var( --theme-accent-color--hover )}#preload-templates #pt-help a{color:inherit;cursor:pointer;height:100%;width:100%;line-height:1.5}#preload-templates #pt-help a:hover{cursor:pointer;text-decoration:none}"]},{},{},null]})})(mediaWiki);
