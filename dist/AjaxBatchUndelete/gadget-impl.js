(function(t){["sysop","bureaucrat","global-admin"].some(function(a){return(t.config.get("wgUserRights")||[]).indexOf(a)>-1})&&(t.loader.getState("ext.gadget.store.FandoomUiUtilsModal")===null&&t.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@1bb78aaab64521129863a64533a7a15f4a77738d/dist/FandoomUiUtilsModal/gadget-impl.js"),t.loader.getState("ext.gadget.store.PowertoolsPlacement")===null&&t.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@1bb78aaab64521129863a64533a7a15f4a77738d/dist/PowertoolsPlacement/gadget-impl.js"),t.loader.impl(function(){return["ext.gadget.store.AjaxBatchUndelete@0be644b7",function(a,k,B,F){t.loader.using("mediawiki.api",function(){"use strict";if(window.AjaxBatchUndeleteLoaded)return;window.AjaxBatchUndeleteLoaded=!0;var o,v=3,i,u=!0,d,g,p,c;function f(){--v===0&&L()}function L(){t.libs.PowertoolsPlacement.addPortletLink(t.config.values.skin,{id:"t-bud",href:"#",label:o.msg("toolsTitle").plain(),tooltip:"AjaxBatchUndelete",onClick:x})}function x(){if(i){i.show();return}i=new window.dev.modal.Modal({content:U(),id:"form-batch-undelete",size:"medium",title:o.msg("modalTitle").escape(),buttons:[{id:"abu-start",text:o.msg("initiate").escape(),primary:!0,event:"start"},{id:"abu-pause",text:o.msg("pause").escape(),primary:!0,event:"pause",disabled:!0},{text:o.msg("close").escape(),event:"close"}],events:{pause:b,start:P}}),i.create(),d=a("#form-batch-undelete"),g=d.find("#undelete-reason"),p=d.find("#text-batch-undelete"),c=d.find("#text-error-output"),i.show()}function U(){return a("<form>").append(a("<fieldset>").append(a("<div>",{class:"edit-input-controls"}).append(a("<label>",{for:"undelete-reason",text:o.msg("inputReason").plain()}),a("<input>",{type:"text",name:"undelete-reason",id:"undelete-reason"})),a("<p>",{text:o.msg("inputPages").plain()+":"}),a("<textarea>",{id:"text-batch-undelete"}),a("<p>",{text:o.msg("errorsForm").plain()}),a("<div>",{id:"text-error-output"}))).prop("outerHTML")}function b(){u=!0,i.disableActionButtons("abu-pause"),i.enableActionButtons("abu-start")}function P(){if(!g.val()){alert(o.msg("stateReason").plain());return}u=!1,i.disableActionButtons("abu-start"),i.enableActionButtons("abu-pause"),m()}function m(){if(!u){var e=p.val().split(`
`),s=e[0];s?w(s,g.val()):(c.append(o.msg("endMsg").escape()+"<br/>"),b()),e=e.slice(1,e.length),p.val(e.join(`
`))}}function w(e,s){new t.Api().postWithEditToken({format:"json",action:"undelete",watchlist:"preferences",timestamps:"",title:e,reason:s}).done(function(n){n.error?(console.log(o.msg("failure").escape()+" "+e+": "+n.error.code),c.append(o.msg("failure").escape()+" "+e+": "+n.error.code+"<br/>")):console.log(o.msg("success",e).escape())}).fail(function(){console.log(o.msg("failure").escape()+" "+e),c.append(o.msg("failure").escape()+" "+e+"<br/>")}),setTimeout(m,window.batchUndeleteDelay||1e3)}t.hook("dev.modal").add(f),t.hook("dev.powertools.placement").add(f),M().then(function(e){o=y(e),f()});function y(e){var s=t.Message;s.prototype.constructor=t.Message.prototype.constructor;var n={_i18nLoader:e,msg:function(){var r=Array.prototype.slice.call(arguments);if(r.length!==0){var h=r.shift();return new s(this._i18nLoader.getMessages(),h,r)}}};return["setTempLang","setDefaultLang"].forEach(function(r){n[r]=n._i18nLoader[r].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(r){n[r]=n._i18nLoader[r].bind(n)}),n}function M(){var e=new a.Deferred,s=new a.Deferred;function n(){var l=a.Deferred();return t.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(A){l.resolve(A("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(l.reject),l}function r(l){return l.loadMessages("AjaxBatchUndelete",{})}function h(l){e.resolve(l)}return s.then(n).then(r).then(h).catch(function(l){console.error(l),e.resolve(j())}),t.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?s.resolve():a.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@1bb78aaab64521129863a64533a7a15f4a77738d/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){s.resolve()}).fail(s.reject),e}function j(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new t.Map;e.set({modalTitle:"Ajax Batch Undelete",endMsg:"Done! Nothing left to do, or next line is blank.",inputReason:"Reason for recovery:",inputPages:"Put the name of each page you want to undelete on a separate line",errorsForm:"Any errors encountered will appear below:",close:"Close",initiate:"Initiate",stateReason:"Please state a reason!",success:"Recovery of $1 successful!",failure:"Failed to recover",toolsTitle:"Batch Undelete",pause:"Pause"}),t.Message.prototype.escape===void 0&&(t.Message.prototype.escape=t.Message.prototype.escaped);var s={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){s[n]=a.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){s[n]=function(){return this}}),s}})},{css:["#form-batch-undelete #text-batch-undelete{height:20em;resize:none;width:100%}#form-batch-undelete #text-error-output{background-color:#ffbfbf;color:#000;font-weight:700;width:100%}#form-batch-undelete .edit-input-controls>*{display:block;width:100%}"]},{},{},null]}))})(mediaWiki);
