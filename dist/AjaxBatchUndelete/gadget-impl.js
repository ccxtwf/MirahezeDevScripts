(function(t){t.loader.getState("ext.gadget.store.FandoomUiUtilsModal")===null&&t.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/FandoomUiUtilsModal/gadget-impl.js"),t.loader.getState("ext.gadget.store.PowertoolsPlacement")===null&&t.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/PowertoolsPlacement/gadget-impl.js"),t.loader.impl(function(){return["ext.gadget.store.AjaxBatchUndelete@11465903",function(s,k,B,F){t.loader.using("mediawiki.api",function(){"use strict";if(window.AjaxBatchUndeleteLoaded||!/sysop|bureaucrat|global-admin/.test(t.config.get("wgUserGroups").join()))return;window.AjaxBatchUndeleteLoaded=!0;var a,v=3,i,u=!0,d,g,p,c;function f(){--v===0&&L()}function L(){t.libs.PowertoolsPlacement.addPortletLink(t.config.values.skin,{id:"t-bud",href:"#",label:a.msg("toolsTitle").plain(),tooltip:"AjaxBatchUndelete",onClick:x})}function x(){if(i){i.show();return}i=new window.dev.modal.Modal({content:U(),id:"form-batch-undelete",size:"medium",title:a.msg("modalTitle").escape(),buttons:[{id:"abu-start",text:a.msg("initiate").escape(),primary:!0,event:"start"},{id:"abu-pause",text:a.msg("pause").escape(),primary:!0,event:"pause",disabled:!0},{text:a.msg("close").escape(),event:"close"}],events:{pause:m,start:P}}),i.create(),d=s("#form-batch-undelete"),g=d.find("#undelete-reason"),p=d.find("#text-batch-undelete"),c=d.find("#text-error-output"),i.show()}function U(){return s("<form>").append(s("<fieldset>").append(s("<div>",{class:"edit-input-controls"}).append(s("<label>",{for:"undelete-reason",text:a.msg("inputReason").plain()}),s("<input>",{type:"text",name:"undelete-reason",id:"undelete-reason"})),s("<p>",{text:a.msg("inputPages").plain()+":"}),s("<textarea>",{id:"text-batch-undelete"}),s("<p>",{text:a.msg("errorsForm").plain()}),s("<div>",{id:"text-error-output"}))).prop("outerHTML")}function m(){u=!0,i.disableActionButtons("abu-pause"),i.enableActionButtons("abu-start")}function P(){if(!g.val()){alert(a.msg("stateReason").plain());return}u=!1,i.disableActionButtons("abu-start"),i.enableActionButtons("abu-pause"),b()}function b(){if(!u){var e=p.val().split(`
`),o=e[0];o?w(o,g.val()):(c.append(a.msg("endMsg").escape()+"<br/>"),m()),e=e.slice(1,e.length),p.val(e.join(`
`))}}function w(e,o){new t.Api().postWithEditToken({format:"json",action:"undelete",watchlist:"preferences",timestamps:"",title:e,reason:o}).done(function(n){n.error?(console.log(a.msg("failure").escape()+" "+e+": "+n.error.code),c.append(a.msg("failure").escape()+" "+e+": "+n.error.code+"<br/>")):console.log(a.msg("success",e).escape())}).fail(function(){console.log(a.msg("failure").escape()+" "+e),c.append(a.msg("failure").escape()+" "+e+"<br/>")}),setTimeout(b,window.batchUndeleteDelay||1e3)}t.hook("dev.modal").add(f),t.hook("dev.powertools.placement").add(f),y().then(function(e){a=j(e),f()});function j(e){var o=t.Message;o.prototype.constructor=t.Message.prototype.constructor;var n={_i18nLoader:e,msg:function(){var r=Array.prototype.slice.call(arguments);if(r.length!==0){var h=r.shift();return new o(this._i18nLoader.getMessages(),h,r)}}};return["setTempLang","setDefaultLang"].forEach(function(r){n[r]=n._i18nLoader[r].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(r){n[r]=n._i18nLoader[r].bind(n)}),n}function y(){var e=new s.Deferred,o=new s.Deferred;function n(){var l=s.Deferred();return t.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(A){l.resolve(A("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(l.reject),l}function r(l){return l.loadMessages("AjaxBatchUndelete",{})}function h(l){e.resolve(l)}return o.then(n).then(r).then(h).catch(function(l){console.error(l),e.resolve(M())}),t.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?o.resolve():s.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){o.resolve()}).fail(o.reject),e}function M(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new t.Map;e.set({modalTitle:"Ajax Batch Undelete",endMsg:"Done! Nothing left to do, or next line is blank.",inputReason:"Reason for recovery:",inputPages:"Put the name of each page you want to undelete on a separate line",errorsForm:"Any errors encountered will appear below:",close:"Close",initiate:"Initiate",stateReason:"Please state a reason!",success:"Recovery of $1 successful!",failure:"Failed to recover",toolsTitle:"Batch Undelete",pause:"Pause"}),t.Message.prototype.escape===void 0&&(t.Message.prototype.escape=t.Message.prototype.escaped);var o={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){o[n]=s.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){o[n]=function(){return this}}),o}})},{css:["#form-batch-undelete #text-batch-undelete{height:20em;resize:none;width:100%}#form-batch-undelete #text-error-output{background-color:#ffbfbf;color:#000;font-weight:700;width:100%}#form-batch-undelete .edit-input-controls>*{display:block;width:100%}"]},{},{},null]})})(mediaWiki);
