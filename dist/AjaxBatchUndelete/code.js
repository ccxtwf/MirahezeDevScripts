mw.loader.using("mediawiki.api",function(){"use strict";if(window.AjaxBatchUndeleteLoaded)return;window.AjaxBatchUndeleteLoaded=!0;var n,w=3,s,u=!0,i,d,c,l;function p(){--w===0&&L()}function L(){mw.libs.PowertoolsPlacement.addPortletLink(mw.config.values.skin,{id:"t-bud",href:"#",label:n.msg("toolsTitle").plain(),tooltip:"AjaxBatchUndelete",onClick:h})}function h(){if(s){s.show();return}s=new window.dev.modal.Modal({content:v(),id:"form-batch-undelete",size:"medium",title:n.msg("modalTitle").escape(),buttons:[{id:"abu-start",text:n.msg("initiate").escape(),primary:!0,event:"start"},{id:"abu-pause",text:n.msg("pause").escape(),primary:!0,event:"pause",disabled:!0},{text:n.msg("close").escape(),event:"close"}],events:{pause:f,start:b}}),s.create(),i=$("#form-batch-undelete"),d=i.find("#undelete-reason"),c=i.find("#text-batch-undelete"),l=i.find("#text-error-output"),s.show()}function v(){return $("<form>").append($("<fieldset>").append($("<div>",{class:"edit-input-controls"}).append($("<label>",{for:"undelete-reason",text:n.msg("inputReason").plain()}),$("<input>",{type:"text",name:"undelete-reason",id:"undelete-reason"})),$("<p>",{text:n.msg("inputPages").plain()+":"}),$("<textarea>",{id:"text-batch-undelete"}),$("<p>",{text:n.msg("errorsForm").plain()}),$("<div>",{id:"text-error-output"}))).prop("outerHTML")}function f(){u=!0,s.disableActionButtons("abu-pause"),s.enableActionButtons("abu-start")}function b(){if(!d.val()){alert(n.msg("stateReason").plain());return}u=!1,s.disableActionButtons("abu-start"),s.enableActionButtons("abu-pause"),m()}function m(){if(!u){var e=c.val().split(`
`),a=e[0];a?M(a,d.val()):(l.append(n.msg("endMsg").escape()+"<br/>"),f()),e=e.slice(1,e.length),c.val(e.join(`
`))}}function M(e,a){new mw.Api().postWithEditToken({format:"json",action:"undelete",watchlist:"preferences",timestamps:"",title:e,reason:a}).done(function(t){t.error?(console.log(n.msg("failure").escape()+" "+e+": "+t.error.code),l.append(n.msg("failure").escape()+" "+e+": "+t.error.code+"<br/>")):console.log(n.msg("success",e).escape())}).fail(function(){console.log(n.msg("failure").escape()+" "+e),l.append(n.msg("failure").escape()+" "+e+"<br/>")}),setTimeout(m,window.batchUndeleteDelay||1e3)}mw.hook("dev.modal").add(p),mw.hook("dev.powertools.placement").add(p),A().then(function(e){n=P(e),p()});function P(e){var a=mw.Message;a.prototype.constructor=mw.Message.prototype.constructor;var t={_i18nLoader:e,msg:function(){var o=Array.prototype.slice.call(arguments);if(o.length!==0){var g=o.shift();return new a(this._i18nLoader.getMessages(),g,o)}}};return["setTempLang","setDefaultLang"].forEach(function(o){t[o]=t._i18nLoader[o].bind(t._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(o){t[o]=t._i18nLoader[o].bind(t)}),t}function A(){var e=new $.Deferred,a=new $.Deferred;function t(){var r=$.Deferred();return mw.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(x){r.resolve(x("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(r.reject),r}function o(r){return r.loadMessages("AjaxBatchUndelete",{})}function g(r){e.resolve(r)}return a.then(t).then(o).then(g).catch(function(r){console.error(r),e.resolve(T())}),mw.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?a.resolve():$.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@v0.0.5/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){a.resolve()}).fail(a.reject),e}function T(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new mw.Map;e.set({modalTitle:"Ajax Batch Undelete",endMsg:"Done! Nothing left to do, or next line is blank.",inputReason:"Reason for recovery:",inputPages:"Put the name of each page you want to undelete on a separate line",errorsForm:"Any errors encountered will appear below:",close:"Close",initiate:"Initiate",stateReason:"Please state a reason!",success:"Recovery of $1 successful!",failure:"Failed to recover",toolsTitle:"Batch Undelete",pause:"Pause"}),mw.Message.prototype.escape===void 0&&(mw.Message.prototype.escape=mw.Message.prototype.escaped);var a={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(t){a[t]=$.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(t){a[t]=function(){return this}}),a}});
