(function(t,o){"use strict";if(window.AjaxUndoLoaded)return;window.AjaxUndoLoaded=!0;var f=o.config.get(["wgArticlePath","wgAction","wgVersion","wgCanonicalSpecialPageName"]),g,c;function d(r){return g.msg(r).plain()}function p(){var r=t(this),e=r.data().url,n=r.data().page,i=/&undo=([^&]*)/.exec(e)[1],u,s=window.AjaxUndoSummary||"";window.AjaxUndoPrompt?u=OO.ui.prompt(d("summaryprompt"),{textInput:{value:s}}):(u=t.Deferred(),u.resolve(s)),u.then(function(a){if(a!==null)return r.empty().append(t.createSpinner({size:"small",type:"inline"}).attr("title",d("undoing")).css("vertical-align","baseline")),c.postWithEditToken({action:"edit",title:n,undo:i,bot:"1",minor:window.AjaxUndoMinor?void 0:"1",summary:a===""?void 0:a})}).done(function(a){a&&(a.edit&&a.edit.result==="Success"?r.text("("+d("undone")+")"):(r.text("("+d("error")+")"),alert(a.error&&a.error.code==="undofailure"?a.error.info:d("unknownerror"))))}).fail(function(a){console.error("[AjaxUndo] Error when undoing edit",a),r.text("("+d("error")+")"),alert(d("unknownerror"))})}function l(r){var e=new URL(r),n=e.searchParams.get("title");return t("<a>",{href:"#ajaxundo","data-url":r,"data-page":decodeURIComponent(n||e.pathname.substring(f.wgArticlePath.replace("$1","").length)),text:d("buttontext"),click:p,title:d("undotitle")})}function h(r){if(g=L(r),c=new o.Api,f.wgAction==="history"&&t(".mw-history-undo > a").length)t(".mw-history-undo > a").each(function(){var e=t(this),n=t(this).prop("href"),i=l(n);e.parent().parent().after(t("<span>").append(i))});else if(t("table.diff").length&&o.util.getParamValue("diff")!==void 0){const e=t("table.diff").find(".diff-ntitle .mw-diff-undo a:first"),n=e.prop("href"),i=l(n);e.parent().after(" (",i,")")}else f.wgCanonicalSpecialPageName==="Contributions"&&t(".mw-contributions-list > li:has(.mw-changeslist-diff)").each(function(){const e=t(this).find(".mw-changeslist-diff").prop("href").replace("?diff=prev&oldid=","?action=edit&undo="),n=l(e);t(this).append(t("<span>").append(" (",n,")"))});o.hook("quickdiff.ready").add(function(){const e=t("#quickdiff-modal table.diff").find(".diff-ntitle .mw-diff-undo a:first"),n=e.prop("href"),i=l(n);e.parent().after(" (",i,")")})}function L(r){var e=o.Message;e.prototype.constructor=o.Message.prototype.constructor;var n={_i18nLoader:r,msg:function(){var i=Array.prototype.slice.call(arguments);if(i.length!==0){var u=i.shift();return new e(this._i18nLoader.getMessages(),u,i)}}};return["setTempLang","setDefaultLang"].forEach(function(i){n[i]=n._i18nLoader[i].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(i){n[i]=n._i18nLoader[i].bind(n)}),n}function m(){var r=new t.Deferred,e=new t.Deferred;function n(){var s=t.Deferred();return o.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(a){s.resolve(a("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(s.reject),s}function i(s){return s.loadMessages("AjaxUndo",{})}function u(s){r.resolve(s)}return e.then(n).then(i).then(u).catch(function(s){console.error(s),r.resolve(w())}),o.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?e.resolve():t.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@v0.0.5/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){e.resolve()}).fail(e.reject),r}function w(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var r=new o.Map;r.set({undoing:"Undoing...",undone:"undone",error:"error",unknownerror:"Error: Unknown result from API.",buttontext:"AJAX Undo",undotitle:"Instantly revert this edit without leaving the page",summaryprompt:"Enter the undo summary to leave when undoing this edit:"}),o.Message.prototype.escape===void 0&&(o.Message.prototype.escape=o.Message.prototype.escaped);var e={getMessages:function(){return r}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){e[n]=t.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){e[n]=function(){return this}}),e}t.when(m(),o.loader.using(["mediawiki.api","mediawiki.user","mediawiki.util","oojs-ui-windows","jquery.spinner"])).then(h)})(jQuery,mediaWiki);
