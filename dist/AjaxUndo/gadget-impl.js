(function(p){p.loader.impl(function(){return["ext.gadget.store.AjaxUndo@333305d2",function(U,h,y,A){(function(t,o){"use strict";if(window.AjaxUndoLoaded)return;window.AjaxUndoLoaded=!0;var c=o.config.get(["wgArticlePath","wgAction","wgVersion","wgCanonicalSpecialPageName"]),l,g;function d(a){return l.msg(a).plain()}function m(){var a=t(this),e=a.data().url,n=a.data().page,r=/&undo=([^&]*)/.exec(e)[1],u,s=window.AjaxUndoSummary||"";window.AjaxUndoPrompt?u=OO.ui.prompt(d("summaryprompt"),{textInput:{value:s}}):(u=t.Deferred(),u.resolve(s)),u.then(function(i){if(i!==null)return a.empty().append(t.createSpinner({size:"small",type:"inline"}).attr("title",d("undoing")).css("vertical-align","baseline")),g.postWithEditToken({action:"edit",title:n,undo:r,bot:"1",minor:window.AjaxUndoMinor?void 0:"1",summary:i===""?void 0:i})}).done(function(i){i&&(i.edit&&i.edit.result==="Success"?a.text("("+d("undone")+")"):(a.text("("+d("error")+")"),alert(i.error&&i.error.code==="undofailure"?i.error.info:d("unknownerror"))))}).fail(function(i){console.error("[AjaxUndo] Error when undoing edit",i),a.text("("+d("error")+")"),alert(d("unknownerror"))})}function f(a){var e=new URL(a),n=e.searchParams.get("title");return t("<a>",{href:"#ajaxundo","data-url":a,"data-page":decodeURIComponent(n||e.pathname.substring(c.wgArticlePath.replace("$1","").length)),text:d("buttontext"),click:m,title:d("undotitle")})}function w(a){if(l=L(a),g=new o.Api,c.wgAction==="history"&&t(".mw-history-undo > a").length)t(".mw-history-undo > a").each(function(){var e=t(this),n=t(this).prop("href"),r=f(n);e.parent().parent().after(t("<span>").append(r))});else if(t("table.diff").length&&o.util.getParamValue("diff")!==void 0){const e=t("table.diff").find(".diff-ntitle .mw-diff-undo a:first"),n=e.prop("href"),r=f(n);e.parent().after(" (",r,")")}else c.wgCanonicalSpecialPageName==="Contributions"&&t(".mw-contributions-list > li:has(.mw-changeslist-diff)").each(function(){const e=t(this).find(".mw-changeslist-diff").prop("href").replace("?diff=prev&oldid=","?action=edit&undo="),n=f(e);t(this).append(t("<span>").append(" (",n,")"))});o.hook("quickdiff.ready").add(function(){const e=t("#quickdiff-modal table.diff").find(".diff-ntitle .mw-diff-undo a:first"),n=e.prop("href"),r=f(n);e.parent().after(" (",r,")")})}function L(a){var e=o.Message;e.prototype.constructor=o.Message.prototype.constructor;var n={_i18nLoader:a,msg:function(){var r=Array.prototype.slice.call(arguments);if(r.length!==0){var u=r.shift();return new e(this._i18nLoader.getMessages(),u,r)}}};return["setTempLang","setDefaultLang"].forEach(function(r){n[r]=n._i18nLoader[r].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(r){n[r]=n._i18nLoader[r].bind(n)}),n}function v(){var a=new t.Deferred,e=new t.Deferred;function n(){var s=t.Deferred();return o.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(i){s.resolve(i("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(s.reject),s}function r(s){return s.loadMessages("AjaxUndo",{})}function u(s){a.resolve(s)}return e.then(n).then(r).then(u).catch(function(s){console.error(s),a.resolve(x())}),o.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?e.resolve():t.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@1bb78aaab64521129863a64533a7a15f4a77738d/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){e.resolve()}).fail(e.reject),a}function x(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var a=new o.Map;a.set({undoing:"Undoing...",undone:"undone",error:"error",unknownerror:"Error: Unknown result from API.",buttontext:"AJAX Undo",undotitle:"Instantly revert this edit without leaving the page",summaryprompt:"Enter the undo summary to leave when undoing this edit:"}),o.Message.prototype.escape===void 0&&(o.Message.prototype.escape=o.Message.prototype.escaped);var e={getMessages:function(){return a}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){e[n]=t.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){e[n]=function(){return this}}),e}t.when(v(),o.loader.using(["mediawiki.api","mediawiki.user","mediawiki.util","oojs-ui-windows","jquery.spinner"])).then(w)})(h,mediaWiki)},{css:[]},{},{},null]})})(mediaWiki);
