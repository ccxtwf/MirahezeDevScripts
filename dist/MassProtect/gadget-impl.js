(function(a){["sysop","bureaucrat","global-admin"].some(function(e){return(a.config.get("wgUserRights")||[]).indexOf(e)>-1})&&(a.loader.getState("ext.gadget.store.FandoomUiUtilsModal")===null&&a.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@$%7BNEW_TAG%7D/dist/FandoomUiUtilsModal/gadget-impl.js"),a.loader.getState("ext.gadget.store.PowertoolsPlacement")===null&&a.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@$%7BNEW_TAG%7D/dist/PowertoolsPlacement/gadget-impl.js"),a.loader.impl(function(){return["ext.gadget.store.MassProtect@a5628e72",function(e,I,S,W){a.loader.using(["mediawiki.api","mediawiki.user"],function(){if(window.MassProtectLoaded)return;window.MassProtectLoaded=!0;var x=new a.Api,o,C=3,s,f=!0,c,d,u,m,h,y,L,b,w;function g(t){return e("<div>",{class:"edit-input-control"}).append(e("<div>").text(o.msg(t).plain()),e("<select>",{id:"protect-"+t}).append(e("<option>",{value:"",text:o.msg("unset").plain()}),e("<option>",{value:t+"=all",text:o.msg("all").plain()}),e("<option>",{value:t+"=autoconfirmed",text:o.msg("autoconfirmed").plain()}),e("<option>",{value:t+"=sysop",text:o.msg("sysop").plain()})))}function U(){return e("<form>").append(e("<fieldset>").append(e("<p>",{text:o.msg("protection").plain(),class:"protection-bold"}),g("edit"),g("move"),g("upload"),g("create"),e("<hr/>"),e("<div>",{class:"protection-bold edit-input-control"}).append(e("<div>").text(o.msg("expiry").plain()),e("<input>",{type:"text",id:"protect-expiry",placeholder:"indefinite"})),e("<hr/>"),e("<div>",{class:"protection-bold edit-input-control"}).append(e("<div>").text(o.msg("reason").plain()),e("<input>",{type:"text",id:"protect-reason"})),e("<hr/>"),e("<p>",{text:o.msg("instructions").plain()}),e("<textarea/>",{id:"text-mass-protect"}),e("<hr/>"),e("<div>",{id:"text-error-output",text:o.msg("error").plain()}).append(e("<br/>")))).prop("outerHTML")}function v(){--C===0&&k()}function k(){a.libs.PowertoolsPlacement.addPortletLink(a.config.values.skin,{id:"t-mp",href:"#",cssClasses:"custom",label:o.msg("title").plain(),tooltip:"MassProtect",onClick:j})}function j(){if(s){s.show();return}s=new window.dev.modal.Modal({content:U(),id:"form-mass-protect",size:"medium",title:o.msg("title").escape(),buttons:[{id:"mp-start",text:o.msg("initiate").escape(),primary:!0,event:"start"},{id:"mp-pause",text:o.msg("pause").escape(),primary:!0,event:"pause",disabled:!0},{id:"mp-add-pages-in-category",text:o.msg("addCategory").escape(),primary:!0,event:"addCategoryContents"},{text:o.msg("cancel").escape(),event:"close"}],events:{addCategoryContents:F,pause:P,start:A}}),s.create(),c=e("#form-mass-protect"),d=c.find("#text-mass-protect"),u=c.find("#text-error-output"),m=c.find("#protect-expiry"),h=c.find("#protect-create"),y=c.find("#protect-edit"),L=c.find("#protect-move"),b=c.find("#protect-upload"),w=c.find("#protect-reason"),s.show()}function P(){f=!0,s.disableActionButtons("mp-pause"),s.enableActionButtons(["mp-start","mp-add-pages-in-category"])}function A(){f=!1,s.disableActionButtons(["mp-start","mp-add-pages-in-category"]),s.enableActionButtons("mp-pause"),M()}function M(){if(!f){var t=(d.val()||"").split(`
`),n=t[0];n?D(n):(P(),u.append(o.msg("finished").escape()+" "+o.msg("done").escape()+"<br/>")),t=t.slice(1,t.length),d.val(t.join(`
`))}}function F(){var t=prompt(o.msg("categoryPrompt").plain());t&&x.get({action:"query",list:"categorymembers",cmtitle:"Category:"+t,cmlimit:"max"}).done(function(n){var i=n.query;for(var r in i.categorymembers){var p=d.val();d.val(p+i.categorymembers[r].title+`
`)}}).fail(function(n){u.append(o.msg("categoryFail").escape()+t+" : "+n+"<br/>")})}function D(t){x.postWithEditToken({action:"protect",expiry:m.val()||m.attr("placeholder"),protections:h.val()||[y.val(),L.val(),b.val()].filter(Boolean).join("|"),watchlist:"preferences",title:t,reason:w.val()}).done(function(){console.log(o.msg("success",t).plain())}).fail(function(n){console.log(o.msg("fail").escape()+t+": "+n),u.append(o.msg("fail").escape()+t+": "+n+"<br/>")}),setTimeout(M,window.massProtectDelay||1e3)}a.hook("dev.modal").add(v),a.hook("dev.powertools.placement").add(v),T().then(function(t){o=E(t),v()});function E(t){var n=a.Message;n.prototype.constructor=a.Message.prototype.constructor;var i={_i18nLoader:t,msg:function(){var r=Array.prototype.slice.call(arguments);if(r.length!==0){var p=r.shift();return new n(this._i18nLoader.getMessages(),p,r)}}};return["setTempLang","setDefaultLang"].forEach(function(r){i[r]=i._i18nLoader[r].bind(i._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(r){i[r]=i._i18nLoader[r].bind(i)}),i}function T(){var t=new e.Deferred,n=new e.Deferred;function i(){var l=e.Deferred();return a.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(B){l.resolve(B("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(l.reject),l}function r(l){return l.loadMessages("MassProtect",{})}function p(l){t.resolve(l)}return n.then(i).then(r).then(p).catch(function(l){console.error(l),t.resolve(_())}),a.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?n.resolve():e.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@${NEW_TAG}/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){n.resolve()}).fail(n.reject),t}function _(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var t=new a.Map;t.set({unset:"Unset",all:"Allow all users",autoconfirmed:"Block new users and unregistered users",sysop:"Administrators and Content Moderators only",title:"Mass Protect",edit:"Edit:",move:"Move:",upload:"Upload:",create:"Create:",cancel:"Cancel",addCategory:"Add Category Contents",initiate:"Initiate",finished:"Finished!",done:"Nothing left to do, or next line is blank.",close:"Close",categoryPrompt:"Enter the category name (no category prefix):",categoryFail:"Failed to get contents of ",success:"Protection of $1 successful!",fail:"Failed to protect ",protection:"Protection:",expiry:"Expiry time:",reason:"Reason:",instructions:"Put the name of each page you want to protect on a separate line.",error:"Any errors encountered will appear below",pause:"Pause",comment:"Comment:"}),a.Message.prototype.escape===void 0&&(a.Message.prototype.escape=a.Message.prototype.escaped);var n={getMessages:function(){return t}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(i){n[i]=e.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(i){n[i]=function(){return this}}),n}})},{css:['#form-mass-protect #text-mass-protect{height:20em;width:100%}#form-mass-protect #text-error-output{width:100%;margin:5px auto 0;color:#000;background-color:#ffbfbf;border:1px solid #000;font-weight:700;overflow:scroll;min-height:120px}#form-mass-protect .protection-bold{font-weight:700}#form-mass-protect .edit-input-control{display:flex;flex-direction:row;justify-content:flex-start;align-items:center}#form-mass-protect .edit-input-control>div{width:120px}#form-mass-protect .edit-input-control > select,#form-mass-protect .edit-input-control > input[type="text"]{flex-grow:2}@media(max-width:500px){#form-mass-protect .edit-input-control{flex-direction:column;justify-content:flex-start;align-items:flex-start}#form-mass-protect .edit-input-control>div{width:auto}#form-mass-protect .edit-input-control > select,#form-mass-protect .edit-input-control > input[type="text"]{width:100%;display:block}}']},{},{},null]}))})(mediaWiki);
