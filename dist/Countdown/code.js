(function(h,u,r){"use strict";var i=[],p=1,l=2,L=4,d;function c(a,e,n){var t=n?a+"-short":u.language.convertPlural(e,[a,a+"s",a+"s2"]),o=d.msg(t).plain();return n?o:" "+o}function g(a,e){var n,t,o=[],s=!!(i[a].opts&l);if(n=e%60,t=c("second",n,s),o.unshift(n+t),e=Math.floor(e/60),n=e%60,t=c("minute",n,s),o.unshift(n+t),e=Math.floor(e/60),n=e%24,t=c("hour",n,s),o.unshift(n+t),e=Math.floor(e/24),t=c("day",e,s),o.unshift(e+t),t=o.pop(),i[a].opts&p)for(;o.length&&o[0][0]==="0";)o.shift();i[a].opts&L&&(o=o.filter(function(f){return f[0]!=="0"})),o.length&&(i[a].opts&l?t=o.join(" ")+" "+t:t=o.join(", ")+" "+d.msg("and").plain()+" "+t),i[a].node.text(t)}function m(a){var e=i[a].node.parents(".countdown").first();switch(e.attr("data-end")){case"remove":return e.remove(),!0;case"stop":return g(a,0),!0;case"toggle":var n=e.attr("data-toggle");if(n&&n==="next")return e.next().css("display","inline"),e.css("display","none"),!0;if(n&&r(n).length)return r(n).css("display","inline"),e.css("display","none"),!0;break;case"callback":var t=e.attr("data-callback");if(t&&r.isFunction(h[t]))return g(a,0),h[t].call(e),!0;break}return i[a].countup=!0,g(a,0),!1}function v(){var a=Date.now(),e=[];r.each(i.slice(0),function(t,o){var s=Math.floor((o.date-a)/1e3);s<=0&&!o.countup?m(t)&&e.push(t):g(t,Math.abs(s))});for(var n;(n=e.pop())!==void 0;)i.splice(n,1);i.length&&window.setTimeout(function(){v()},1e3)}function M(a){var e=a.parents(".countdown").first(),n=e.attr("data-options"),t=0;return n&&(/no-leading-zeros/.test(n)&&(t|=p),/short-format/.test(n)&&(t|=l),/no-zeros/.test(n)&&(t|=L)),t}function y(){var a=r("body").find(".countdown:not(.handled)");a.length&&(r("body").find(".nocountdown").css("display","none"),a.css("display","inline").find(".countdowndate").each(function(){var e=r(this),n=new Date(e.text()).valueOf();if(isNaN(n)){e.text(d.msg("bad-date").plain());return}i.push({node:e,opts:M(e),date:n})}),a.addClass("handled"),i.length&&v())}_().done(function(a){d=w(a),u.hook("wikipage.content").add(y)});function w(a){var e=u.Message;e.prototype.constructor=u.Message.prototype.constructor;var n={_i18nLoader:a,msg:function(){var t=Array.prototype.slice.call(arguments);if(t.length!==0){var o=t.shift();return new e(this._i18nLoader.getMessages(),o,t)}}};return["setTempLang","setDefaultLang"].forEach(function(t){n[t]=n._i18nLoader[t].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(t){n[t]=n._i18nLoader[t].bind(n)}),n}function _(){var a=new r.Deferred,e=new r.Deferred;function n(){var s=r.Deferred();return u.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(f){s.resolve(f("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(s.reject),s}function t(s){return s.loadMessages("Countdown",{})}function o(s){s.useContentLang(),a.resolve(s)}return e.then(n).then(t).then(o).catch(function(s){console.error(s),a.resolve(E())}),u.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?e.resolve():r.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@v0.0.1/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){e.resolve()}).fail(e.reject),a}function E(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var a=new u.Map;a.set({and:"and",second:"second",seconds:"seconds",minute:"minute",minutes:"minutes",hour:"hour",hours:"hours",day:"day",days:"days","bad-date":"Invalid Date","second-short":"s","minute-short":"m","hour-short":"h","day-short":"d",seconds2:"seconds",minutes2:"minutes",hours2:"hours",days2:"days"}),u.Message.prototype.escape===void 0&&(u.Message.prototype.escape=u.Message.prototype.escaped);var e={getMessages:function(){return a}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){e[n]=r.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){e[n]=function(){return this}}),e}})(window.countdownTimer=window.countdownTimer||{},mediaWiki,jQuery);
