(function(h,u,i){"use strict";var s=[],p=1,f=2,v=4,d;function c(o,n,t){var e=t?o+"-short":u.language.convertPlural(n,[o,o+"s",o+"s2"]),a=d.msg(e).plain();return t?a:" "+a}function l(o,n){var t,e,a=[],r=!!(s[o].opts&f);if(t=n%60,e=c("second",t,r),a.unshift(t+e),n=Math.floor(n/60),t=n%60,e=c("minute",t,r),a.unshift(t+e),n=Math.floor(n/60),t=n%24,e=c("hour",t,r),a.unshift(t+e),n=Math.floor(n/24),e=c("day",n,r),a.unshift(n+e),e=a.pop(),s[o].opts&p)for(;a.length&&a[0][0]==="0";)a.shift();s[o].opts&v&&(a=a.filter(function(g){return g[0]!=="0"})),a.length&&(s[o].opts&f?e=a.join(" ")+" "+e:e=a.join(", ")+" "+d.msg("and").plain()+" "+e),s[o].node.text(e)}function L(o){var n=s[o].node.parents(".countdown").first();switch(n.attr("data-end")){case"remove":return n.remove(),!0;case"stop":return l(o,0),!0;case"toggle":var t=n.attr("data-toggle");if(t&&t==="next")return n.next().css("display","inline"),n.css("display","none"),!0;if(t&&i(t).length)return i(t).css("display","inline"),n.css("display","none"),!0;break;case"callback":var e=n.attr("data-callback");if(e&&i.isFunction(h[e]))return l(o,0),h[e].call(n),!0;break}return s[o].countup=!0,l(o,0),!1}function w(){var o=Date.now(),n=[];i.each(s.slice(0),function(e,a){var r=Math.floor((a.date-o)/1e3);r<=0&&!a.countup?L(e)&&n.push(e):l(e,Math.abs(r))});for(var t;(t=n.pop())!==void 0;)s.splice(t,1);s.length&&window.setTimeout(function(){w()},1e3)}function _(o){var n=o.parents(".countdown").first(),t=n.attr("data-options"),e=0;return t&&(/no-leading-zeros/.test(t)&&(e|=p),/short-format/.test(t)&&(e|=f),/no-zeros/.test(t)&&(e|=v)),e}function M(){var o=i("body").find(".countdown:not(.handled)");o.length&&(i("body").find(".nocountdown").css("display","none"),o.css("display","inline").find(".countdowndate").each(function(){var n=i(this),t=new Date(n.text()).valueOf();if(isNaN(t)){n.text(d.msg("bad-date").plain());return}s.push({node:n,opts:_(n),date:t})}),o.addClass("handled"),s.length&&w())}m().done(function(o){d=T(o),u.hook("wikipage.content").add(M)}).fail(function(){console.error("[Countdown] Failed to fetch FandoomUtilsI18nLoader. The gadget will not execute.")});function T(o){var n=u.Message;n.prototype.constructor=u.Message.prototype.constructor;var t={_i18nLoader:o,msg:function(){var e=Array.prototype.slice.call(arguments);if(e.length!==0){var a=e.shift();return new n(this._i18nLoader.getMessages(),a,e)}}};return["setTempLang","setDefaultLang"].forEach(function(e){t[e]=t._i18nLoader[e].bind(t._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(e){t[e]=t._i18nLoader[e].bind(t)}),t}function m(){var o=new i.Deferred,n=new i.Deferred;function t(){var r=i.Deferred();return u.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(g){r.resolve(g("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(r.reject),r}function e(r){return r.loadMessages("Countdown",{})}function a(r){r.useContentLang(),o.resolve(r)}return n.then(t).then(e).then(a).catch(function(r){console.error(r),o.reject()}),u.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?n.resolve():i.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@v0.0.3/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){n.resolve()}).fail(n.reject),o}})(window.countdownTimer=window.countdownTimer||{},mediaWiki,jQuery);
