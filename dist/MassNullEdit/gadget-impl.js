(function(f){f.loader.getState("ext.gadget.store.FandoomUiUtilsQdmodal")===null&&f.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/FandoomUiUtilsQdmodal/gadget-impl.js"),f.loader.getState("ext.gadget.store.PowertoolsPlacement")===null&&f.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/PowertoolsPlacement/gadget-impl.js"),f.loader.impl(function(){return["ext.gadget.store.MassNullEdit@29be2149",function(X,j,Y,Z){(function(d,r){"use strict";if(window.loadedMassNullEdit)return;window.loadedMassNullEdit=!0;var U={backlinks:{name:"backlinks",limit:"bllimit",value:"bltitle"},transclusions:{name:"embeddedin",limit:"eilimit",value:"eititle"},fileusage:{name:"imageusage",limit:"iulimit",value:"iutitle"},prefix:{name:"allpages",limit:"aplimit",value:"apprefix"},category:{name:"categorymembers",limit:"cmlimit",value:"cmtitle"},namespace:{name:"allpages",limit:"aplimit",value:"apnamespace"}},l=r.config.get(["wgCanonicalNamespace","wgCanonicalSpecialPageName","wgFormattedNamespaces","wgNamespaceIds","wgRelevantPageName"]),x={action:"edit",summary:"Null edit (this edit should not be visible)",notminor:!0,prependtext:"",nocreate:!0},i,D=["-2","-1"],y=l.wgFormattedNamespaces[14]+":",L=l.wgFormattedNamespaces[6]+":",P=[],p,g,c,A=!0,N=!1,C,b=null;function h(e){d("#mne-output").prepend(e.parse(),"<br>")}function R(e){var a=e.indexOf(":"),n=e.slice(0,a).toLowerCase().replace(/ /g,"_"),t=e.slice(a+1),s=l.wgNamespaceIds[n];return{namespaceId:s||0,title:s?t:e}}function M(e){var a=p.value.split(`
`);return e=e.filter(function(n){return a.indexOf(n)===-1}),e.length&&(p.value+=e.join(`
`)+`
`),e.length}function q(e){var a={title:e},n=x.postWithEditToken(a);n.always(function(t,s){n.state()==="rejected"&&(t=s);var o=t.error&&t.error.code||"unknown";t.edit&&t.edit.result==="Success"||(o==="ratelimited"?(N=!0,p.value=e+`
`+p.value):(P.push(e),h(i("fail",e,o))))})}function v(){A=!0,N=!1,g.$element.removeClass("processing")}function E(){A=!1,g.$element.addClass("processing"),I()}function I(){if(N&&(h(i("notice-ratelimit")),v(),C=setTimeout(E,3e4)),!(A||p===null)){var e=Number(window.nullEditDelay)||1e3;e<100&&(e*=1e3);var a=p.value.split(`
`),n;do n=a.shift();while(n==="");p.value=a.join(`
`),n?(q(n.trim()),setTimeout(I,e)):(h(i("notice-finished")),M(P),P=[],v())}}function T(e,a,n){var t=[],s=new r.Api({parameters:e});function o(w){if(w&&h(i("notice-error-"+a,n,w)),!w||t.length){var k=M(t);h(i("notice-success-"+a,n,k))}c.$element.removeClass("processing"),c.hide()}function $(w){var k=s.get(w);k.always(function(u,G){k.state()==="rejected"&&(u=G);var J=u.error&&u.error.code||"unknown",S=u.query&&u.query[e.list],F=u["query-continue"];if(S)S.forEach(function(K){t.push(K.title)});else{o(J);return}F&&b===null&&(b=!confirm(i("confirm-big-request",u.limits[e.list]).parse())),F&&!b?$(F[e.list]):o()})}c.$element.addClass("processing"),$()}function m(e,a){var n=U[e],t={rawcontinue:""};if(!(!n||!a)){a=a.replace(/_/g," ");var s=a;switch(e){case"namespace":s=a==="0"?i("namespace-main").escape():l.wgFormattedNamespaces[a];break;case"category":a.indexOf(y)!==0?a=y+a:s=s.slice(y.length);break;case"fileusage":a.indexOf(L)!==0?a=L+a:s=s.slice(L.length);break;case"prefix":var o=R(a);t.apnamespace=o.namespaceId,a=o.title;break}t.list=n.name,t[n.value]=a,t[n.limit]="max",T(t,e,s)}}function O(e){var a=d("<p>",{class:"mne-addpages-row"}),n=d("<input>").attr({type:"radio",name:"mode",value:e}),t=d("<input>").attr({type:"text",name:e});return e==="namespace"&&(t=d("<select>").attr("name",e),Object.keys(l.wgFormattedNamespaces).forEach(function(s){if(D.indexOf(s)===-1){var o=document.createElement("option");o.value=s,o.textContent=s==="0"?i("namespace-main").plain():l.wgFormattedNamespaces[s],t.append(o)}})),t.on("change",function(){n.prop("checked",!0)}),a.append(d("<label>").append(n,document.createTextNode(i("addpages-"+e).plain())),t),a}function _(){var e,a=d("<form>").attr("id","mne-mode");Object.keys(U).forEach(function(n){a.append(O(n))}),c.show({title:i("addpages").plain(),content:a,onShow:function(){b=null,e=document.forms["mne-mode"].elements,c.$footer.append(d("<span>").attr("id","mne-processing-msg").text(i("processing").plain()),r.libs.QDmodal.getSpinner())},onHide:function(){b=!0},buttons:[{text:i("addpages").plain(),attr:{id:"mne-addpages-start"},handler:function(){var n=c.$content.find("[name=mode]:checked").val(),t=e[n]&&e[n].value;m(n,t)}},{text:i("cancel").plain(),handler:c.hide.bind(c)}]})}function Q(){var e=l.wgRelevantPageName.replace(/_/g," ");if(l.wgCanonicalNamespace==="Category"&&m("category",e),l.wgCanonicalSpecialPageName==="Whatlinkshere"&&(m("backlinks",e),m("transclusions",e),e.indexOf(L)===0&&m("fileusage",e)),l.wgCanonicalSpecialPageName==="Allpages"&&m("namespace",d('form [name="namespace"]').val()),l.wgCanonicalSpecialPageName==="Prefixindex"){var a=d('form [name="prefix"]').val(),n=d('form [name="namespace"]').val(),t="";n!=="0"&&(t+=l.wgFormattedNamespaces[n]+":"),t+=a,m("prefix",t)}}function z(e){e.preventDefault();var a="<p>"+i("instructions").escape()+'</p><textarea id="mne-input"></textarea><div id="mne-output"><i>'+i("notice-output").escape()+"</i></div>";g.show({title:i("title").plain(),content:a,onShow:function(){p=document.getElementById("mne-input"),v(),g.$footer.append(d("<span>").attr("id","mne-processing-msg").text(i("processing").plain()),r.libs.QDmodal.getSpinner())},onHide:function(){v(),p=null,clearTimeout(C)},buttons:[{text:i("initiate").plain(),attr:{id:"mne-main-start"},handler:E},{text:i("pause").plain(),attr:{id:"mne-main-pause"},handler:v},{text:i("addpages").plain(),handler:_},{text:i("cancel").plain(),handler:g.hide.bind(g)}]}),r.loader.using(["mediawiki.api","mediawiki.user"]).then(function(){x instanceof r.Api||(x=new r.Api({parameters:x})),Q()})}function V(){g=new r.libs.QDmodal("mne-main"),c=new r.libs.QDmodal("mne-addpages"),g.$element.addClass("mne-modal"),c.$element.addClass("mne-modal"),r.hook("dev.powertools.placement").add(function(e){e.addPortletLink(r.config.values.skin,{id:"t-mne",href:"#",label:i("title").plain(),tooltip:"MassNullEdit",onClick:z})})}H().then(function(e){i=W(e),i=i.msg.bind(i),r.hook("dev.qdmodal").add(V)});function W(e){var a=r.Message;a.prototype.constructor=r.Message.prototype.constructor;var n={_i18nLoader:e,msg:function(){var t=Array.prototype.slice.call(arguments);if(t.length!==0){var s=t.shift();return new a(this._i18nLoader.getMessages(),s,t)}}};return["setTempLang","setDefaultLang"].forEach(function(t){n[t]=n._i18nLoader[t].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(t){n[t]=n._i18nLoader[t].bind(n)}),n}function H(){var e=new d.Deferred,a=new d.Deferred;function n(){var o=d.Deferred();return r.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function($){o.resolve($("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(o.reject),o}function t(o){return o.loadMessages("MassNullEdit",{})}function s(o){e.resolve(o)}return a.then(n).then(t).then(s).catch(function(o){console.error(o),e.resolve(B())}),r.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?a.resolve():d.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){a.resolve()}).fail(a.reject),e}function B(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new r.Map;e.set({title:"Mass Null Edit",instructions:"Enter the name of each page to null edit on a separate line. Remember to include the namespace too if it is not in main.","notice-output":"Any notices will appear here","notice-ratelimit":"<b>Rate limited!</b> Waiting 30 seconds before next edit.","notice-finished":"<b>Finished!</b> Any pages with failed edits have been re-added above.","notice-success-backlinks":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} that {{PLURAL:$2|links|link}} to \u201C$1\u201D added.","notice-success-transclusions":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} that {{PLURAL:$2|transcludes|transclude}} \u201C$1\u201D added.","notice-success-fileusage":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} that {{PLURAL:$2|includes|include}} the file \u201C$1\u201D added.","notice-success-prefix":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} with the prefix \u201C$1\u201D added.","notice-success-category":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} from \u201C$1\u201D category added.","notice-success-namespace":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} from \u201C$1\u201D namespace added.","notice-error-backlinks":"<b>API error!</b> Failed to get pages that link to \u201C$1\u201D: <b>$2</b>.","notice-error-transclusions":"<b>API error!</b> Failed to get pages that transclude \u201C$1\u201D: <b>$2</b>.","notice-error-fileusage":"<b>API error!</b> Failed to get pages that include the file \u201C$1\u201D: <b>$2</b>.","notice-error-prefix":"<b>API error!</b> Failed to get pages with the prefix \u201C$1\u201D: <b>$2</b>.","notice-error-category":"<b>API error!</b> Failed to get pages from \u201C$1\u201D category: <b>$2</b>.","notice-error-namespace":"<b>API error!</b> Failed to get pages from \u201C$1\u201D namespace: <b>$2</b>.",cancel:"Cancel",pause:"Pause",initiate:"Start",addpages:"Add pages","addpages-backlinks":"Add pages that link to:","addpages-transclusions":"Add pages that transclude:","addpages-fileusage":"Add pages that include the file:","addpages-prefix":"Add pages with the prefix:","addpages-category":"Add members of category:","addpages-namespace":"Add pages from namespace:","namespace-main":"(Main)",processing:"Processing\u2026","confirm-big-request":"This request will be big (more than $1 pages) and may be slow. Do you want to continue?",success:"Null edit of \u201C$1\u201D successful!",fail:"Failed to null edit \u201C$1\u201D: <b>$2</b>."}),r.Message.prototype.escape===void 0&&(r.Message.prototype.escape=r.Message.prototype.escaped);var a={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){a[n]=d.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){a[n]=function(){return this}}),a}})(j,mediaWiki)},{css:['#mne-main{width:560px}#mne-main #mne-input{border:1px solid #aaa;box-sizing:border-box;height:20em;padding:2px;width:100%}#mne-main #mne-output{background-color:#fdd;border:1px solid #aaa;box-sizing:border-box;color:#111;height:10em;margin-top:5px;overflow:auto;padding:2px;width:100%}#mne-main:not(.processing) #mne-main-pause,#mne-main.processing #mne-main-start{opacity:.6;pointer-events:none}#mne-addpages .mne-addpages-row{padding:4px 0}#mne-addpages .mne-addpages-row>label{margin-right:4px}#mne-addpages .mne-addpages-row > label,#mne-addpages .mne-addpages-row > input[type="text"],#mne-addpages .mne-addpages-row > select{width:100%}#mne-addpages.processing #mne-addpages-start,#mne-addpages.processing>section{opacity:.6;pointer-events:none}.mne-modal .qdmodal-spinner-container{--qdmodal-spinner-size: 40px}.mne-modal #mne-processing-msg{flex-grow:1;text-indent:8px}.mne-modal:not(.processing) .qdmodal-spinner-container,.mne-modal:not(.processing) #mne-processing-msg{display:none}']},{},{},null]})})(mediaWiki);
