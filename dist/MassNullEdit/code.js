(function(d,o){"use strict";if(window.loadedMassNullEdit)return;window.loadedMassNullEdit=!0;var E={backlinks:{name:"backlinks",limit:"bllimit",value:"bltitle"},transclusions:{name:"embeddedin",limit:"eilimit",value:"eititle"},fileusage:{name:"imageusage",limit:"iulimit",value:"iutitle"},prefix:{name:"allpages",limit:"aplimit",value:"apprefix"},category:{name:"categorymembers",limit:"cmlimit",value:"cmtitle"},namespace:{name:"allpages",limit:"aplimit",value:"apnamespace"}},l=o.config.get(["wgCanonicalNamespace","wgCanonicalSpecialPageName","wgFormattedNamespaces","wgNamespaceIds","wgRelevantPageName"]),L={action:"edit",summary:"Null edit (this edit should not be visible)",notminor:!0,prependtext:"",nocreate:!0},i,T=["-2","-1"],k=l.wgFormattedNamespaces[14]+":",P=l.wgFormattedNamespaces[6]+":",y=[],p,u,c,x=!0,$=!1,M,f=null;function b(e){d("#mne-output").prepend(e.parse(),"<br>")}function S(e){var a=e.indexOf(":"),n=e.slice(0,a).toLowerCase().replace(/ /g,"_"),t=e.slice(a+1),s=l.wgNamespaceIds[n];return{namespaceId:s||0,title:s?t:e}}function N(e){var a=p.value.split(`
`);return e=e.filter(function(n){return a.indexOf(n)===-1}),e.length&&(p.value+=e.join(`
`)+`
`),e.length}function R(e){var a={title:e},n=L.postWithEditToken(a);n.always(function(t,s){n.state()==="rejected"&&(t=s);var r=t.error&&t.error.code||"unknown";t.edit&&t.edit.result==="Success"||(r==="ratelimited"?($=!0,p.value=e+`
`+p.value):(y.push(e),b(i("fail",e,r))))})}function v(){x=!0,$=!1,u.$element.removeClass("processing")}function I(){x=!1,u.$element.addClass("processing"),D()}function D(){if($&&(b(i("notice-ratelimit")),v(),M=setTimeout(I,3e4)),!(x||p===null)){var e=Number(window.nullEditDelay)||1e3;e<100&&(e*=1e3);var a=p.value.split(`
`),n;do n=a.shift();while(n==="");p.value=a.join(`
`),n?(R(n.trim()),setTimeout(D,e)):(b(i("notice-finished")),N(y),y=[],v())}}function _(e,a,n){var t=[],s=new o.Api({parameters:e});function r(h){if(h&&b(i("notice-error-"+a,n,h)),!h||t.length){var w=N(t);b(i("notice-success-"+a,n,w))}c.$element.removeClass("processing"),c.hide()}function A(h){var w=s.get(h);w.always(function(m,W){w.state()==="rejected"&&(m=W);var B=m.error&&m.error.code||"unknown",F=m.query&&m.query[e.list],C=m["query-continue"];if(F)F.forEach(function(Y){t.push(Y.title)});else{r(B);return}C&&f===null&&(f=!confirm(i("confirm-big-request",m.limits[e.list]).parse())),C&&!f?A(C[e.list]):r()})}c.$element.addClass("processing"),A()}function g(e,a){var n=E[e],t={rawcontinue:""};if(!(!n||!a)){a=a.replace(/_/g," ");var s=a;switch(e){case"namespace":s=a==="0"?i("namespace-main").escape():l.wgFormattedNamespaces[a];break;case"category":a.indexOf(k)!==0?a=k+a:s=s.slice(k.length);break;case"fileusage":a.indexOf(P)!==0?a=P+a:s=s.slice(P.length);break;case"prefix":var r=S(a);t.apnamespace=r.namespaceId,a=r.title;break}t.list=n.name,t[n.value]=a,t[n.limit]="max",_(t,e,s)}}function U(e){var a=d("<p>",{class:"mne-addpages-row"}),n=d("<input>").attr({type:"radio",name:"mode",value:e}),t=d("<input>").attr({type:"text",name:e});return e==="namespace"&&(t=d("<select>").attr("name",e),Object.keys(l.wgFormattedNamespaces).forEach(function(s){if(T.indexOf(s)===-1){var r=document.createElement("option");r.value=s,r.textContent=s==="0"?i("namespace-main").plain():l.wgFormattedNamespaces[s],t.append(r)}})),t.on("change",function(){n.prop("checked",!0)}),a.append(d("<label>").append(n,document.createTextNode(i("addpages-"+e).plain())),t),a}function j(){var e,a=d("<form>").attr("id","mne-mode");Object.keys(E).forEach(function(n){a.append(U(n))}),c.show({title:i("addpages").plain(),content:a,onShow:function(){f=null,e=document.forms["mne-mode"].elements,c.$footer.append(d("<span>").attr("id","mne-processing-msg").text(i("processing").plain()),o.libs.QDmodal.getSpinner())},onHide:function(){f=!0},buttons:[{text:i("addpages").plain(),attr:{id:"mne-addpages-start"},handler:function(){var n=c.$content.find("[name=mode]:checked").val(),t=e[n]&&e[n].value;g(n,t)}},{text:i("cancel").plain(),handler:c.hide.bind(c)}]})}function q(){var e=l.wgRelevantPageName.replace(/_/g," ");if(l.wgCanonicalNamespace==="Category"&&g("category",e),l.wgCanonicalSpecialPageName==="Whatlinkshere"&&(g("backlinks",e),g("transclusions",e),e.indexOf(P)===0&&g("fileusage",e)),l.wgCanonicalSpecialPageName==="Allpages"&&g("namespace",d('form [name="namespace"]').val()),l.wgCanonicalSpecialPageName==="Prefixindex"){var a=d('form [name="prefix"]').val(),n=d('form [name="namespace"]').val(),t="";n!=="0"&&(t+=l.wgFormattedNamespaces[n]+":"),t+=a,g("prefix",t)}}function O(e){e.preventDefault();var a="<p>"+i("instructions").escape()+'</p><textarea id="mne-input"></textarea><div id="mne-output"><i>'+i("notice-output").escape()+"</i></div>";u.show({title:i("title").plain(),content:a,onShow:function(){p=document.getElementById("mne-input"),v(),u.$footer.append(d("<span>").attr("id","mne-processing-msg").text(i("processing").plain()),o.libs.QDmodal.getSpinner())},onHide:function(){v(),p=null,clearTimeout(M)},buttons:[{text:i("initiate").plain(),attr:{id:"mne-main-start"},handler:I},{text:i("pause").plain(),attr:{id:"mne-main-pause"},handler:v},{text:i("addpages").plain(),handler:j},{text:i("cancel").plain(),handler:u.hide.bind(u)}]}),o.loader.using(["mediawiki.api","mediawiki.user"]).then(function(){L instanceof o.Api||(L=new o.Api({parameters:L})),q()})}function V(){u=new o.libs.QDmodal("mne-main"),c=new o.libs.QDmodal("mne-addpages"),u.$element.addClass("mne-modal"),c.$element.addClass("mne-modal"),o.hook("dev.powertools.placement").add(function(e){e.addPortletLink(o.config.values.skin,{id:"t-mne",href:"#",label:i("title").plain(),tooltip:"MassNullEdit",onClick:O})})}H().then(function(e){i=G(e),i=i.msg.bind(i),o.hook("dev.qdmodal").add(V)});function G(e){var a=o.Message;a.prototype.constructor=o.Message.prototype.constructor;var n={_i18nLoader:e,msg:function(){var t=Array.prototype.slice.call(arguments);if(t.length!==0){var s=t.shift();return new a(this._i18nLoader.getMessages(),s,t)}}};return["setTempLang","setDefaultLang"].forEach(function(t){n[t]=n._i18nLoader[t].bind(n._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(t){n[t]=n._i18nLoader[t].bind(n)}),n}function H(){var e=new d.Deferred,a=new d.Deferred;function n(){var r=d.Deferred();return o.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(A){r.resolve(A("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(r.reject),r}function t(r){return r.loadMessages("MassNullEdit",{})}function s(r){e.resolve(r)}return a.then(n).then(t).then(s).catch(function(r){console.error(r),e.resolve(Q())}),o.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?a.resolve():d.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@v0.0.4/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){a.resolve()}).fail(a.reject),e}function Q(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new o.Map;e.set({title:"Mass Null Edit",instructions:"Enter the name of each page to null edit on a separate line. Remember to include the namespace too if it is not in main.","notice-output":"Any notices will appear here","notice-ratelimit":"<b>Rate limited!</b> Waiting 30 seconds before next edit.","notice-finished":"<b>Finished!</b> Any pages with failed edits have been re-added above.","notice-success-backlinks":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} that {{PLURAL:$2|links|link}} to “$1” added.","notice-success-transclusions":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} that {{PLURAL:$2|transcludes|transclude}} “$1” added.","notice-success-fileusage":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} that {{PLURAL:$2|includes|include}} the file “$1” added.","notice-success-prefix":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} with the prefix “$1” added.","notice-success-category":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} from “$1” category added.","notice-success-namespace":"<b>Added pages!</b> $2 {{PLURAL:$2|page|pages}} from “$1” namespace added.","notice-error-backlinks":"<b>API error!</b> Failed to get pages that link to “$1”: <b>$2</b>.","notice-error-transclusions":"<b>API error!</b> Failed to get pages that transclude “$1”: <b>$2</b>.","notice-error-fileusage":"<b>API error!</b> Failed to get pages that include the file “$1”: <b>$2</b>.","notice-error-prefix":"<b>API error!</b> Failed to get pages with the prefix “$1”: <b>$2</b>.","notice-error-category":"<b>API error!</b> Failed to get pages from “$1” category: <b>$2</b>.","notice-error-namespace":"<b>API error!</b> Failed to get pages from “$1” namespace: <b>$2</b>.",cancel:"Cancel",pause:"Pause",initiate:"Start",addpages:"Add pages","addpages-backlinks":"Add pages that link to:","addpages-transclusions":"Add pages that transclude:","addpages-fileusage":"Add pages that include the file:","addpages-prefix":"Add pages with the prefix:","addpages-category":"Add members of category:","addpages-namespace":"Add pages from namespace:","namespace-main":"(Main)",processing:"Processing…","confirm-big-request":"This request will be big (more than $1 pages) and may be slow. Do you want to continue?",success:"Null edit of “$1” successful!",fail:"Failed to null edit “$1”: <b>$2</b>."}),o.Message.prototype.escape===void 0&&(o.Message.prototype.escape=o.Message.prototype.escaped);var a={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(n){a[n]=d.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(n){a[n]=function(){return this}}),a}})(jQuery,mediaWiki);
