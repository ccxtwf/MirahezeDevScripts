(function(n){n.loader.getState("ext.gadget.store.FandoomUiUtilsModal")===null&&n.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/FandoomUiUtilsModal/gadget-impl.js"),n.loader.getState("ext.gadget.store.PowertoolsPlacement")===null&&n.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/PowertoolsPlacement/gadget-impl.js"),n.loader.impl(function(){return["ext.gadget.store.MassRename@77e44660",function(r,j,I,T){n.loader.using("mediawiki.api",function(){if(window.MassRenameLoaded||!/sysop|bureaucrat|global-admin/.test(n.config.get("wgUserGroups").join()))return;window.MassRenameLoaded=!0;var a,i,b=3,p=!1,c,m,f,h,u;function x(){return r("<form>").append(r("<fieldset>").append(r("<p>",{text:a.msg("instructions").plain()}),r("<p>",{text:a.msg("instructions2").plain()}),r("<label>",{for:"redirect-check",text:a.msg("redirect").plain()}).append(r("<input>",{type:"checkbox",id:"redirect-check"})),r("<div>",{class:"edit-input-control"}).append(r("<label>",{for:"custom-summary"}).append(r("<div>").text(a.msg("custom-summary").plain()),r("<input>",{id:"custom-summary"}))),r("<textarea>",{id:"text-rename",placeholder:"old_name new_name"}),r("<div>",{id:"text-error-output",text:a.msg("outputInitial").plain(),append:"<br/>"}))).prop("outerHTML")}function g(){--b===0&&w()}function w(){n.libs.PowertoolsPlacement.addPortletLink(n.config.values.skin,{id:"t-mr",href:"#",label:a.msg("title").plain(),tooltip:"MassRename",onClick:y})}function y(){if(i){i.show();return}i=new window.dev.modal.Modal({content:x(),id:"form-mass-rename",size:"medium",title:a.msg("title").escape(),buttons:[{id:"mr1-start",text:a.msg("initiate").escape(),primary:!0,event:"start"},{id:"mr1-pause",text:a.msg("pause").escape(),primary:!0,event:"pause",disabled:!0},{text:a.msg("close").escape(),event:"close"}],events:{pause:v,start:M}}),i.create(),c=r("#form-mass-rename"),m=c.find("#text-rename"),f=c.find("#custom-summary"),h=c.find("#redirect-check"),u=c.find("#text-error-output"),i.show()}function v(){p=!0,i.disableActionButtons("mr1-pause"),i.enableActionButtons("mr1-start")}function M(){p=!1,i.disableActionButtons("mr1-start"),i.enableActionButtons("mr1-pause"),L()}function L(){if(!p){var e=(m.val()||"").split(`
`),t=e[0];t?k(t):(u.append(a.msg("finished").escape()+" "+a.msg("nothingLeftToDo").escape()+"<br/>"),v()),e=e.slice(1,e.length),m.val(e.join(`
`))}}function k(e){if(e.split(" ").length!==2)u.append(a.msg("invalidInput",e).escape()+"<br/>");else{var t=e.split(" ")[0],o=e.split(" ")[1],s={action:"move",from:t,to:o,noredirect:"",reason:f.first().val()||window.massRenameSummary||a.inContentLang().msg("summary").plain()};h.prop("checked")&&delete s.noredirect,new n.Api().postWithEditToken(s).done(function(l){l.error?(console.error(a.msg("renameFail",t,o).escape()+": "+l.error.code),u.append(a.msg("renameFail",t,o).escape()+": "+l.error.code+"<br/>")):console.log(a.msg("renameDone",t,o).plain())}).fail(function(l){console.error(a.msg("renameFail",t,o).plain()+": "+l),u.append(a.msg("renameFail2",t,o).escape()+"<br/>")})}setTimeout(L,window.massRenameDelay||1e3)}n.hook("dev.modal").add(g),n.hook("dev.powertools.placement").add(g),P().then(function(e){a=F(e),g()});function F(e){var t=n.Message;t.prototype.constructor=n.Message.prototype.constructor;var o={_i18nLoader:e,msg:function(){var s=Array.prototype.slice.call(arguments);if(s.length!==0){var l=s.shift();return new t(this._i18nLoader.getMessages(),l,s)}}};return["setTempLang","setDefaultLang"].forEach(function(s){o[s]=o._i18nLoader[s].bind(o._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(s){o[s]=o._i18nLoader[s].bind(o)}),o}function P(){var e=new r.Deferred,t=new r.Deferred;function o(){var d=r.Deferred();return n.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(D){d.resolve(D("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(d.reject),d}function s(d){return d.loadMessages("MassRename",{})}function l(d){e.resolve(d)}return t.then(o).then(s).then(l).catch(function(d){console.error(d),e.resolve(U())}),n.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?t.resolve():r.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){t.resolve()}).fail(t.reject),e}function U(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new n.Map;e.set({title:"Mass rename",instructions:"Put the name of the page you want to rename, then the new name afterwards with a space in between on each separate line.",instructions2:"For page names with spaces, use underscores instead of spaces.",redirect:"Leave a redirect behind?",summary:"automatic",outputInitial:"Any errors encountered will appear below",initiate:"Initiate",cancel:"Cancel",finished:"Finished!",nothingLeftToDo:"Nothing left to do, or next line is blank.",close:"Close",renameDone:"Successfully renamed $1 to $2!",invalidInput:'The line "$1" is invalid input!',renameFail:"Failed to rename $1 to $2",renameFail2:"Failed to rename $1 to $2!",pause:"Pause","custom-summary":"Reason for moving "}),n.Message.prototype.escape===void 0&&(n.Message.prototype.escape=n.Message.prototype.escaped);var t={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(o){t[o]=r.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(o){t[o]=function(){return this}}),t}})},{css:["#form-mass-rename #text-rename{height:20em;resize:none;width:100%}#form-mass-rename #text-error-output{background-color:#ffbfbf;color:#000;font-weight:700;width:100%;overflow:scroll}#form-mass-rename #my-tools-menu .custom{cursor:pointer}#form-mass-rename .edit-input-control{margin-top:5px;margin-bottom:15px}#form-mass-rename .edit-input-control>label>*{display:block;width:100%;box-sizing:border-box}"]},{},{},null]})})(mediaWiki);
