(function(n){["sysop","bureaucrat","global-admin"].some(function(a){return(n.config.get("wgUserRights")||[]).indexOf(a)>-1})&&(n.loader.getState("ext.gadget.store.FandoomUiUtilsModal")===null&&n.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/FandoomUiUtilsModal/gadget-impl.js"),n.loader.getState("ext.gadget.store.PowertoolsPlacement")===null&&n.loader.load("https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/PowertoolsPlacement/gadget-impl.js"),n.loader.impl(function(){return["ext.gadget.store.MassRename@8aa0f1f0",function(a,j,I,R){n.loader.using("mediawiki.api",function(){if(window.MassRenameLoaded)return;window.MassRenameLoaded=!0;var o,s,b=3,m=!1,c,p,f,h,u;function x(){return a("<form>").append(a("<fieldset>").append(a("<p>",{text:o.msg("instructions").plain()}),a("<p>",{text:o.msg("instructions2").plain()}),a("<label>",{for:"redirect-check",text:o.msg("redirect").plain()}).append(a("<input>",{type:"checkbox",id:"redirect-check"})),a("<div>",{class:"edit-input-control"}).append(a("<label>",{for:"custom-summary"}).append(a("<div>").text(o.msg("custom-summary").plain()),a("<input>",{id:"custom-summary"}))),a("<textarea>",{id:"text-rename",placeholder:"old_name new_name"}),a("<div>",{id:"text-error-output",text:o.msg("outputInitial").plain(),append:"<br/>"}))).prop("outerHTML")}function g(){--b===0&&w()}function w(){n.libs.PowertoolsPlacement.addPortletLink(n.config.values.skin,{id:"t-mr",href:"#",label:o.msg("title").plain(),tooltip:"MassRename",onClick:y})}function y(){if(s){s.show();return}s=new window.dev.modal.Modal({content:x(),id:"form-mass-rename",size:"medium",title:o.msg("title").escape(),buttons:[{id:"mr1-start",text:o.msg("initiate").escape(),primary:!0,event:"start"},{id:"mr1-pause",text:o.msg("pause").escape(),primary:!0,event:"pause",disabled:!0},{text:o.msg("close").escape(),event:"close"}],events:{pause:v,start:M}}),s.create(),c=a("#form-mass-rename"),p=c.find("#text-rename"),f=c.find("#custom-summary"),h=c.find("#redirect-check"),u=c.find("#text-error-output"),s.show()}function v(){m=!0,s.disableActionButtons("mr1-pause"),s.enableActionButtons("mr1-start")}function M(){m=!1,s.disableActionButtons("mr1-start"),s.enableActionButtons("mr1-pause"),L()}function L(){if(!m){var e=(p.val()||"").split(`
`),t=e[0];t?k(t):(u.append(o.msg("finished").escape()+" "+o.msg("nothingLeftToDo").escape()+"<br/>"),v()),e=e.slice(1,e.length),p.val(e.join(`
`))}}function k(e){if(e.split(" ").length!==2)u.append(o.msg("invalidInput",e).escape()+"<br/>");else{var t=e.split(" ")[0],i=e.split(" ")[1],r={action:"move",from:t,to:i,noredirect:"",reason:f.first().val()||window.massRenameSummary||o.inContentLang().msg("summary").plain()};h.prop("checked")&&delete r.noredirect,new n.Api().postWithEditToken(r).done(function(d){d.error?(console.error(o.msg("renameFail",t,i).escape()+": "+d.error.code),u.append(o.msg("renameFail",t,i).escape()+": "+d.error.code+"<br/>")):console.log(o.msg("renameDone",t,i).plain())}).fail(function(d){console.error(o.msg("renameFail",t,i).plain()+": "+d),u.append(o.msg("renameFail2",t,i).escape()+"<br/>")})}setTimeout(L,window.massRenameDelay||1e3)}n.hook("dev.modal").add(g),n.hook("dev.powertools.placement").add(g),P().then(function(e){o=F(e),g()});function F(e){var t=n.Message;t.prototype.constructor=n.Message.prototype.constructor;var i={_i18nLoader:e,msg:function(){var r=Array.prototype.slice.call(arguments);if(r.length!==0){var d=r.shift();return new t(this._i18nLoader.getMessages(),d,r)}}};return["setTempLang","setDefaultLang"].forEach(function(r){i[r]=i._i18nLoader[r].bind(i._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(r){i[r]=i._i18nLoader[r].bind(i)}),i}function P(){var e=new a.Deferred,t=new a.Deferred;function i(){var l=a.Deferred();return n.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(D){l.resolve(D("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(l.reject),l}function r(l){return l.loadMessages("MassRename",{})}function d(l){e.resolve(l)}return t.then(i).then(r).then(d).catch(function(l){console.error(l),e.resolve(U())}),n.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?t.resolve():a.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@dist/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){t.resolve()}).fail(t.reject),e}function U(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new n.Map;e.set({title:"Mass rename",instructions:"Put the name of the page you want to rename, then the new name afterwards with a space in between on each separate line.",instructions2:"For page names with spaces, use underscores instead of spaces.",redirect:"Leave a redirect behind?",summary:"automatic",outputInitial:"Any errors encountered will appear below",initiate:"Initiate",cancel:"Cancel",finished:"Finished!",nothingLeftToDo:"Nothing left to do, or next line is blank.",close:"Close",renameDone:"Successfully renamed $1 to $2!",invalidInput:'The line "$1" is invalid input!',renameFail:"Failed to rename $1 to $2",renameFail2:"Failed to rename $1 to $2!",pause:"Pause","custom-summary":"Reason for moving "}),n.Message.prototype.escape===void 0&&(n.Message.prototype.escape=n.Message.prototype.escaped);var t={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(i){t[i]=a.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(i){t[i]=function(){return this}}),t}})},{css:["#form-mass-rename #text-rename{height:20em;resize:none;width:100%}#form-mass-rename #text-error-output{background-color:#ffbfbf;color:#000;font-weight:700;width:100%;overflow:scroll}#form-mass-rename #my-tools-menu .custom{cursor:pointer}#form-mass-rename .edit-input-control{margin-top:5px;margin-bottom:15px}#form-mass-rename .edit-input-control>label>*{display:block;width:100%;box-sizing:border-box}"]},{},{},null]}))})(mediaWiki);
