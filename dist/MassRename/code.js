mw.loader.using("mediawiki.api",function(){if(window.MassRenameLoaded)return;window.MassRenameLoaded=!0;var t,s,w=3,d=!1,u,l,p,g,c;function h(){return $("<form>").append($("<fieldset>").append($("<p>",{text:t.msg("instructions").plain()}),$("<p>",{text:t.msg("instructions2").plain()}),$("<label>",{for:"redirect-check",text:t.msg("redirect").plain()}).append($("<input>",{type:"checkbox",id:"redirect-check"})),$("<div>",{class:"edit-input-control"}).append($("<label>",{for:"custom-summary"}).append($("<div>").text(t.msg("custom-summary").plain()),$("<input>",{id:"custom-summary"}))),$("<textarea>",{id:"text-rename",placeholder:"old_name new_name"}),$("<div>",{id:"text-error-output",text:t.msg("outputInitial").plain(),append:"<br/>"}))).prop("outerHTML")}function m(){--w===0&&v()}function v(){mw.libs.PowertoolsPlacement.addPortletLink(mw.config.values.skin,{id:"t-mr",href:"#",label:t.msg("title").plain(),tooltip:"MassRename",onClick:M})}function M(){if(s){s.show();return}s=new window.dev.modal.Modal({content:h(),id:"form-mass-rename",size:"medium",title:t.msg("title").escape(),buttons:[{id:"mr1-start",text:t.msg("initiate").escape(),primary:!0,event:"start"},{id:"mr1-pause",text:t.msg("pause").escape(),primary:!0,event:"pause",disabled:!0},{text:t.msg("close").escape(),event:"close"}],events:{pause:f,start:y}}),s.create(),u=$("#form-mass-rename"),l=u.find("#text-rename"),p=u.find("#custom-summary"),g=u.find("#redirect-check"),c=u.find("#text-error-output"),s.show()}function f(){d=!0,s.disableActionButtons("mr1-pause"),s.enableActionButtons("mr1-start")}function y(){d=!1,s.disableActionButtons("mr1-start"),s.enableActionButtons("mr1-pause"),L()}function L(){if(!d){var e=(l.val()||"").split(`
`),n=e[0];n?b(n):(c.append(t.msg("finished").escape()+" "+t.msg("nothingLeftToDo").escape()+"<br/>"),f()),e=e.slice(1,e.length),l.val(e.join(`
`))}}function b(e){if(e.split(" ").length!==2)c.append(t.msg("invalidInput",e).escape()+"<br/>");else{var n=e.split(" ")[0],a=e.split(" ")[1],r={action:"move",from:n,to:a,noredirect:"",reason:p.first().val()||window.massRenameSummary||t.inContentLang().msg("summary").plain()};g.prop("checked")&&delete r.noredirect,new mw.Api().postWithEditToken(r).done(function(o){o.error?(console.error(t.msg("renameFail",n,a).escape()+": "+o.error.code),c.append(t.msg("renameFail",n,a).escape()+": "+o.error.code+"<br/>")):console.log(t.msg("renameDone",n,a).plain())}).fail(function(o){console.error(t.msg("renameFail",n,a).plain()+": "+o),c.append(t.msg("renameFail2",n,a).escape()+"<br/>")})}setTimeout(L,window.massRenameDelay||1e3)}mw.hook("dev.modal").add(m),mw.hook("dev.powertools.placement").add(m),_().then(function(e){t=P(e),m()});function P(e){var n=mw.Message;n.prototype.constructor=mw.Message.prototype.constructor;var a={_i18nLoader:e,msg:function(){var r=Array.prototype.slice.call(arguments);if(r.length!==0){var o=r.shift();return new n(this._i18nLoader.getMessages(),o,r)}}};return["setTempLang","setDefaultLang"].forEach(function(r){a[r]=a._i18nLoader[r].bind(a._i18nLoader)}),["useLang","usePageLang","useContentLang","usePageViewLang","useUserLang","inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(r){a[r]=a._i18nLoader[r].bind(a)}),a}function _(){var e=new $.Deferred,n=new $.Deferred;function a(){var i=$.Deferred();return mw.loader.using("ext.gadget.store.FandoomUtilsI18nLoader").done(function(E){i.resolve(E("ext.gadget.store.FandoomUtilsI18nLoader"))}).fail(i.reject),i}function r(i){return i.loadMessages("MassRename",{})}function o(i){e.resolve(i)}return n.then(a).then(r).then(o).catch(function(i){console.error(i),e.resolve(k())}),mw.loader.getState("ext.gadget.store.FandoomUtilsI18nLoader")?n.resolve():$.ajax({dataType:"script",cache:!0,url:"https://cdn.jsdelivr.net/gh/ccxtwf/MirahezeDevScripts@1bb78aaab64521129863a64533a7a15f4a77738d/dist/FandoomUtilsI18nLoader/gadget-impl.js"}).done(function(){n.resolve()}).fail(n.reject),e}function k(){console.warn("[FandoomUtilsI18nLoader] Failed to load messages. Using fallback messages instead.");var e=new mw.Map;e.set({title:"Mass rename",instructions:"Put the name of the page you want to rename, then the new name afterwards with a space in between on each separate line.",instructions2:"For page names with spaces, use underscores instead of spaces.",redirect:"Leave a redirect behind?",summary:"automatic",outputInitial:"Any errors encountered will appear below",initiate:"Initiate",cancel:"Cancel",finished:"Finished!",nothingLeftToDo:"Nothing left to do, or next line is blank.",close:"Close",renameDone:"Successfully renamed $1 to $2!",invalidInput:'The line "$1" is invalid input!',renameFail:"Failed to rename $1 to $2",renameFail2:"Failed to rename $1 to $2!",pause:"Pause","custom-summary":"Reason for moving "}),mw.Message.prototype.escape===void 0&&(mw.Message.prototype.escape=mw.Message.prototype.escaped);var n={getMessages:function(){return e}};return["setDefaultLang","setTempLang","useLang","usePageLang","useContentLang","usePageViewLang","useUserLang"].forEach(function(a){n[a]=$.noop}),["inLang","inPageLang","inContentLang","inPageViewLang","inUserLang"].forEach(function(a){n[a]=function(){return this}}),n}});
